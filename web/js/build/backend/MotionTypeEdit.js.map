{"version":3,"sources":["backend/MotionTypeEdit.ts"],"names":["MotionTypeEdit","$list","$","newCounter","data","Sortable","create","handle","animation","on","ev","preventDefault","$sectionHolder","this","parents","first","delId","bootbox","confirm","__t","result","append","remove","$li","val","parseInt","removeClass","addClass","find","length","click","trigger","prop","newStr","html","replace","$newObj","$tab","dataNewCounter","$this","$ul","parent","$row","children","focus","each","datetimepicker","locale","hasSupporters","change"],"mappings":"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","file":"MotionTypeEdit.js","sourcesContent":["class MotionTypeEdit {\n    constructor() {\n        let $list = $('#sectionsList'),\n            newCounter = 0;\n\n        $list.data(\"sortable\", Sortable.create($list[0], {\n            handle: '.drag-handle',\n            animation: 150\n        }));\n        $list.on('click', 'a.remover', function (ev) {\n            ev.preventDefault();\n            let $sectionHolder = $(this).parents('li').first(),\n                delId = $sectionHolder.data('id');\n            bootbox.confirm(__t('admin', 'deleteMotionSectionConfirm'), function (result) {\n                if (result) {\n                    $('.adminTypeForm').append('<input type=\"hidden\" name=\"sectionsTodelete[]\" value=\"' + delId + '\">');\n                    $sectionHolder.remove();\n                }\n            });\n        });\n        $list.on('change', '.sectionType', function () {\n            let $li = $(this).parents('li').first(),\n                val = parseInt($(this).val());\n            $li.removeClass('title textHtml textSimple image tabularData');\n            if (val === 0) {\n                $li.addClass('title');\n            } else if (val === 1) {\n                $li.addClass('textSimple');\n            } else if (val === 2) {\n                $li.addClass('textHtml');\n            } else if (val === 3) {\n                $li.addClass('image');\n            } else if (val === 4) {\n                $li.addClass('tabularData');\n                if ($li.find('.tabularDataRow ul > li').length == 0) {\n                    $li.find('.tabularDataRow .addRow').click().click().click();\n                }\n            }\n        });\n        $list.find('.sectionType').trigger('change');\n        $list.on('change', '.maxLenSet', function () {\n            let $li = $(this).parents('li').first();\n            if ($(this).prop('checked')) {\n                $li.addClass('maxLenSet').removeClass('no-maxLenSet');\n            } else {\n                $li.addClass('no-maxLenSet').removeClass('maxLenSet');\n            }\n        });\n        $list.find('.maxLenSet').trigger('change');\n\n        $('.sectionAdder').on('click', function (ev) {\n            ev.preventDefault();\n            let newStr = $('#sectionTemplate').html();\n            newStr = newStr.replace(/#NEW#/g, 'new' + newCounter);\n            let $newObj = $(newStr);\n            $list.append($newObj);\n            newCounter = newCounter + 1;\n\n            $list.find('.sectionType').trigger('change');\n            $list.find('.maxLenSet').trigger('change');\n\n            let $tab = $newObj.find('.tabularDataRow ul');\n            $tab.data(\"sortable\", Sortable.create($tab[0], {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n\n        let dataNewCounter = 0;\n        $list.on('click', '.tabularDataRow .addRow', function (ev) {\n            ev.preventDefault();\n            let $this = $(this),\n                $ul = $this.parent().find(\"ul\"),\n                $row = $($this.data('template').replace(/#NEWDATA#/g, 'new' + dataNewCounter));\n            dataNewCounter = dataNewCounter + 1;\n            $row.removeClass('no0').addClass('no' + $ul.children().length);\n            $ul.append($row);\n            $row.find('input').focus();\n        });\n\n        $list.on('click', '.tabularDataRow .delRow', function (ev) {\n            let $this = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t('admin', 'deleteDataConfirm'), function (result) {\n                if (result) {\n                    $this.parents(\"li\").first().remove();\n                }\n            });\n        });\n\n        $list.find('.tabularDataRow ul').each(function () {\n            let $this = $(this);\n            $this.data(\"sortable\", Sortable.create(this, {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n\n\n        $('#typeDeadlineMotionsHolder').datetimepicker({\n            locale: $('#typeDeadlineMotions').data('locale')\n        });\n        $('#typeDeadlineAmendmentsHolder').datetimepicker({\n            locale: $('#typeDeadlineAmendments').data('locale')\n        });\n        $('#typeSupportType').on('change', function () {\n            let hasSupporters = $(this).find(\"option:selected\").data(\"has-supporters\");\n            if (hasSupporters) {\n                $('#typeMinSupportersRow').removeClass(\"hidden\");\n                $('#typeAllowMoreSupporters').removeClass(\"hidden\");\n            } else {\n                $('#typeMinSupportersRow').addClass(\"hidden\");\n                $('#typeAllowMoreSupporters').addClass(\"hidden\");\n            }\n        }).change();\n\n        $('.deleteTypeOpener a').on('click', function (ev) {\n            ev.preventDefault();\n            $('.deleteTypeForm').removeClass('hidden');\n            $('.deleteTypeOpener').addClass('hidden');\n        });\n    }\n}\n\n\nnew MotionTypeEdit();\n"]}