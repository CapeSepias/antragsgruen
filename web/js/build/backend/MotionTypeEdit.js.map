{"version":3,"sources":["backend/MotionTypeEdit.ts"],"names":["MotionTypeEdit","$","datetimepicker","locale","data","$supportType","on","selected","find","val","removeClass","addClass","trigger","ev","preventDefault","tooltip","this","initSectionList","prototype","$list","newCounter","Sortable","create","handle","animation","$sectionHolder","parents","first","delId","bootbox","confirm","__t","result","append","remove","$li","parseInt","length","click","prop","newStr","html","replace","$newObj","$tab","dataNewCounter","$this","$ul","parent","$row","children","focus","each"],"mappings":"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","file":"MotionTypeEdit.js","sourcesContent":["class MotionTypeEdit {\n    constructor() {\n        $('#typeDeadlineMotionsHolder').datetimepicker({\n            locale: $('#typeDeadlineMotions').data('locale')\n        });\n        $('#typeDeadlineAmendmentsHolder').datetimepicker({\n            locale: $('#typeDeadlineAmendments').data('locale')\n        });\n        let $supportType = $('#typeSupportType');\n        $supportType.on('changed.fu.selectlist', () => {\n            let selected = $supportType.find('input').val();\n            let hasSupporters = $supportType.find(\"li[data-value=\\\"\" + selected + \"\\\"]\").data(\"has-supporters\");\n\n            if (hasSupporters) {\n                $('#typeMinSupportersRow').removeClass(\"hidden\");\n                $('#typeAllowMoreSupporters').removeClass(\"hidden\");\n            } else {\n                $('#typeMinSupportersRow').addClass(\"hidden\");\n                $('#typeAllowMoreSupporters').addClass(\"hidden\");\n            }\n        }).trigger('changed.fu.selectlist');\n\n        $('.deleteTypeOpener a').on('click', (ev) => {\n            ev.preventDefault();\n            $('.deleteTypeForm').removeClass('hidden');\n            $('.deleteTypeOpener').addClass('hidden');\n        });\n\n        $('[data-toggle=\"tooltip\"]').tooltip();\n\n        this.initSectionList();\n    }\n\n    private initSectionList() {\n        let $list = $('#sectionsList'),\n            newCounter = 0;\n\n        $list.data(\"sortable\", Sortable.create($list[0], {\n            handle: '.drag-handle',\n            animation: 150\n        }));\n        $list.on('click', 'a.remover', function (ev) {\n            ev.preventDefault();\n            let $sectionHolder = $(this).parents('li').first(),\n                delId = $sectionHolder.data('id');\n            bootbox.confirm(__t('admin', 'deleteMotionSectionConfirm'), function (result) {\n                if (result) {\n                    $('.adminTypeForm').append('<input type=\"hidden\" name=\"sectionsTodelete[]\" value=\"' + delId + '\">');\n                    $sectionHolder.remove();\n                }\n            });\n        });\n        $list.on('change', '.sectionType', function () {\n            let $li = $(this).parents('li').first(),\n                val = parseInt($(this).val());\n            $li.removeClass('title textHtml textSimple image tabularData');\n            if (val === 0) {\n                $li.addClass('title');\n            } else if (val === 1) {\n                $li.addClass('textSimple');\n            } else if (val === 2) {\n                $li.addClass('textHtml');\n            } else if (val === 3) {\n                $li.addClass('image');\n            } else if (val === 4) {\n                $li.addClass('tabularData');\n                if ($li.find('.tabularDataRow ul > li').length == 0) {\n                    $li.find('.tabularDataRow .addRow').click().click().click();\n                }\n            }\n        });\n        $list.find('.sectionType').trigger('change');\n        $list.on('change', '.maxLenSet', function () {\n            let $li = $(this).parents('li').first();\n            if ($(this).prop('checked')) {\n                $li.addClass('maxLenSet').removeClass('no-maxLenSet');\n            } else {\n                $li.addClass('no-maxLenSet').removeClass('maxLenSet');\n            }\n        });\n        $list.find('.maxLenSet').trigger('change');\n\n        $('.sectionAdder').on('click', function (ev) {\n            ev.preventDefault();\n            let newStr = $('#sectionTemplate').html();\n            newStr = newStr.replace(/#NEW#/g, 'new' + newCounter);\n            let $newObj = $(newStr);\n            $list.append($newObj);\n            newCounter = newCounter + 1;\n\n            $list.find('.sectionType').trigger('change');\n            $list.find('.maxLenSet').trigger('change');\n\n            let $tab = $newObj.find('.tabularDataRow ul');\n            $tab.data(\"sortable\", Sortable.create($tab[0], {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n\n        let dataNewCounter = 0;\n        $list.on('click', '.tabularDataRow .addRow', function (ev) {\n            ev.preventDefault();\n            let $this = $(this),\n                $ul = $this.parent().find(\"ul\"),\n                $row = $($this.data('template').replace(/#NEWDATA#/g, 'new' + dataNewCounter));\n            dataNewCounter = dataNewCounter + 1;\n            $row.removeClass('no0').addClass('no' + $ul.children().length);\n            $ul.append($row);\n            $row.find('input').focus();\n        });\n\n        $list.on('click', '.tabularDataRow .delRow', function (ev) {\n            let $this = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t('admin', 'deleteDataConfirm'), function (result) {\n                if (result) {\n                    $this.parents(\"li\").first().remove();\n                }\n            });\n        });\n\n        $list.find('.tabularDataRow ul').each(function () {\n            let $this = $(this);\n            $this.data(\"sortable\", Sortable.create(this, {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n    }\n}\n\n\nnew MotionTypeEdit();\n"]}