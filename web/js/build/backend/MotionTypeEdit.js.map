{"version":3,"sources":["backend/MotionTypeEdit.ts"],"names":["MotionTypeEdit","$supportType","$","on","selected","find","val","data","removeClass","addClass","trigger","ev","preventDefault","tooltip","this","initSectionList","initDeadlines","prototype","change","currentTarget","prop","each","i","el","datetimepicker","locale","$deadlineHolder","click","html","replace","$newRow","append","parents","remove","$list","newCounter","Sortable","create","handle","animation","$sectionHolder","first","delId","bootbox","confirm","__t","result","$li","parseInt","length","newStr","$newObj","$tab","dataNewCounter","$this","$ul","parent","$row","children","focus"],"mappings":"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","file":"MotionTypeEdit.js","sourcesContent":["class MotionTypeEdit {\n    constructor() {\n        let $supportType = $('#typeSupportType');\n        $supportType.on('changed.fu.selectlist', () => {\n            let selected = $supportType.find('input').val();\n            let hasSupporters = $supportType.find(\"li[data-value=\\\"\" + selected + \"\\\"]\").data(\"has-supporters\");\n\n            if (hasSupporters) {\n                $('#typeMinSupportersRow').removeClass(\"hidden\");\n                $('#typeAllowMoreSupporters').removeClass(\"hidden\");\n            } else {\n                $('#typeMinSupportersRow').addClass(\"hidden\");\n                $('#typeAllowMoreSupporters').addClass(\"hidden\");\n            }\n        }).trigger('changed.fu.selectlist');\n\n        $('.deleteTypeOpener a').on('click', (ev) => {\n            ev.preventDefault();\n            $('.deleteTypeForm').removeClass('hidden');\n            $('.deleteTypeOpener').addClass('hidden');\n        });\n\n        $('[data-toggle=\"tooltip\"]').tooltip();\n\n        this.initSectionList();\n        this.initDeadlines();\n    }\n\n    private initDeadlines() {\n        $('#deadlineFormTypeComplex input').change((ev) => {\n            if ($(ev.currentTarget).prop('checked')) {\n                $('.deadlineTypeSimple').addClass('hidden');\n                $('.deadlineTypeComplex').removeClass('hidden');\n            } else {\n                $('.deadlineTypeSimple').removeClass('hidden');\n                $('.deadlineTypeComplex').addClass('hidden');\n            }\n        }).trigger('change');\n\n        $('.datetimepicker').each((i, el) => {\n            $(el).datetimepicker({\n                locale: $(el).find(\"input\").data('locale')\n            });\n        });\n\n        $('.deadlineHolder').each((i, el) => {\n            const $deadlineHolder = $(el);\n            $deadlineHolder.find('.deadlineAdder').click(() => {\n                let html = $('.deadlineRowTemplate').html();\n                html = html.replace(/TEMPLATE/, 'motions');\n                let $newRow = $(html);\n                $deadlineHolder.find('.deadlineList').append($newRow);\n\n                $newRow.find('.datetimepicker').each((i, el) => {\n                    $(el).datetimepicker({\n                        locale: $(el).find(\"input\").data('locale')\n                    });\n                });\n            });\n            $deadlineHolder.on('click', '.delRow', (ev) => {\n                $(ev.currentTarget).parents('.deadlineEntry').remove();\n            });\n        });\n    }\n\n    private initSectionList() {\n        let $list = $('#sectionsList'),\n            newCounter = 0;\n\n        $list.data(\"sortable\", Sortable.create($list[0], {\n            handle: '.drag-handle',\n            animation: 150\n        }));\n        $list.on('click', 'a.remover', function (ev) {\n            ev.preventDefault();\n            let $sectionHolder = $(this).parents('li').first(),\n                delId = $sectionHolder.data('id');\n            bootbox.confirm(__t('admin', 'deleteMotionSectionConfirm'), function (result) {\n                if (result) {\n                    $('.adminTypeForm').append('<input type=\"hidden\" name=\"sectionsTodelete[]\" value=\"' + delId + '\">');\n                    $sectionHolder.remove();\n                }\n            });\n        });\n        $list.on('change', '.sectionType', function () {\n            let $li = $(this).parents('li').first(),\n                val = parseInt($(this).val());\n            $li.removeClass('title textHtml textSimple image tabularData');\n            if (val === 0) {\n                $li.addClass('title');\n            } else if (val === 1) {\n                $li.addClass('textSimple');\n            } else if (val === 2) {\n                $li.addClass('textHtml');\n            } else if (val === 3) {\n                $li.addClass('image');\n            } else if (val === 4) {\n                $li.addClass('tabularData');\n                if ($li.find('.tabularDataRow ul > li').length == 0) {\n                    $li.find('.tabularDataRow .addRow').click().click().click();\n                }\n            }\n        });\n        $list.find('.sectionType').trigger('change');\n        $list.on('change', '.maxLenSet', function () {\n            let $li = $(this).parents('li').first();\n            if ($(this).prop('checked')) {\n                $li.addClass('maxLenSet').removeClass('no-maxLenSet');\n            } else {\n                $li.addClass('no-maxLenSet').removeClass('maxLenSet');\n            }\n        });\n        $list.find('.maxLenSet').trigger('change');\n\n        $('.sectionAdder').on('click', function (ev) {\n            ev.preventDefault();\n            let newStr = $('#sectionTemplate').html();\n            newStr = newStr.replace(/#NEW#/g, 'new' + newCounter);\n            let $newObj = $(newStr);\n            $list.append($newObj);\n            newCounter = newCounter + 1;\n\n            $list.find('.sectionType').trigger('change');\n            $list.find('.maxLenSet').trigger('change');\n\n            let $tab = $newObj.find('.tabularDataRow ul');\n            $tab.data(\"sortable\", Sortable.create($tab[0], {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n\n        let dataNewCounter = 0;\n        $list.on('click', '.tabularDataRow .addRow', function (ev) {\n            ev.preventDefault();\n            let $this = $(this),\n                $ul = $this.parent().find(\"ul\"),\n                $row = $($this.data('template').replace(/#NEWDATA#/g, 'new' + dataNewCounter));\n            dataNewCounter = dataNewCounter + 1;\n            $row.removeClass('no0').addClass('no' + $ul.children().length);\n            $ul.append($row);\n            $row.find('input').focus();\n        });\n\n        $list.on('click', '.tabularDataRow .delRow', function (ev) {\n            let $this = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t('admin', 'deleteDataConfirm'), function (result) {\n                if (result) {\n                    $this.parents(\"li\").first().remove();\n                }\n            });\n        });\n\n        $list.find('.tabularDataRow ul').each(function () {\n            let $this = $(this);\n            $this.data(\"sortable\", Sortable.create(this, {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n    }\n}\n\n\nnew MotionTypeEdit();\n"]}