{"version":3,"sources":["backend/MotionTypeEdit.ts"],"names":["MotionTypeEdit","$supportType","$","on","selected","find","val","data","removeClass","addClass","trigger","tooltip","this","initSectionList","initDeadlines","initInitiatorForm","prototype","ev","currentTarget","prop","each","i","el","datetimepicker","locale","initLinkedDeadlinePickers","$row","$from","$to","useCurrent","setErrorState","fromDate","date","toDate","isBefore","hasError","$deadlineHolder","addDeadlineRow","html","replace","$newRow","append","parents","remove","children","length","$initiatorCanBePerson","$initiatorCanBeOrga","change","$list","newCounter","Sortable","create","handle","animation","preventDefault","$sectionHolder","first","delId","bootbox","confirm","__t","result","$li","parseInt","click","newStr","$newObj","$tab","dataNewCounter","$this","$ul","parent","focus"],"mappings":"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","file":"MotionTypeEdit.js","sourcesContent":["declare var Sortable;\n\nclass MotionTypeEdit {\n    constructor() {\n        let $supportType = $('#typeSupportType');\n        $supportType.on('changed.fu.selectlist', () => {\n            let selected = $supportType.find('input').val();\n            let hasSupporters = $supportType.find(\"li[data-value=\\\"\" + selected + \"\\\"]\").data(\"has-supporters\");\n\n            if (hasSupporters) {\n                $('#typeMinSupportersRow').removeClass(\"hidden\");\n                $('#typeAllowMoreSupporters').removeClass(\"hidden\");\n            } else {\n                $('#typeMinSupportersRow').addClass(\"hidden\");\n                $('#typeAllowMoreSupporters').addClass(\"hidden\");\n            }\n        }).trigger('changed.fu.selectlist');\n\n        $('.deleteTypeOpener button').on('click', () => {\n            $('.deleteTypeForm').removeClass('hidden');\n            $('.deleteTypeOpener').addClass('hidden');\n        });\n\n        $('[data-toggle=\"tooltip\"]').tooltip();\n\n        this.initSectionList();\n        this.initDeadlines();\n        this.initInitiatorForm();\n    }\n\n    private initDeadlines() {\n        $('#deadlineFormTypeComplex input').on(\"change\", (ev) => {\n            if ($(ev.currentTarget).prop('checked')) {\n                $('.deadlineTypeSimple').addClass('hidden');\n                $('.deadlineTypeComplex').removeClass('hidden');\n            } else {\n                $('.deadlineTypeSimple').removeClass('hidden');\n                $('.deadlineTypeComplex').addClass('hidden');\n            }\n        }).trigger('change');\n\n        $('.datetimepicker').each((i, el) => {\n            $(el).datetimepicker({\n                locale: $(el).find(\"input\").data('locale')\n            });\n        });\n\n        const initLinkedDeadlinePickers = ($row) => {\n            let $from = $row.find(\".datetimepickerFrom\"),\n                $to = $row.find(\".datetimepickerTo\");\n            $from.datetimepicker({\n                locale: $from.find(\"input\").data('locale')\n            });\n            $to.datetimepicker({\n                locale: $to.find(\"input\").data('locale'),\n                useCurrent: false\n            });\n\n            const hasError = () => {\n                const fromDate = $from.data(\"DateTimePicker\").date(),\n                    toDate = $to.data(\"DateTimePicker\").date();\n\n                return (fromDate && toDate && toDate.isBefore(fromDate));\n            };\n\n            const setErrorState = () => {\n                if (hasError()) {\n                    $from.addClass(\"has-error\");\n                    $to.addClass(\"has-error\");\n                } else {\n                    $from.removeClass(\"has-error\");\n                    $to.removeClass(\"has-error\");\n                }\n            };\n\n            $from.on(\"dp.change\", setErrorState);\n            $to.on(\"dp.change\", setErrorState);\n        };\n\n        $('.deadlineEntry').each((i, el) => {\n            initLinkedDeadlinePickers($(el));\n        });\n\n        $('.deadlineHolder').each((i, el) => {\n            const $deadlineHolder = $(el),\n                addDeadlineRow = () => {\n                    let html = $('.deadlineRowTemplate').html();\n                    html = html.replace(/TEMPLATE/g, $deadlineHolder.data('type'));\n                    let $newRow = $(html);\n                    $deadlineHolder.find('.deadlineList').append($newRow);\n                    initLinkedDeadlinePickers($newRow);\n                };\n            $deadlineHolder.find('.deadlineAdder').on(\"click\", addDeadlineRow);\n            $deadlineHolder.on('click', '.delRow', (ev) => {\n                $(ev.currentTarget).parents('.deadlineEntry').remove();\n            });\n            if ($deadlineHolder.find('.deadlineList').children().length === 0) {\n                addDeadlineRow();\n            }\n        });\n    }\n\n    private initInitiatorForm() {\n        const $initiatorCanBePerson = $(\"input[name=initiatorCanBePerson]\");\n        const $initiatorCanBeOrga = $(\"input[name=initiatorCanBeOrganization]\");\n        $initiatorCanBePerson.on(\"change\", () => {\n            if ($initiatorCanBePerson.prop(\"checked\")) {\n                $(\".formGroupGender\").removeClass(\"hidden\");\n            } else {\n                $(\".formGroupGender\").addClass(\"hidden\");\n                if (!$initiatorCanBeOrga.prop(\"checked\")) {\n                    $initiatorCanBeOrga.prop(\"checked\", true).change();\n                }\n            }\n        });\n        $initiatorCanBeOrga.on(\"change\", () => {\n            if ($initiatorCanBeOrga.prop(\"checked\")) {\n                $(\".formGroupResolutionDate\").removeClass(\"hidden\");\n            } else {\n                $(\".formGroupResolutionDate\").addClass(\"hidden\");\n                if (!$initiatorCanBePerson.prop(\"checked\")) {\n                    $initiatorCanBePerson.prop(\"checked\", true).change();\n                }\n            }\n        });\n    }\n\n    private initSectionList() {\n        let $list = $('#sectionsList'),\n            newCounter = 0;\n\n        $list.data(\"sortable\", Sortable.create(<HTMLElement>$list[0], {\n            handle: '.drag-handle',\n            animation: 150\n        }));\n        $list.on('click', 'a.remover', function (ev) {\n            ev.preventDefault();\n            let $sectionHolder = $(this).parents('li').first(),\n                delId = $sectionHolder.data('id');\n            bootbox.confirm(__t('admin', 'deleteMotionSectionConfirm'), function (result) {\n                if (result) {\n                    $('.adminTypeForm').append('<input type=\"hidden\" name=\"sectionsTodelete[]\" value=\"' + delId + '\">');\n                    $sectionHolder.remove();\n                }\n            });\n        });\n        $list.on('change', '.sectionType', function () {\n            let $li = $(this).parents('li').first(),\n                val = parseInt($(this).val() as string);\n            $li.removeClass('title textHtml textSimple image tabularData');\n            if (val === 0) {\n                $li.addClass('title');\n            } else if (val === 1) {\n                $li.addClass('textSimple');\n            } else if (val === 2) {\n                $li.addClass('textHtml');\n            } else if (val === 3) {\n                $li.addClass('image');\n            } else if (val === 4) {\n                $li.addClass('tabularData');\n                if ($li.find('.tabularDataRow ul > li').length == 0) {\n                    $li.find('.tabularDataRow .addRow').click().click().click();\n                }\n            }\n        });\n        $list.find('.sectionType').trigger('change');\n        $list.on('change', '.maxLenSet', function () {\n            let $li = $(this).parents('li').first();\n            if ($(this).prop('checked')) {\n                $li.addClass('maxLenSet').removeClass('no-maxLenSet');\n            } else {\n                $li.addClass('no-maxLenSet').removeClass('maxLenSet');\n            }\n        });\n        $list.find('.maxLenSet').trigger('change');\n\n        $('.sectionAdder').on('click', function (ev) {\n            ev.preventDefault();\n            let newStr = $('#sectionTemplate').html();\n            newStr = newStr.replace(/#NEW#/g, 'new' + newCounter);\n            let $newObj = $(newStr);\n            $list.append($newObj);\n            newCounter = newCounter + 1;\n\n            $list.find('.sectionType').trigger('change');\n            $list.find('.maxLenSet').trigger('change');\n\n            let $tab = $newObj.find('.tabularDataRow ul');\n            $tab.data(\"sortable\", Sortable.create(<HTMLElement>$tab[0], {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n\n        let dataNewCounter = 0;\n        $list.on('click', '.tabularDataRow .addRow', function (ev) {\n            ev.preventDefault();\n            let $this = $(this),\n                $ul = $this.parent().find(\"ul\"),\n                $row = $($this.data('template').replace(/#NEWDATA#/g, 'new' + dataNewCounter));\n            dataNewCounter = dataNewCounter + 1;\n            $row.removeClass('no0').addClass('no' + $ul.children().length);\n            $ul.append($row);\n            $row.find('input').focus();\n        });\n\n        $list.on('click', '.tabularDataRow .delRow', function (ev) {\n            let $this = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t('admin', 'deleteDataConfirm'), function (result) {\n                if (result) {\n                    $this.parents(\"li\").first().remove();\n                }\n            });\n        });\n\n        $list.find('.tabularDataRow ul').each(function () {\n            let $this = $(this);\n            $this.data(\"sortable\", Sortable.create(this, {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n    }\n}\n\n\nnew MotionTypeEdit();\n"]}