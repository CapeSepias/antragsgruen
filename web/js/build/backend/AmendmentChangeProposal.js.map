{"version":3,"sources":["backend/AmendmentChangeProposal.ts"],"names":["AmendmentChangeProposal","$widget","this","$statusDetails","find","initStatusSetter","initCommentForm","prototype","$form","_this","change","ev","data","$","currentTarget","prop","newVal","val","addClass","filter","removeClass","nosave","post","attr","setStatus","_csrf","console","log","fail","alert","trigger","saving","$commentList","submit","text","preventDefault","writeComment","success","$comment","comment","dateFormatted","username","append","scrollTop","scrollHeight","JSON","stringify","exports"],"mappings":"yGAAA,IAAAA,EAAA,WAGI,SAAAA,EAAoBC,GAAAC,KAAAD,QAAAA,EAChBC,KAAKC,eAAiBF,EAAQG,KAAK,yCACnCF,KAAKG,iBAAiBJ,EAAQG,KAAK,gBACnCF,KAAKI,gBAAgBL,EAAQG,KAAK,yBA6D1C,OA1DYJ,EAAAO,UAAAF,iBAAR,SAAyBG,GAAzB,IAAAC,EAAAP,KACIM,EAAMJ,KAAK,qBAAqBM,OAAO,SAACC,EAAIC,GACxC,GAAKC,EAAEF,EAAGG,eAAeC,KAAK,WAA9B,CAGA,IAAIC,EAASH,EAAEF,EAAGG,eAAeG,MACjCR,EAAKN,eAAee,SAAS,UAC7BT,EAAKN,eAAegB,OAAO,WAAaH,GAAQI,YAAY,UAExDR,GAAQA,EAAKS,QAGjBR,EAAES,KAAKd,EAAMe,KAAK,WACdC,UAAWR,EACXS,MAAOjB,EAAMJ,KAAK,qBAAqBa,OACxC,SAACN,GACAe,QAAQC,IAAIhB,KACbiB,KAAK,WACJC,MAAM,uBAEXC,QAAQ,UAAWT,OAAQ,KAG1BrB,EAAAO,UAAAD,gBAAR,SAAwBE,GACpB,IAAIuB,GAAS,EACTC,EAAexB,EAAMJ,KAAK,gBAE9BI,EAAMyB,OAAO,SAACtB,GACV,IAAIuB,EAAO1B,EAAMJ,KAAK,YAAYa,MAClCN,EAAGwB,iBACS,IAARD,GAAcH,IAIlBA,GAAS,EACTlB,EAAES,KAAKd,EAAMe,KAAK,WACda,aAAcF,EACdT,MAAOjB,EAAMJ,KAAK,qBAAqBa,OACxC,SAACN,GACA,GAAIA,EAAG0B,QAAS,CACZ,IAAIC,EAAWzB,EAAE,kHACjByB,EAASlC,KAAK,SAAS8B,KAAKvB,EAAG4B,QAAQC,eACvCF,EAASlC,KAAK,SAAS8B,KAAKvB,EAAG4B,QAAQE,UACvCH,EAASlC,KAAK,YAAY8B,KAAKvB,EAAG4B,QAAQL,MAC1CF,EAAaU,OAAOJ,GACpB9B,EAAMJ,KAAK,YAAYa,IAAI,IAC3Be,EAAa,GAAGW,UAAYX,EAAa,GAAGY,kBAE5Cf,MAAM,mBAAqBgB,KAAKC,UAAUnC,IAE9CoB,GAAS,IACVH,KAAK,WACJC,MAAM,kBACNE,GAAS,OAGjBC,EAAa,GAAGW,UAAYX,EAAa,GAAGY,cAEpD5C,KAnEa+C,EAAA/C,wBAAAA","file":"AmendmentChangeProposal.js","sourcesContent":["export class AmendmentChangeProposal {\n    private $statusDetails: JQuery;\n\n    constructor(private $widget: JQuery) {\n        this.$statusDetails = $widget.find('.proposalStatusDetails .statusDetails');\n        this.initStatusSetter($widget.find('.statusForm'));\n        this.initCommentForm($widget.find('.proposalCommentForm'));\n    }\n\n    private initStatusSetter($form: JQuery) {\n        $form.find(\"input[type=radio]\").change((ev, data: any) => {\n            if (!$(ev.currentTarget).prop('checked')) {\n                return;\n            }\n            let newVal = $(ev.currentTarget).val();\n            this.$statusDetails.addClass('hidden');\n            this.$statusDetails.filter('.status_' + newVal).removeClass('hidden');\n\n            if (data && data.nosave) {\n                return;\n            }\n            $.post($form.attr('action'), {\n                setStatus: newVal,\n                _csrf: $form.find('input[name=_csrf]').val()\n            }, (ev) => {\n                console.log(ev);\n            }).fail(() => {\n                alert(\"Could not save\");\n            });\n        }).trigger('change', {nosave: 1});\n    }\n\n    private initCommentForm($form: JQuery) {\n        let saving = false,\n            $commentList = $form.find('.commentList');\n\n        $form.submit((ev) => {\n            let text = $form.find(\"textarea\").val();\n            ev.preventDefault();\n            if (text == '' || saving) {\n                return;\n            }\n\n            saving = true;\n            $.post($form.attr('action'), {\n                writeComment: text,\n                _csrf: $form.find('input[name=_csrf]').val()\n            }, (ev) => {\n                if (ev.success) {\n                    let $comment = $('<li><div class=\"header\"><div class=\"date\"></div><div class=\"name\"></div></div><div class=\"comment\"></div></li>');\n                    $comment.find('.date').text(ev.comment.dateFormatted);\n                    $comment.find('.name').text(ev.comment.username);\n                    $comment.find('.comment').text(ev.comment.text);\n                    $commentList.append($comment);\n                    $form.find(\"textarea\").val('');\n                    $commentList[0].scrollTop = $commentList[0].scrollHeight;\n                } else {\n                    alert('Could not save: ' + JSON.stringify(ev));\n                }\n                saving = false;\n            }).fail(() => {\n                alert(\"Could not save\");\n                saving = false;\n            });\n        });\n        $commentList[0].scrollTop = $commentList[0].scrollHeight;\n    }\n}\n"]}