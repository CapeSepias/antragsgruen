{"version":3,"sources":["backend/MotionEdit.ts"],"names":["MotionEdit","lang","$","attr","datetimepicker","locale","data","format","find","click","addClass","removeClass","each","$holder","this","$textarea","ckeditor","AntragsgruenEditor_1","AntragsgruenEditor","editor","getEditor","parents","submit","parent","val","getData","append","length","on","show","prop","hide","loadAmendmentCollissions","url","sections","children","$this","hasClass","sectionId","replace","CKEDITOR","instances","post","newSections","_csrf","html","scrollintoview","top_offset","ev","preventDefault","text","confirmed","$form","bootbox","confirm","__t","result","trigger","MotionSupporterEdit_1","MotionSupporterEdit"],"mappings":"kHAKA,IAAAA,GAAA,WACI,QAAAA,KACI,GAAIC,GAAOC,EAAE,QAAQC,KAAK,OAC1BD,GAAE,6BAA6BE,gBAC3BC,OAAQJ,IAEZC,EAAE,+BAA+BE,gBAC7BC,OAAQJ,IAEZC,EAAE,yBAAyBE,gBACvBC,OAAQH,EAAE,mBAAmBI,KAAK,UAClCC,OAAQ,MAEZL,EAAE,yBAAyBM,KAAK,UAAUC,MAAM,WAC5CP,EAAE,yBAAyBQ,SAAS,UACpCR,EAAE,yBAAyBS,YAAY,UACvCT,EAAE,qBAAqBU,KAAK,WACxB,GAAIC,GAAUX,EAAEY,MACZC,EAAYF,EAAQL,KAAK,eACzBQ,EAAW,GAAIC,GAAAC,mBAAmBH,EAAUZ,KAAK,OACjDgB,EAASH,EAASI,WAEtBL,GAAUM,QAAQ,QAAQC,OAAO,WAC7BP,EAAUQ,SAASf,KAAK,YAAYgB,IAAIL,EAAOM,eAGvDvB,EAAE,qBAAqBwB,OAAO,mDAE1BxB,EAAE,8BAA8ByB,OAAS,IACzCzB,EAAE,iCAAiC0B,GAAG,QAAS,WAC3C1B,EAAE,8BAA8B2B,OAChC3B,EAAE,qBAAqB4B,KAAK,YAAY,GAAMC,SAElD7B,EAAE,8BAA8B2B,OAChC3B,EAAE,qBAAqB4B,KAAK,YAAY,GAAMC,SAItD,IAAIC,GAA2B,WAC3B,GAAIC,GAAM/B,EAAE,8BAA8BI,KAAK,OAC3C4B,KACArB,EAAUX,EAAE,8BAEhBA,GAAE,yBAAyBiC,WAAWvB,KAAK,WACvC,GAAIwB,GAAQlC,EAAEY,KACd,IAAIsB,EAAMC,SAAS,oBAAqB,CACpC,GAAIC,GAAYF,EAAMjC,KAAK,MAAMoC,QAAQ,kBAAmB,GAC5DL,GAASI,GAAaE,SAASC,UAAUL,EAAM5B,KAAK,eAAeL,KAAK,OAAOsB,aAGvFvB,EAAEwC,KAAKT,GACHU,YAAeT,EACfU,MAAS1C,EAAE,qBAAqBM,KAAK,uBAAuBgB,OAC7D,SAAUqB,GACThC,EAAQgC,KAAKA,GAEThC,EAAQL,KAAK,yCAAyCmB,OAAS,IAC/Dd,EAAQL,KAAK,yCAAyCI,KAAK,WACvD,GAAIK,GAAAC,mBAAmBhB,EAAEY,MAAMX,KAAK,SAExCD,EAAE,+BAA+B4C,gBAAgBC,YAAY,MAGjE7C,EAAE,8BAA8B6B,OAChC7B,EAAE,qBAAqB4B,KAAK,YAAY,GAAOD,SAIvD3B,GAAE,8BAA8BO,MAAM,SAAUuC,GAC5CA,EAAGC,iBACHjB,MAGJ9B,EAAE,qBAAqBoB,OAAO,WAC1BpB,EAAE,uEAAuEU,KAAK,WAC1E,GAAIsC,GAAOV,SAASC,UAAUvC,EAAEY,MAAMX,KAAK,OAAOsB,SAClDvB,GAAEY,MAAMO,QAAQ,6BAA6Bb,KAAK,cAAcgB,IAAI0B,OAI5EhD,EAAE,qBAAqBoB,OAAO,SAAU0B,EAAI1C,GACxC,IAAIA,GAAkCA,EAAK6C,aAAc,EAAzD,CAGA,GAAIC,GAAQlD,EAAEY,KACdkC,GAAGC,iBACHI,QAAQC,QAAQC,IAAI,QAAS,oBAAqB,SAAUC,GACpDA,GACAJ,EAAMK,QAAQ,UAAWN,WAAa,SAKlD,GAAIO,GAAAC,oBAAoBzD,EAAE,2BAElC,MAAAF,KAEA,IAAIA","file":"MotionEdit.js","sourcesContent":["/// <reference path=\"../typings/scrollintoview/index.d.ts\" />\n\nimport {MotionSupporterEdit} from \"./MotionSupporterEdit\";\nimport {AntragsgruenEditor} from \"../shared/AntragsgruenEditor\";\n\nclass MotionEdit {\n    constructor() {\n        let lang = $(\"html\").attr(\"lang\");\n        $(\"#motionDateCreationHolder\").datetimepicker({\n            locale: lang\n        });\n        $(\"#motionDateResolutionHolder\").datetimepicker({\n            locale: lang\n        });\n        $('#resolutionDateHolder').datetimepicker({\n            locale: $('#resolutionDate').data('locale'),\n            format: 'L'\n        });\n        $(\"#motionTextEditCaller\").find(\"button\").click(function () {\n            $(\"#motionTextEditCaller\").addClass(\"hidden\");\n            $(\"#motionTextEditHolder\").removeClass(\"hidden\");\n            $(\".wysiwyg-textarea\").each(function () {\n                let $holder = $(this),\n                    $textarea = $holder.find(\".texteditor\"),\n                    ckeditor = new AntragsgruenEditor($textarea.attr(\"id\")),\n                    editor = ckeditor.getEditor();\n\n                $textarea.parents(\"form\").submit(function () {\n                    $textarea.parent().find(\"textarea\").val(editor.getData());\n                });\n            });\n            $(\"#motionUpdateForm\").append(\"<input type='hidden' name='edittext' value='1'>\");\n\n            if ($(\".checkAmendmentCollissions\").length > 0) {\n                $(\".wysiwyg-textarea .texteditor\").on(\"focus\", function () {\n                    $(\".checkAmendmentCollissions\").show();\n                    $(\".saveholder .save\").prop(\"disabled\", true).hide();\n                });\n                $(\".checkAmendmentCollissions\").show();\n                $(\".saveholder .save\").prop(\"disabled\", true).hide();\n            }\n        });\n\n        let loadAmendmentCollissions = function () {\n            let url = $(\".checkAmendmentCollissions\").data(\"url\"),\n                sections = [],\n                $holder = $(\".amendmentCollissionsHolder\");\n\n            $(\"#motionTextEditHolder\").children().each(function () {\n                let $this = $(this);\n                if ($this.hasClass(\"wysiwyg-textarea\")) {\n                    let sectionId = $this.attr(\"id\").replace(\"section_holder_\", \"\");\n                    sections[sectionId] = CKEDITOR.instances[$this.find(\".texteditor\").attr(\"id\")].getData();\n                }\n            });\n            $.post(url, {\n                'newSections': sections,\n                '_csrf': $(\"#motionUpdateForm\").find('> input[name=_csrf]').val()\n            }, function (html) {\n                $holder.html(html);\n\n                if ($holder.find(\".amendmentOverrideBlock > .texteditor\").length > 0) {\n                    $holder.find(\".amendmentOverrideBlock > .texteditor\").each(function () {\n                        new AntragsgruenEditor($(this).attr(\"id\"));\n                    });\n                    $(\".amendmentCollissionsHolder\").scrollintoview({top_offset: -50});\n                }\n\n                $(\".checkAmendmentCollissions\").hide();\n                $(\".saveholder .save\").prop(\"disabled\", false).show();\n\n            });\n        };\n        $(\".checkAmendmentCollissions\").click(function (ev) {\n            ev.preventDefault();\n            loadAmendmentCollissions();\n        });\n\n        $(\"#motionUpdateForm\").submit(function() {\n            $(\".amendmentCollissionsHolder .amendment-override-block > .texteditor\").each(function() {\n                let text = CKEDITOR.instances[$(this).attr(\"id\")].getData();\n                $(this).parents(\".amendment-override-block\").find(\"> textarea\").val(text);\n            });\n        });\n\n        $(\".motionDeleteForm\").submit(function (ev, data) {\n            if (data && typeof(data.confirmed) && data.confirmed === true) {\n                return;\n            }\n            let $form = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t(\"admin\", \"delMotionConfirm\"), function (result) {\n                if (result) {\n                    $form.trigger(\"submit\", {'confirmed': true});\n                }\n            });\n        });\n\n        new MotionSupporterEdit($(\"#motionSupporterHolder\"));\n    }\n}\n\nnew MotionEdit();\n"]}