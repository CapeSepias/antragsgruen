{"version":3,"sources":["backend/MotionEdit.ts"],"names":["MotionEdit","_this","this","lang","$","attr","datetimepicker","locale","data","format","find","click","initMotionTextEdit","ev","preventDefault","loadAmendmentCollissions","submit","each","text","CKEDITOR","instances","getData","parents","val","onSubmitDeleteForm","MotionSupporterEdit_1","MotionSupporterEdit","prototype","confirmed","bootbox","confirm","__t","result","trigger","addClass","removeClass","$holder","$textarea","ckeditor","AntragsgruenEditor_1","AntragsgruenEditor","editor","getEditor","parent","append","length","on","show","prop","hide","url","sections","children","$this","hasClass","sectionId","replace","post","newSections","_csrf","html","scrollintoview","top_offset"],"mappings":"kHAKA,IAAAA,GAAA,WACI,QAAAA,KAAA,GAAAC,GAAAC,KACQC,EAAOC,EAAE,QAAQC,KAAK,OAC1BD,GAAE,6BAA6BE,gBAC3BC,OAAQJ,IAEZC,EAAE,+BAA+BE,gBAC7BC,OAAQJ,IAEZC,EAAE,yBAAyBE,gBACvBC,OAAQH,EAAE,mBAAmBI,KAAK,UAClCC,OAAQ,MAEZL,EAAE,yBAAyBM,KAAK,UAAUC,MAAM,WAC5CV,EAAKW,uBAGTR,EAAE,8BAA8BO,MAAM,SAACE,GACnCA,EAAGC,iBACHb,EAAKc,6BAGTX,EAAE,qBAAqBY,OAAO,WAC1BZ,EAAE,qEAAqEa,KAAK,WACxE,GAAIC,GAAOC,SAASC,UAAUhB,EAAEF,MAAMG,KAAK,OAAOgB,SAClDjB,GAAEF,MAAMoB,QAAQ,2BAA2BZ,KAAK,cAAca,IAAIL,OAI1Ed,EAAE,qBAAqBY,OAAO,SAACH,EAAIL,GAC/BP,EAAKuB,mBAAmBX,EAAIL,KAGhC,GAAIiB,GAAAC,oBAAoBtB,EAAE,2BAsElC,MAnEYJ,GAAA2B,UAAAH,mBAAR,SAA2BX,EAAIL,GACvBA,GAAkCA,EAAKoB,aAAc,IAGzDf,EAAGC,iBACHe,QAAQC,QAAQC,IAAI,QAAS,oBAAqB,SAAUC,GACpDA,GACA5B,EAAE,qBAAqB6B,QAAQ,UAAWL,WAAa,QAK3D5B,EAAA2B,UAAAf,mBAAR,WACIR,EAAE,yBAAyB8B,SAAS,UACpC9B,EAAE,yBAAyB+B,YAAY,UACvC/B,EAAE,qBAAqBa,KAAK,WACxB,GAAImB,GAAUhC,EAAEF,MACZmC,EAAYD,EAAQ1B,KAAK,eACzB4B,EAAW,GAAIC,GAAAC,mBAAmBH,EAAUhC,KAAK,OACjDoC,EAASH,EAASI,WAEtBL,GAAUf,QAAQ,QAAQN,OAAO,WAC7BqB,EAAUM,SAASjC,KAAK,YAAYa,IAAIkB,EAAOpB,eAGvDjB,EAAE,qBAAqBwC,OAAO,mDAE1BxC,EAAE,8BAA8ByC,OAAS,IACzCzC,EAAE,iCAAiC0C,GAAG,QAAS,WAC3C1C,EAAE,8BAA8B2C,OAChC3C,EAAE,qBAAqB4C,KAAK,YAAY,GAAMC,SAElD7C,EAAE,8BAA8B2C,OAChC3C,EAAE,qBAAqB4C,KAAK,YAAY,GAAMC,SAI9CjD,EAAA2B,UAAAZ,yBAAR,WACI,GAAImC,GAAM9C,EAAE,8BAA8BI,KAAK,OAC3C2C,KACAf,EAAUhC,EAAE,8BAEhBA,GAAE,yBAAyBgD,WAAWnC,KAAK,WACvC,GAAIoC,GAAQjD,EAAEF,KACd,IAAImD,EAAMC,SAAS,oBAAqB,CACpC,GAAIC,GAAYF,EAAMhD,KAAK,MAAMmD,QAAQ,kBAAmB,GAC5DL,GAASI,GAAapC,SAASC,UAAUiC,EAAM3C,KAAK,eAAeL,KAAK,OAAOgB,aAGvFjB,EAAEqD,KAAKP,GACHQ,YAAeP,EACfQ,MAASvD,EAAE,qBAAqBM,KAAK,uBAAuBa,OAC7D,SAAUqC,GACTxB,EAAQwB,KAAKA,GAETxB,EAAQ1B,KAAK,yCAAyCmC,OAAS,IAC/DT,EAAQ1B,KAAK,yCAAyCO,KAAK,WACvD,GAAIsB,GAAAC,mBAAmBpC,EAAEF,MAAMG,KAAK,SAExCD,EAAE,+BAA+ByD,gBAAgBC,YAAY,MAGjE1D,EAAE,8BAA8B6C,OAChC7C,EAAE,qBAAqB4C,KAAK,YAAY,GAAOD,UAI3D/C,IAEA,IAAIA","file":"MotionEdit.js","sourcesContent":["/// <reference path=\"../typings/scrollintoview/index.d.ts\" />\n\nimport {MotionSupporterEdit} from \"./MotionSupporterEdit\";\nimport {AntragsgruenEditor} from \"../shared/AntragsgruenEditor\";\n\nclass MotionEdit {\n    constructor() {\n        let lang = $(\"html\").attr(\"lang\");\n        $(\"#motionDateCreationHolder\").datetimepicker({\n            locale: lang\n        });\n        $(\"#motionDateResolutionHolder\").datetimepicker({\n            locale: lang\n        });\n        $('#resolutionDateHolder').datetimepicker({\n            locale: $('#resolutionDate').data('locale'),\n            format: 'L'\n        });\n        $(\"#motionTextEditCaller\").find(\"button\").click(() => {\n            this.initMotionTextEdit();\n        });\n\n        $(\".checkAmendmentCollissions\").click((ev) => {\n            ev.preventDefault();\n            this.loadAmendmentCollissions();\n        });\n\n        $(\"#motionUpdateForm\").submit(function () {\n            $(\".amendmentCollissionsHolder .amendmentOverrideBlock > .texteditor\").each(function () {\n                let text = CKEDITOR.instances[$(this).attr(\"id\")].getData();\n                $(this).parents(\".amendmentOverrideBlock\").find(\"> textarea\").val(text);\n            });\n        });\n\n        $(\".motionDeleteForm\").submit((ev, data) => {\n            this.onSubmitDeleteForm(ev, data);\n        });\n\n        new MotionSupporterEdit($(\"#motionSupporterHolder\"));\n    }\n\n    private onSubmitDeleteForm(ev, data) {\n        if (data && typeof(data.confirmed) && data.confirmed === true) {\n            return;\n        }\n        ev.preventDefault();\n        bootbox.confirm(__t(\"admin\", \"delMotionConfirm\"), function (result) {\n            if (result) {\n                $(\".motionDeleteForm\").trigger(\"submit\", {'confirmed': true});\n            }\n        });\n    }\n\n    private initMotionTextEdit() {\n        $(\"#motionTextEditCaller\").addClass(\"hidden\");\n        $(\"#motionTextEditHolder\").removeClass(\"hidden\");\n        $(\".wysiwyg-textarea\").each(function () {\n            let $holder = $(this),\n                $textarea = $holder.find(\".texteditor\"),\n                ckeditor = new AntragsgruenEditor($textarea.attr(\"id\")),\n                editor = ckeditor.getEditor();\n\n            $textarea.parents(\"form\").submit(() => {\n                $textarea.parent().find(\"textarea\").val(editor.getData());\n            });\n        });\n        $(\"#motionUpdateForm\").append(\"<input type='hidden' name='edittext' value='1'>\");\n\n        if ($(\".checkAmendmentCollissions\").length > 0) {\n            $(\".wysiwyg-textarea .texteditor\").on(\"focus\", function () {\n                $(\".checkAmendmentCollissions\").show();\n                $(\".saveholder .save\").prop(\"disabled\", true).hide();\n            });\n            $(\".checkAmendmentCollissions\").show();\n            $(\".saveholder .save\").prop(\"disabled\", true).hide();\n        }\n    }\n\n    private loadAmendmentCollissions() {\n        let url = $(\".checkAmendmentCollissions\").data(\"url\"),\n            sections = [],\n            $holder = $(\".amendmentCollissionsHolder\");\n\n        $(\"#motionTextEditHolder\").children().each(function () {\n            let $this = $(this);\n            if ($this.hasClass(\"wysiwyg-textarea\")) {\n                let sectionId = $this.attr(\"id\").replace(\"section_holder_\", \"\");\n                sections[sectionId] = CKEDITOR.instances[$this.find(\".texteditor\").attr(\"id\")].getData();\n            }\n        });\n        $.post(url, {\n            'newSections': sections,\n            '_csrf': $(\"#motionUpdateForm\").find('> input[name=_csrf]').val()\n        }, function (html) {\n            $holder.html(html);\n\n            if ($holder.find(\".amendmentOverrideBlock > .texteditor\").length > 0) {\n                $holder.find(\".amendmentOverrideBlock > .texteditor\").each(function () {\n                    new AntragsgruenEditor($(this).attr(\"id\"));\n                });\n                $(\".amendmentCollissionsHolder\").scrollintoview({top_offset: -50});\n            }\n\n            $(\".checkAmendmentCollissions\").hide();\n            $(\".saveholder .save\").prop(\"disabled\", false).show();\n\n        });\n    }\n}\n\nnew MotionEdit();\n"]}