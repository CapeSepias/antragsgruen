define(["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VotingAdmin=void 0;e.VotingAdmin=class{constructor(t){this.$element=t,this.createVueWidget(),this.initVotingCreater()}createVueWidget(){const t=this.$element.find(".votingAdmin")[0],e=this.$element.data("url-vote-settings"),n=this.$element.data("vote-create"),i=this.$element.data("addable-motions"),s=this.$element.data("url-poll"),o=this.$element[0].getAttribute("data-voting");this.widget=new Vue({el:t,template:'<div class="adminVotings">\n                <voting-admin-widget v-for="voting in votings"\n                                     :voting="voting"\n                                     :addableMotions="addableMotions"\n                                     @set-status="setStatus"\n                                     @save-settings="saveSettings"\n                                     @remove-item="removeItem"\n                                     @delete-voting="deleteVoting"\n                                     @add-item="addItem"\n                ></voting-admin-widget>\n            </div>',data:()=>({votingsJson:null,votings:null,addableMotions:i,csrf:$("head").find("meta[name=csrf-token]").attr("content"),pollingId:null}),methods:{_performOperation:function(t,n){let i={_csrf:this.csrf};n&&(i=Object.assign(i,n));const s=this,o=e.replace(/VOTINGBLOCKID/,t);$.post(o,i,(function(t){void 0===t.success||t.success?s.votings=t:alert(t.message)})).catch((function(t){alert(t.responseText)}))},setVotingFromJson(t){t!==this.votingsJson&&(this.votings=JSON.parse(t),this.votingsJson=t)},setVotingFromObject(t){this.votings=t,this.votingsJson=null},setStatus(t,e,n){this._performOperation(t,{op:"update-status",status:e,organizations:n.map((t=>({id:t.id,members_present:t.members_present})))})},saveSettings(t,e,n){this._performOperation(t,{op:"save-settings",title:e,assignedMotion:n})},deleteVoting(t){this._performOperation(t,{op:"delete-voting"})},createVoting:function(t,e){let i={_csrf:this.csrf,title:t,assignedMotion:e};const s=this;$.post(n,i,(function(t){void 0===t.success||t.success?(s.votings=t.votings,window.setTimeout((()=>{$("#voting"+t.created_voting).scrollintoview({top_offset:-100})}),200)):alert(t.message)})).catch((function(t){alert(t.responseText)}))},removeItem(t,e,n){this._performOperation(t,{op:"remove-item",itemType:e,itemId:n})},addItem(t,e){this._performOperation(t,{op:"add-item",itemDefinition:e})},reloadData:function(){const t=this;$.get(s,(function(e){t.setVotingFromJson(e)}),"text").catch((function(t){console.error("Could not load voting data from backend",t)}))},startPolling:function(){const t=this;this.pollingId=window.setInterval((function(){t.reloadData()}),3e3)}},beforeDestroy(){window.clearInterval(this.pollingId)},created(){this.setVotingFromJson(o),this.startPolling()}})}initVotingCreater(){const t=this.$element.find(".createVotingOpener"),e=this.$element.find(".createVotingHolder");t.on("click",(()=>{e.removeClass("hidden"),t.addClass("hidden")})),e.find("form").on("submit",(n=>{n.stopPropagation(),n.preventDefault(),this.widget.createVoting(e.find(".settingsTitle").val(),e.find(".settingsAssignedMotion").val()),e.addClass("hidden"),t.removeClass("hidden")}))}}}));
//# sourceMappingURL=VotingAdmin.js.map
