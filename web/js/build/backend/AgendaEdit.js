var AgendaEdit=function(){function a(){var t=this;this.hasChanged=!1,this.delAgendaItemStr='<a href="#" class="delAgendaItem"><span class="glyphicon glyphicon-minus-sign"></span></a>',this.$agendaform=$("#agendaEditSavingHolder"),this.$agenda=$(".motionListWithinAgenda"),this.$agenda.addClass("agendaListEditing"),this.$agenda.nestedSortable({handle:".moveHandle",items:"li.agendaItem",toleranceElement:"> div",placeholder:"movePlaceholder",tolerance:"pointer",forcePlaceholderSize:!0,helper:"clone",axis:"y",update:function(){t.showSaver(),$("ol.motionListWithinAgenda").trigger("antragsgruen:agenda-change")}}),this.$agenda.find(".agendaItem").each(function(e,a){t.prepareAgendaItem($(a))}),this.prepareAgendaList(this.$agenda,!0),this.$agenda.find("ol.agenda").each(function(e,a){t.prepareAgendaList($(a),!1)}),this.$agenda.find(".input-group.time").datetimepicker({locale:$("html").attr("lang"),format:"LT"}),this.$agenda.on("click",".agendaItemAdder .addEntry",this.agendaItemAdd.bind(this)),this.$agenda.on("click",".agendaItemAdder .addDate",this.agendaDateAdd.bind(this)),this.$agenda.on("change",".agendaItemAdder .showTimes",this.showTimesChanges.bind(this)),this.$agenda.on("click",".delAgendaItem",this.delAgendaItem.bind(this)),this.$agenda.on("click",".editAgendaItem",this.editAgendaItem.bind(this)),this.$agenda.on("submit",".agendaItemEditForm",this.submitSingleItemForm.bind(this)),this.$agendaform.on("submit",this.submitCompleteForm.bind(this))}return a.prototype.buildAgendaStruct=function(e){var i=this,d=[];return e.children(".agendaItem").each(function(e,a){var t=$(a),n=t.attr("id").split("_");d.push({id:n[1],code:t.find("> div > .agendaItemEditForm input[name=code]").val(),title:t.find("> div > .agendaItemEditForm input[name=title]").val(),motionTypeId:t.find("> div > .agendaItemEditForm select[name=motionType]").val(),children:i.buildAgendaStruct(t.find("> ol"))})}),d},a.prototype.submitSingleItemForm=function(e){e.preventDefault(),this.showSaver();var a=$(e.target).parents("li.agendaItem").first(),t=$(e.target),n=t.find("input[name=title]").val(),i=t.find("input[name=code]").val();a.removeClass("editing"),a.data("code",i),a.find("> div > h3 .code").text(i),a.find("> div > h3 .title").text(n),$("ol.motionListWithinAgenda").trigger("antragsgruen:agenda-change")},a.prototype.submitCompleteForm=function(){var e=this.buildAgendaStruct($(".motionListWithinAgenda"));this.$agendaform.find("input[name=data]").val(JSON.stringify(e)),$(window).off("beforeunload",a.onLeavePage)},a.prototype.delAgendaItem=function(e){var a=this,t=$(e.target);e.preventDefault(),bootbox.confirm(__t("admin","agendaDelEntryConfirm"),function(e){e&&(a.showSaver(),t.parents("li.agendaItem").first().remove(),$("ol.motionListWithinAgenda").trigger("antragsgruen:agenda-change"))})},a.prototype.editAgendaItem=function(e){e.preventDefault(),this.showSaver();var a=$(e.target).parents("li.agendaItem").first();a.addClass("editing"),a.find("> div > .agendaItemEditForm input[name=code]").trigger("focus").trigger("select")},a.prototype.agendaItemAdd=function(e){e.preventDefault(),this.showSaver();var a=$($("#agendaNewElementTemplate").val());$(e.target).parents(".agendaItemAdder").first().before(a),this.prepareAgendaItem(a),this.prepareAgendaList(a.find("ol.agenda"),!1),a.find(".editAgendaItem").trigger("click"),a.find(".agendaItemEditForm input.code").trigger("focus")},a.prototype.agendaDateAdd=function(e){e.preventDefault(),this.showSaver();var a=$($("#agendaNewDateTemplate").val());$(e.target).parents(".agendaItemAdder").first().before(a),this.prepareAgendaItem(a),this.prepareAgendaList(a.find("ol.agenda"),!1),a.find(".editAgendaItem").trigger("click"),a.find(".agendaItemEditForm input.title").trigger("focus")},a.prototype.showTimesChanges=function(){this.$agenda.find(".agendaItemAdder .showTimes input").prop("checked")?this.$agenda.addClass("showTimes").removeClass("noShowTimes"):this.$agenda.removeClass("showTimes").addClass("noShowTimes")},a.prototype.prepareAgendaItem=function(e){e.find("> div").prepend('<span class="glyphicon glyphicon-resize-vertical moveHandle"></span>'),e.find("> div > h3").append('<a href="#" class="editAgendaItem"><span class="glyphicon glyphicon-pencil"></span></a>'),e.find("> div > h3").append(this.delAgendaItemStr)},a.prototype.prepareAgendaList=function(e,a){var t='<li class="agendaItemAdder mjs-nestedSortable-no-nesting mjs-nestedSortable-disabled"><a href="#" class="addEntry"><span class="glyphicon glyphicon-plus-sign"></span> '+__t("admin","agendaAddEntry")+"</a>";a&&(t+='<a href="#" class="addDate"><span class="glyphicon glyphicon-plus-sign"></span> '+__t("admin","agendaAddDate")+'</a><label class="showTimes"><input type="checkbox" class="showTimes"> '+__t("admin","agendaShowTimes")+"</label>"),t+="</li>",e.append(t)},a.prototype.showSaver=function(){$("#agendaEditSavingHolder").removeClass("hidden"),this.hasChanged=!0,$("body").hasClass("testing")||$(window).on("beforeunload",a.onLeavePage)},a.onLeavePage=function(){return __t("std","leave_changed_page")},a}();new AgendaEdit;
//# sourceMappingURL=AgendaEdit.js.map
