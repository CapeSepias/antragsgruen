{"version":3,"sources":["backend/UserAdmin.js","backend/UserAdmin.ts"],"names":["define","require","exports","Object","defineProperty","value","UserAdmin","constructor","$element","this","element","createVueWidget","$","tooltip","vueEl","querySelector","userSaveUrl","getAttribute","initUsersJson","initGroupsJson","widget","Vue","el","template","data","usersJson","users","groupsJson","groups","csrf","document","pollingId","computed","methods","_performOperation","votingBlockId","additionalProps","postData","_csrf","assign","post","undefined","success","votings","alert","message","catch","err","responseText","saveUserGroups","user","console","log","JSON","stringify","op","userId","id","setUserGroupsFromJson","parse","reloadData","startPolling","window","setInterval","beforeDestroy","clearInterval","created"],"mappings":"AAAAA,OAAO,CAAC,UAAW,YAAY,SAAUC,EAASC,GAC9C,aACAC,OAAOC,eAAeF,EAAS,aAAc,CAAEG,OAAO,IACtDH,EAAQI,eAAY,ECCxBJ,EAAAI,UAAA,MAIIC,YAAYC,GACRC,KAAKC,QAAUF,EAAS,GACxBC,KAAKE,kBAELC,EAAE,2BAA2BC,UAGzBF,kBACJ,MAAMG,EAAQL,KAAKC,QAAQK,cAAc,cACnCC,EAAcP,KAAKC,QAAQO,aAAa,sBACxCC,EAAgBT,KAAKC,QAAQO,aAAa,cAC1CE,EAAiBV,KAAKC,QAAQO,aAAa,eACjCR,KAAKC,QAAQO,aAAa,iBAE1CR,KAAKW,OAAS,IAAIC,IAAI,CAClBC,GAAIR,EACJS,SAAU,qQAMVC,KAAI,KACO,CACHC,UAAW,KACXC,MAAO,KACPC,WAAY,KACZC,OAAQ,KACRC,KAAMC,SAASf,cAAc,8BAA8BE,aAAa,WACxEc,UAAW,OAGnBC,SAAU,GAEVC,QAAS,CACLC,kBAAmB,SAAUC,EAAeC,GACxC,IAAIC,EAAW,CACXC,MAAO7B,KAAKoB,MAEZO,IACAC,EAAWlC,OAAOoC,OAAOF,EAAUD,IAEvC,MAAMhB,EAASX,KACfG,EAAE4B,KAAKxB,EAAaqB,GAAU,SAAUb,QACfiB,IAAjBjB,EAAKkB,SAA0BlB,EAAKkB,QAIxCtB,EAAOuB,QAAUnB,EAHboB,MAAMpB,EAAKqB,YAIhBC,OAAM,SAAUC,GACfH,MAAMG,EAAIC,kBAGlBC,eAAeC,EAAMtB,GACjBuB,QAAQC,IAAIC,KAAKC,UAAUJ,GAAOtB,GAClCnB,KAAKyB,kBAAkB,CACnBqB,GAAI,mBACJC,OAAQN,EAAKO,GACb7B,OAAAA,KAGR8B,sBAAsBhC,EAAOE,GACrBF,IAAUjB,KAAKgB,WAAaG,IAAWnB,KAAKkB,aAGhDlB,KAAKiB,MAAQ2B,KAAKM,MAAMjC,GACxBjB,KAAKgB,UAAYC,EACjBjB,KAAKmB,OAASyB,KAAKM,MAAM/B,GACzBnB,KAAKkB,WAAaC,IAEtBgC,WAAY,WAERT,QAAQC,IAAI,kCAShBS,aAAc,WACV,MAAMzC,EAASX,KACfA,KAAKsB,UAAY+B,OAAOC,aAAY,WAChC3C,EAAOwC,eACR,OAGXI,gBACIF,OAAOG,cAAcxD,KAAKsB,YAE9BmC,UACIzD,KAAKiD,sBAAsBxC,EAAeC,GAC1CV,KAAKoD","file":"UserAdmin.js","sourcesContent":[null,"import { VueConstructor } from 'vue';\n\ndeclare var Vue: VueConstructor;\n\nexport class UserAdmin {\n    private widget;\n    private element: HTMLElement;\n\n    constructor($element: JQuery) {\n        this.element = $element[0];\n        this.createVueWidget();\n\n        $('[data-toggle=\"tooltip\"]').tooltip();\n    }\n\n    private createVueWidget() {\n        const vueEl = this.element.querySelector(\".userAdmin\");\n        const userSaveUrl = this.element.getAttribute('data-url-user-save');\n        const initUsersJson = this.element.getAttribute('data-users');\n        const initGroupsJson = this.element.getAttribute('data-groups');\n        const pollUrl = this.element.getAttribute('data-url-poll');\n\n        this.widget = new Vue({\n            el: vueEl,\n            template: `<div class=\"adminUsers\">\n                <user-admin-widget :users=\"users\"\n                                   :groups=\"groups\"\n                                   @save-user-groups=\"saveUserGroups\"\n                ></user-admin-widget>\n            </div>`,\n            data() {\n                return {\n                    usersJson: null,\n                    users: null,\n                    groupsJson: null,\n                    groups: null,\n                    csrf: document.querySelector('head meta[name=csrf-token]').getAttribute('content'),\n                    pollingId: null\n                };\n            },\n            computed: {\n            },\n            methods: {\n                _performOperation: function (votingBlockId, additionalProps) {\n                    let postData = {\n                        _csrf: this.csrf,\n                    };\n                    if (additionalProps) {\n                        postData = Object.assign(postData, additionalProps);\n                    }\n                    const widget = this;\n                    $.post(userSaveUrl, postData, function (data) {\n                        if (data.success !== undefined && !data.success) {\n                            alert(data.message);\n                            return;\n                        }\n                        widget.votings = data;\n                    }).catch(function (err) {\n                        alert(err.responseText);\n                    });\n                },\n                saveUserGroups(user, groups) {\n                    console.log(JSON.stringify(user), groups);\n                    this._performOperation({\n                        op: 'save-user-groups',\n                        userId: user.id,\n                        groups\n                    });\n                },\n                setUserGroupsFromJson(users, groups) {\n                    if (users === this.usersJson && groups === this.groupsJson) {\n                        return;\n                    }\n                    this.users = JSON.parse(users);\n                    this.usersJson = users;\n                    this.groups = JSON.parse(groups);\n                    this.groupsJson = groups;\n                },\n                reloadData: function () {\n                    const widget = this;\n                    console.log(\"Reloading not implemented yet\");\n                    /*\n                    $.get(pollUrl, function (data) {\n                        widget.setUserGroupsFromJson(data); // @TODO\n                    }, 'text').catch(function (err) {\n                        console.error(\"Could not load voting data from backend\", err);\n                    });\n                    */\n                },\n                startPolling: function () {\n                    const widget = this;\n                    this.pollingId = window.setInterval(function () {\n                        widget.reloadData();\n                    }, 3000);\n                }\n            },\n            beforeDestroy() {\n                window.clearInterval(this.pollingId)\n            },\n            created() {\n                this.setUserGroupsFromJson(initUsersJson, initGroupsJson);\n                this.startPolling()\n            }\n        });\n    }\n}\n"]}