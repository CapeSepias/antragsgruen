define(["require","exports"],function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){function t(t){this.$widget=t,this.$statusDetails=t.find(".statusDetails"),this.$visibilityInput=t.find("input[name=proposalVisible]"),this.$votingStatusInput=t.find("input[name=votingStatus]"),this.$votingBlockId=t.find("input[name=votingBlockId]"),this.initStatusSetter(),this.initCommentForm(),this.initVotingBlock(),this.saveUrl=t.attr("action"),this.csrf=t.find("input[name=_csrf]").val(),t.submit(function(t){return t.preventDefault()})}return t.prototype.saveStatus=function(){var t=this,i=this.$widget.find(".statusForm input[type=radio]:checked").val(),e={setStatus:i,visible:this.$visibilityInput.prop("checked")?1:0,votingBlockId:this.$votingBlockId.val(),_csrf:this.csrf};10==i&&(e.proposalComment=this.$widget.find("input[name=referredTo]").val()),22==i&&(e.proposalComment=this.$widget.find("input[name=obsoletedByAmendment]").val()),11==i&&(e.votingStatus=this.$votingStatusInput.filter(":checked").val()),"NEW"==e.votingBlockId&&(e.votingBlockTitle=this.$widget.find("input[name=newBlockTitle]").val()),$.post(this.saveUrl,e,function(i){t.$widget.find(".saving").addClass("hidden"),t.$widget.find(".saved").removeClass("hidden"),window.setTimeout(function(){return t.$widget.find(".saved").addClass("hidden")},2e3),i.needsReload&&window.location.reload()}).fail(function(){alert("Could not save")})},t.prototype.initStatusSetter=function(){var t=this;this.$widget.find(".statusForm input[type=radio]").change(function(i){if($(i.currentTarget).prop("checked")){var e=t.$widget.find(".statusForm input[type=radio]:checked").val();t.$statusDetails.addClass("hidden"),t.$statusDetails.filter(".status_"+e).removeClass("hidden"),t.$widget.find(".saving").removeClass("hidden")}}).trigger("change"),this.$widget.find("input").change(function(){t.$widget.find(".saving").removeClass("hidden")}),this.$widget.find("#obsoletedByAmendment").on("changed.fu.selectlist",function(){t.$widget.find(".saving").removeClass("hidden")}),this.$widget.find(".saving").addClass("hidden"),this.$widget.find(".saving button").click(this.saveStatus.bind(this))},t.prototype.initVotingBlock=function(){var t=this;this.$widget.find("#votingBlockId").on("changed.fu.selectlist",function(){t.$widget.find(".saving").removeClass("hidden"),"NEW"==t.$votingBlockId.val()?t.$widget.find(".newBlock").removeClass("hidden"):t.$widget.find(".newBlock").addClass("hidden")}),this.$widget.find(".newBlock").addClass("hidden")},t.prototype.initCommentForm=function(){var t=this,i=this.$widget.find(".proposalCommentForm"),e=!1,n=i.find(".commentList");i.find("button").click(function(){var s=i.find("textarea").val();""==s||e||(e=!0,$.post(t.saveUrl,{writeComment:s,_csrf:t.csrf},function(t){if(t.success){var s=$('<li><div class="header"><div class="date"></div><div class="name"></div></div><div class="comment"></div></li>');s.find(".date").text(t.comment.dateFormatted),s.find(".name").text(t.comment.username),s.find(".comment").text(t.comment.text),n.append(s),i.find("textarea").val(""),n[0].scrollTop=n[0].scrollHeight}else alert("Could not save: "+JSON.stringify(t));e=!1}).fail(function(){alert("Could not save"),e=!1}))}),n[0].scrollTop=n[0].scrollHeight},t}();i.AmendmentChangeProposal=e});
//# sourceMappingURL=AmendmentChangeProposal.js.map
