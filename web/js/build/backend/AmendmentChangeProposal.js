define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.$widget=t,this.$statusDetails=t.find(".proposalStatusDetails .statusDetails"),this.initStatusSetter(),this.initCommentForm(),this.saveUrl=t.attr("action"),this.csrf=t.find("input[name=_csrf]").val(),t.submit(function(t){return t.preventDefault()})}return t.prototype.saveStatus=function(){var t=this,e=this.$widget.find(".statusForm input[type=radio]:checked").val(),i={setStatus:e,_csrf:this.csrf};10==e&&(i.proposalComment=this.$widget.find("input[name=referredTo]").val()),$.post(this.saveUrl,i,function(e){console.log(e),t.$widget.find(".saving").addClass("hidden"),t.$widget.find(".saved").removeClass("hidden"),window.setTimeout(function(){return t.$widget.find(".saved").addClass("hidden")},2e3)}).fail(function(){alert("Could not save")})},t.prototype.initStatusSetter=function(){var t=this;this.$widget.find(".statusForm input[type=radio]").change(function(e){if($(e.currentTarget).prop("checked")){var i=t.$widget.find(".statusForm input[type=radio]:checked").val();t.$statusDetails.addClass("hidden"),t.$statusDetails.filter(".status_"+i).removeClass("hidden"),t.$widget.find(".saving").removeClass("hidden")}}).trigger("change"),this.$widget.find("input[name=referredTo]").on("keyup",function(){t.$widget.find(".saving").removeClass("hidden")}),this.$widget.find(".saving").addClass("hidden"),this.$widget.find(".saving button").click(this.saveStatus.bind(this))},t.prototype.initCommentForm=function(){var t=this,e=this.$widget.find(".proposalCommentForm"),i=!1,s=e.find(".commentList");e.find("button").click(function(){var n=e.find("textarea").val();""==n||i||(i=!0,$.post(t.saveUrl,{writeComment:n,_csrf:t.csrf},function(t){if(t.success){var n=$('<li><div class="header"><div class="date"></div><div class="name"></div></div><div class="comment"></div></li>');n.find(".date").text(t.comment.dateFormatted),n.find(".name").text(t.comment.username),n.find(".comment").text(t.comment.text),s.append(n),e.find("textarea").val(""),s[0].scrollTop=s[0].scrollHeight}else alert("Could not save: "+JSON.stringify(t));i=!1}).fail(function(){alert("Could not save"),i=!1}))}),s[0].scrollTop=s[0].scrollHeight},t}();e.AmendmentChangeProposal=i});
//# sourceMappingURL=AmendmentChangeProposal.js.map
