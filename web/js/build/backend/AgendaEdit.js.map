{"version":3,"sources":["backend/AgendaEdit.ts"],"names":["AgendaEdit","adderClasses","adder","__t","prepareAgendaItem","$item","find","prepend","append","prepareAgendaList","$list","showSaver","$","removeClass","buildAgendaStruct","$ol","items","children","each","$li","this","id","attr","split","push","code","val","title","motionTypeId","$agenda","addClass","nestedSortable","handle","toleranceElement","placeholder","tolerance","forcePlaceholderSize","helper","axis","update","Antragsgruen","recalcAgendaCodes","on","ev","preventDefault","$newElement","$adder","parents","first","before","trigger","focus","$this","bootbox","confirm","result","remove","select","$form","newTitle","newCode","data","text","submit","JSON","stringify"],"mappings":"AAMA,GAAAA,YAAA,WACI,QAAAA,KACI,GAAIC,GAAe,4EACfC,EAAQ,cAAgBD,EAAe,qEACnCE,IAAI,QAAS,kBAAoB,YACrCC,EAAoB,SAAUC,GAC1BA,EAAMC,KAAK,SAASC,QAAQ,wEAC5BF,EAAMC,KAAK,cAAcE,OAAO,2FAChCH,EAAMC,KAAK,cAAcE,OAAO,+FAEpCC,EAAoB,SAAUC,GAC1BA,EAAMF,OAAON,IAEjBS,EAAY,WACRC,EAAE,2BAA2BC,YAAY,WAE7CC,EAAoB,SAAUC,GAC1B,GAAIC,KAYJ,OAXAD,GAAIE,SAAS,eAAeC,KAAK,WAC7B,GAAIC,GAAMP,EAAEQ,MACRC,EAAKF,EAAIG,KAAK,MAAMC,MAAM,IAC9BP,GAAMQ,MACFH,GAAMA,EAAG,GACTI,KAAQN,EAAIb,KAAK,gDAAgDoB,MACjEC,MAASR,EAAIb,KAAK,iDAAiDoB,MACnEE,aAAgBT,EAAIb,KAAK,uDAAuDoB,MAChFT,SAAYH,EAAkBK,EAAIb,KAAK,aAGxCU,GAEXa,EAAUjB,EAAE,oBAEhBiB,GAAQC,SAAS,qBACjBD,EAAQE,gBACJC,OAAQ,cACRhB,MAAO,gBACPiB,iBAAkB,QAClBC,YAAa,kBACbC,UAAW,UACXC,sBAAsB,EACtBC,OAAQ,QACRC,KAAM,IACNC,OAAQ,WACJ5B,IACAC,EAAE4B,aAAaC,uBAGvBZ,EAAQvB,KAAK,eAAeY,KAAK,WAC7Bd,EAAkBQ,EAAEQ,SAExBX,EAAkBoB,GAClBA,EAAQvB,KAAK,aAAaY,KAAK,WAC3BT,EAAkBG,EAAEQ,SAGxBS,EAAQa,GAAG,QAAS,qBAAsB,SAAUC,GAChDA,EAAGC,gBACH,IAAIC,GAAcjC,EAAEA,EAAE,6BAA6Bc,OAC/CoB,EAASlC,EAAEQ,MAAM2B,QAAQ,oBAAoBC,OACjDF,GAAOG,OAAOJ,GACdzC,EAAkByC,GAClBpC,EAAkBoC,EAAYvC,KAAK,cACnCuC,EAAYvC,KAAK,mBAAmB4C,QAAQ,SAC5CL,EAAYvC,KAAK,kCAAkC6C,QACnDxC,MAGJkB,EAAQa,GAAG,QAAS,iBAAkB,SAAUC,GAC5C,GAAIS,GAAQxC,EAAEQ,KACduB,GAAGC,iBACHS,QAAQC,QAAQnD,IAAI,QAAS,yBAA0B,SAAUoD,GACzDA,IACA5C,IACAyC,EAAML,QAAQ,iBAAiBC,QAAQQ,SACvC5C,EAAE4B,aAAaC,yBAK3BZ,EAAQa,GAAG,QAAS,kBAAmB,SAAUC,GAC7ChC,IACAgC,EAAGC,gBACH,IAAIzB,GAAMP,EAAEQ,MAAM2B,QAAQ,iBAAiBC,OAC3C7B,GAAIW,SAAS,WACbX,EAAIb,KAAK,gDAAgD6C,QAAQM,WAGrE5B,EAAQa,GAAG,SAAU,sBAAuB,SAAUC,GAClDhC,GACA,IAAIQ,GAAMP,EAAEQ,MAAM2B,QAAQ,iBAAiBC,QACvCU,EAAQ9C,EAAEQ,MACVuC,EAAWD,EAAMpD,KAAK,qBAAqBoB,MAC3CkC,EAAUF,EAAMpD,KAAK,oBAAoBoB,KAC7CiB,GAAGC,iBACHzB,EAAIN,YAAY,WAChBM,EAAI0C,KAAK,OAAQD,GACjBzC,EAAIb,KAAK,oBAAoBwD,KAAKF,GAClCzC,EAAIb,KAAK,qBAAqBwD,KAAKH,GACnC/C,EAAE4B,aAAaC,sBAGnB7B,EAAE,2BAA2BmD,OAAO,WAChC,GAAIF,GAAO/C,EAAkBF,EAAE,qBAC/BA,GAAEQ,MAAMd,KAAK,oBAAoBoB,IAAIsC,KAAKC,UAAUJ,MAGhE,MAAA7D,KAEA,IAAIA","file":"AgendaEdit.js","sourcesContent":["/// <reference path=\"../../../typings/nestedSortable/index.d.ts\" />\n\ninterface JQueryStatic {\n    Antragsgruen: any;\n}\n\nclass AgendaEdit {\n    constructor() {\n        let adderClasses = 'agendaItemAdder mjs-nestedSortable-no-nesting mjs-nestedSortable-disabled',\n            adder = '<li class=\"' + adderClasses + '\"><a href=\"#\"><span class=\"glyphicon glyphicon-plus-sign\"></span> ' +\n                __t('admin', 'agendaAddEntry') + '</a></li>',\n            prepareAgendaItem = function ($item) {\n                $item.find('> div').prepend('<span class=\"glyphicon glyphicon-resize-vertical moveHandle\"></span>');\n                $item.find('> div > h3').append('<a href=\"#\" class=\"editAgendaItem\"><span class=\"glyphicon glyphicon-pencil\"></span></a>');\n                $item.find('> div > h3').append('<a href=\"#\" class=\"delAgendaItem\"><span class=\"glyphicon glyphicon-minus-sign\"></span></a>');\n            },\n            prepareAgendaList = function ($list) {\n                $list.append(adder);\n            },\n            showSaver = function () {\n                $('#agendaEditSavingHolder').removeClass(\"hidden\");\n            },\n            buildAgendaStruct = function ($ol) {\n                let items = [];\n                $ol.children('.agendaItem').each(function () {\n                    let $li = $(this),\n                        id = $li.attr('id').split('_');\n                    items.push({\n                        'id': id[1],\n                        'code': $li.find('> div > .agendaItemEditForm input[name=code]').val(),\n                        'title': $li.find('> div > .agendaItemEditForm input[name=title]').val(),\n                        'motionTypeId': $li.find('> div > .agendaItemEditForm select[name=motionType]').val(),\n                        'children': buildAgendaStruct($li.find('> ol'))\n                    });\n                });\n                return items;\n            },\n            $agenda = $('.motionListAgenda');\n\n        $agenda.addClass('agendaListEditing');\n        $agenda.nestedSortable({\n            handle: '.moveHandle',\n            items: 'li.agendaItem',\n            toleranceElement: '> div',\n            placeholder: 'movePlaceholder',\n            tolerance: 'pointer',\n            forcePlaceholderSize: true,\n            helper: 'clone',\n            axis: 'y',\n            update: function () {\n                showSaver();\n                $.Antragsgruen.recalcAgendaCodes();\n            }\n        });\n        $agenda.find('.agendaItem').each(function () {\n            prepareAgendaItem($(this));\n        });\n        prepareAgendaList($agenda);\n        $agenda.find('ol.agenda').each(function () {\n            prepareAgendaList($(this));\n        });\n\n        $agenda.on('click', '.agendaItemAdder a', function (ev) {\n            ev.preventDefault();\n            let $newElement = $($('#agendaNewElementTemplate').val()),\n                $adder = $(this).parents('.agendaItemAdder').first();\n            $adder.before($newElement);\n            prepareAgendaItem($newElement);\n            prepareAgendaList($newElement.find('ol.agenda'));\n            $newElement.find('.editAgendaItem').trigger('click');\n            $newElement.find('.agendaItemEditForm input.code').focus();\n            showSaver();\n        });\n\n        $agenda.on('click', '.delAgendaItem', function (ev) {\n            let $this = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t(\"admin\", \"agendaDelEntryConfirm\"), function (result) {\n                if (result) {\n                    showSaver();\n                    $this.parents('li.agendaItem').first().remove();\n                    $.Antragsgruen.recalcAgendaCodes();\n                }\n            });\n        });\n\n        $agenda.on('click', '.editAgendaItem', function (ev) {\n            showSaver();\n            ev.preventDefault();\n            let $li = $(this).parents('li.agendaItem').first();\n            $li.addClass('editing');\n            $li.find('> div > .agendaItemEditForm input[name=code]').focus().select();\n        });\n\n        $agenda.on('submit', '.agendaItemEditForm', function (ev) {\n            showSaver();\n            let $li = $(this).parents('li.agendaItem').first(),\n                $form = $(this),\n                newTitle = $form.find('input[name=title]').val(),\n                newCode = $form.find('input[name=code]').val();\n            ev.preventDefault();\n            $li.removeClass('editing');\n            $li.data('code', newCode);\n            $li.find('> div > h3 .code').text(newCode);\n            $li.find('> div > h3 .title').text(newTitle);\n            $.Antragsgruen.recalcAgendaCodes();\n        });\n\n        $('#agendaEditSavingHolder').submit(function () {\n            let data = buildAgendaStruct($('.motionListAgenda'));\n            $(this).find('input[name=data]').val(JSON.stringify(data));\n        });\n    }\n}\n\nnew AgendaEdit();\n"]}