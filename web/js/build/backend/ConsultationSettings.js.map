{"version":3,"sources":["backend/ConsultationSettings.ts"],"names":["ConsultationSettings","$form","this","initLogoUpload","initUrlPath","initTags","initAdminMayEdit","initSingleMotionMode","$","tooltip","prototype","click","ev","preventDefault","addClass","removeClass","change","prop","$adminsMayEdit","$iniatorsMayEdit","parents","first","parent","confirmMessage","__t","bootbox","confirm","result","find","_this","submit","i","items","pillbox","tags","$node","length","push","id","name","text","attr","JSON","stringify","append","Sortable","create","document","getElementById","draggable","$logoRow","$uploadLabel","on","src","currentTarget","val","prepend","data","path","split","filename","exports"],"mappings":"yGAIA,IAAAA,EAAA,WACI,SAAAA,EAAoBC,GAAAC,KAAAD,MAAAA,EAChBC,KAAKC,iBACLD,KAAKE,cACLF,KAAKG,WACLH,KAAKI,mBACLJ,KAAKK,uBAELC,EAAE,2BAA2BC,UAoFrC,OAjFYT,EAAAU,UAAAN,YAAR,WACII,EAAE,4BAA4BG,MAAM,SAAUC,GAC1CA,EAAGC,iBACHL,EAAE,0BAA0BM,SAAS,UACrCN,EAAE,0BAA0BO,YAAY,aAIxCf,EAAAU,UAAAH,qBAAR,WACIC,EAAE,qBAAqBQ,OAAO,WACtBR,EAAEN,MAAMe,KAAK,WACbT,EAAE,mBAAmBO,YAAY,UAEjCP,EAAE,mBAAmBM,SAAS,YAEnCE,UAGChB,EAAAU,UAAAJ,iBAAR,WACI,IAAIY,EAAiBV,EAAE,kBACnBW,EAAmBX,EAAE,oBAAoBY,QAAQ,SAASC,QAAQC,SACtEJ,EAAeF,OAAO,WAClB,GAAIR,EAAEN,MAAMe,KAAK,WACbE,EAAiBJ,YAAY,cAC1B,CACH,IAAIQ,EAAiBC,IAAI,QAAS,uBAClCC,QAAQC,QAAQH,EAAgB,SAAUI,GAClCA,GACAR,EAAiBL,SAAS,UAC1BK,EAAiBS,KAAK,SAASX,KAAK,WAAW,IAE/CC,EAAeD,KAAK,WAAW,QAK1CC,EAAeD,KAAK,YAAYE,EAAiBL,SAAS,WAG3Dd,EAAAU,UAAAL,SAAR,WAAA,IAAAwB,EAAA3B,KACIA,KAAKD,MAAM6B,OAAO,WACd,IAGIC,EAHAC,EAAQxB,EAAE,aAAayB,QAAQ,SAC/BC,EAAO,GACPC,EAAQ3B,EAAE,qCAEd,IAAKuB,EAAI,EAAGA,EAAIC,EAAMI,OAAQL,SACE,IAAhBC,EAAMD,GAAK,GACnBG,EAAKG,KAAK,CAACC,GAAM,EAAGC,KAAQP,EAAMD,GAAGS,OAErCN,EAAKG,KAAK,CAACC,GAAMN,EAAMD,GAAGO,GAAIC,KAAQP,EAAMD,GAAGS,OAGvDL,EAAMM,KAAK,QAASC,KAAKC,UAAUT,IACnCL,EAAK5B,MAAM2C,OAAOT,KAGtBU,SAASC,OAAOC,SAASC,eAAe,cAAe,CAACC,UAAW,WAG/DjD,EAAAU,UAAAP,eAAR,WACI,IAAM+C,EAAWhD,KAAKD,MAAM2B,KAAK,YAC7BuB,EAAeD,EAAStB,KAAK,0BACjCsB,EAASE,GAAG,QAAS,oBAAqB,SAAAxC,GACtCA,EAAGC,iBACH,IAAMwC,EAAM7C,EAAEI,EAAG0C,eAAe1B,KAAK,OAAOa,KAAK,OACjDS,EAAStB,KAAK,gCAAgC2B,IAAIF,GACD,IAA7CH,EAAStB,KAAK,oBAAoBQ,QAClCc,EAASM,QAAQ,uBAErBN,EAAStB,KAAK,oBAAoBa,KAAK,MAAOY,GAAKtC,YAAY,UAC/DoC,EAAaX,KAAKW,EAAaM,KAAK,UACpCP,EAAStB,KAAK,oBAAoB2B,IAAI,MAE1CL,EAAStB,KAAK,oBAAoBZ,OAAO,WACrC,IAAM0C,EAAOR,EAAStB,KAAK,oBAAoB2B,MAAMI,MAAM,MACrDC,EAAWF,EAAKA,EAAKtB,OAAS,GACpCc,EAAStB,KAAK,gCAAgC2B,IAAI,IAClDL,EAAStB,KAAK,oBAAoBd,SAAS,UAC3CqC,EAAaX,KAAKoB,MAG9B5D,EA5FA,GAAa6D,EAAA7D,qBAAAA","file":"ConsultationSettings.js","sourcesContent":["/// <reference path=\"../typings/fuelux/index.d.ts\" />\n\ndeclare let Sortable: any;\n\nexport class ConsultationSettings {\n    constructor(private $form: JQuery) {\n        this.initLogoUpload();\n        this.initUrlPath();\n        this.initTags();\n        this.initAdminMayEdit();\n        this.initSingleMotionMode();\n\n        $('[data-toggle=\"tooltip\"]').tooltip();\n    }\n\n    private initUrlPath() {\n        $('.urlPathHolder .shower a').click(function (ev) {\n            ev.preventDefault();\n            $('.urlPathHolder .shower').addClass('hidden');\n            $('.urlPathHolder .holder').removeClass('hidden');\n        });\n    }\n\n    private initSingleMotionMode() {\n        $(\"#singleMotionMode\").change(function () {\n            if ($(this).prop(\"checked\")) {\n                $(\"#forceMotionRow\").removeClass(\"hidden\");\n            } else {\n                $(\"#forceMotionRow\").addClass(\"hidden\");\n            }\n        }).change();\n    }\n\n    private initAdminMayEdit() {\n        let $adminsMayEdit = $(\"#adminsMayEdit\"),\n            $iniatorsMayEdit = $(\"#iniatorsMayEdit\").parents(\"label\").first().parent();\n        $adminsMayEdit.change(function () {\n            if ($(this).prop(\"checked\")) {\n                $iniatorsMayEdit.removeClass(\"hidden\");\n            } else {\n                let confirmMessage = __t(\"admin\", \"adminMayEditConfirm\");\n                bootbox.confirm(confirmMessage, function (result) {\n                    if (result) {\n                        $iniatorsMayEdit.addClass(\"hidden\");\n                        $iniatorsMayEdit.find(\"input\").prop(\"checked\", false);\n                    } else {\n                        $adminsMayEdit.prop(\"checked\", true);\n                    }\n                });\n            }\n        });\n        if (!$adminsMayEdit.prop(\"checked\")) $iniatorsMayEdit.addClass(\"hidden\");\n    }\n\n    private initTags() {\n        this.$form.submit(() => {\n            let items = $(\"#tagsList\").pillbox('items'),\n                tags = [],\n                $node = $('<input type=\"hidden\" name=\"tags\">'),\n                i;\n            for (i = 0; i < items.length; i++) {\n                if (typeof (items[i].id) == 'undefined') {\n                    tags.push({\"id\": 0, \"name\": items[i].text});\n                } else {\n                    tags.push({\"id\": items[i].id, \"name\": items[i].text});\n                }\n            }\n            $node.attr(\"value\", JSON.stringify(tags));\n            this.$form.append($node);\n        });\n\n        Sortable.create(document.getElementById(\"tagsListUl\"), {draggable: '.pill'});\n    }\n\n    private initLogoUpload() {\n        const $logoRow = this.$form.find('.logoRow'),\n            $uploadLabel = $logoRow.find('.uploadCol label .text');\n        $logoRow.on('click', '.imageChooserDd a', ev => {\n            ev.preventDefault();\n            const src = $(ev.currentTarget).find(\"img\").attr(\"src\");\n            $logoRow.find('input[name=consultationLogo]').val(src);\n            if ($logoRow.find('.logoPreview img').length === 0) {\n                $logoRow.prepend('<img src=\"\" alt=\"\">');\n            }\n            $logoRow.find('.logoPreview img').attr('src', src).removeClass('hidden');\n            $uploadLabel.text($uploadLabel.data('title'));\n            $logoRow.find(\"input[type=file]\").val('');\n        });\n        $logoRow.find(\"input[type=file]\").change(() => {\n            const path = $logoRow.find(\"input[type=file]\").val().split('\\\\');\n            const filename = path[path.length - 1];\n            $logoRow.find('input[name=consultationLogo]').val('');\n            $logoRow.find(\".logoPreview img\").addClass('hidden');\n            $uploadLabel.text(filename);\n        });\n    }\n}\n"]}