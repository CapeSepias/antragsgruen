{"version":3,"sources":["backend/AmendmentEdit.ts"],"names":["AmendmentEdit","this","lang","$","attr","$editTextCaller","datetimepicker","locale","data","format","find","on","textEditCalled","bind","ev","$text","currentTarget","parents","window","setData","addClass","confirmed","$form","preventDefault","bootbox","confirm","__t","result","trigger","initVotingFunctions","MotionSupporterEdit_1","MotionSupporterEdit","prototype","textEditCalledMultiPara","each","$textarea","ckeditor","AntragsgruenEditor_1","AntragsgruenEditor","getEditor","parent","val","getData","plugins","lite","findPlugin","acceptAll","removeClass","AmendmentEditSinglePara_1","AmendmentEditSinglePara","append","$closer","$opener","$inputRows","exports"],"mappings":"yPAMA,IAAAA,EAAA,WAkDI,SAAAA,IACIC,KAAKC,KAAOC,EAAE,QAAQC,KAAK,QAC3BH,KAAKI,gBAAkBF,EAAE,4BAEzBA,EAAE,gCAAgCG,eAAe,CAC7CC,OAAQN,KAAKC,OAEjBC,EAAE,kCAAkCG,eAAe,CAC/CC,OAAQN,KAAKC,OAEjBC,EAAE,yBAAyBG,eAAe,CACtCC,OAAQJ,EAAE,mBAAmBK,KAAK,UAClCC,OAAQ,MAGZR,KAAKI,gBAAgBK,KAAK,UAAUC,GAAG,QAASV,KAAKW,eAAeC,KAAKZ,OAEzEE,EAAE,gCAAgCQ,GAAG,QAAS,SAACG,GAC3C,IAAIC,EAAgBZ,EAAEW,EAAGE,eAAeC,QAAQ,qBAAqBP,KAAK,eAC1EQ,OAAiB,SAAa,UAAEH,EAAMX,KAAK,OAAOe,QAAQJ,EAAMP,KAAK,kBAErEL,EAAEW,EAAGE,eAAeC,QAAQ,oBAAoBG,SAAS,YAG7DjB,EAAE,wBAAwBQ,GAAG,SAAU,SAAUG,EAAIN,GACjD,IAAIA,IAAgBA,EAAc,UAAtB,KAA8C,IAAnBA,EAAKa,UAA5C,CAGA,IAAIC,EAAQnB,EAAEF,MACda,EAAGS,iBACHC,QAAQC,QAAQC,IAAI,QAAS,uBAAwB,SAAUC,GACvDA,GACAL,EAAMM,QAAQ,SAAU,CAACP,WAAa,SAKlDpB,KAAK4B,sBAEL,IAAIC,EAAAC,oBAAoB5B,EAAE,2BAElC,OAtFYH,EAAAgC,UAAAC,wBAAR,WACI9B,EAAE,qBAAqB+B,KAAK,WACxB,IACIC,EADUhC,EAAEF,MACQS,KAAK,eAGzB0B,EAD6B,IAAIC,EAAAC,mBAAmBH,EAAU/B,KAAK,OACzCmC,YAE9BJ,EAAUlB,QAAQ,QAAQN,GAAG,SAAU,WACnCwB,EAAUK,SAAS9B,KAAK,gBAAgB+B,IAAIL,EAASM,gBACf,IAA1BN,EAASO,QAAY,OAC7BP,EAASO,QAAQC,KAAKC,WAAWT,GAAUU,YAC3CX,EAAUK,SAAS9B,KAAK,yBAAyB+B,IAAIL,EAASM,iBAMtE1C,EAAAgC,UAAApB,eAAR,WACIX,KAAKI,gBAAgBe,SAAS,UAC9BjB,EAAE,4BAA4B4C,YAAY,UACtC9C,KAAKI,gBAAgBG,KAAK,uBAC1BP,KAAKgC,0BAEL,IAAIe,EAAAC,wBAER9C,EAAE,wBAAwB+C,OAAO,oDAG7BlD,EAAAgC,UAAAH,oBAAR,WACI,IAAMsB,EAAUhD,EAAE,uBACdiD,EAAUjD,EAAE,uBACZkD,EAAalD,EAAE,qDACnBiD,EAAQzC,GAAG,QAAS,WAChBwC,EAAQJ,YAAY,UACpBK,EAAQhC,SAAS,UACjBiC,EAAWN,YAAY,YAE3BI,EAAQxC,GAAG,QAAS,WAChBwC,EAAQ/B,SAAS,UACjBgC,EAAQL,YAAY,UACpBM,EAAWjC,SAAS,aA6ChCpB,EA3FA,GAAasD,EAAAtD,cAAAA","file":"AmendmentEdit.js","sourcesContent":["import \"./MotionSupporterEdit\";\nimport { MotionSupporterEdit } from \"./MotionSupporterEdit\";\nimport { AntragsgruenEditor } from \"../shared/AntragsgruenEditor\";\nimport editor = CKEDITOR.editor;\nimport { AmendmentEditSinglePara } from \"../shared/AmendmentEditSinglePara\";\n\nexport class AmendmentEdit {\n    private lang: string;\n\n    private $editTextCaller: JQuery;\n\n    private textEditCalledMultiPara() {\n        $(\".wysiwyg-textarea\").each(function () {\n            let $holder = $(this),\n                $textarea = $holder.find(\".texteditor\");\n\n            let editor: AntragsgruenEditor = new AntragsgruenEditor($textarea.attr(\"id\")),\n                ckeditor: editor = editor.getEditor();\n\n            $textarea.parents(\"form\").on(\"submit\", function () {\n                $textarea.parent().find(\"textarea.raw\").val(ckeditor.getData());\n                if (typeof (ckeditor.plugins.lite) != 'undefined') {\n                    ckeditor.plugins.lite.findPlugin(ckeditor).acceptAll();\n                    $textarea.parent().find(\"textarea.consolidated\").val(ckeditor.getData());\n                }\n            });\n        });\n    }\n\n    private textEditCalled() {\n        this.$editTextCaller.addClass(\"hidden\");\n        $(\"#amendmentTextEditHolder\").removeClass(\"hidden\");\n        if (this.$editTextCaller.data(\"multiple-paragraphs\")) {\n            this.textEditCalledMultiPara();\n        } else {\n            new AmendmentEditSinglePara();\n        }\n        $(\"#amendmentUpdateForm\").append(\"<input type='hidden' name='edittext' value='1'>\");\n    };\n\n    private initVotingFunctions() {\n        const $closer = $(\".votingResultCloser\"),\n            $opener = $(\".votingResultOpener\"),\n            $inputRows = $(\".contentVotingResult, .contentVotingResultComment\");\n        $opener.on(\"click\", () => {\n            $closer.removeClass(\"hidden\");\n            $opener.addClass(\"hidden\");\n            $inputRows.removeClass(\"hidden\");\n        });\n        $closer.on(\"click\", () => {\n            $closer.addClass(\"hidden\");\n            $opener.removeClass(\"hidden\");\n            $inputRows.addClass(\"hidden\");\n        });\n    }\n\n    constructor() {\n        this.lang = $(\"html\").attr(\"lang\");\n        this.$editTextCaller = $(\"#amendmentTextEditCaller\");\n\n        $(\"#amendmentDateCreationHolder\").datetimepicker({\n            locale: this.lang\n        });\n        $(\"#amendmentDateResolutionHolder\").datetimepicker({\n            locale: this.lang\n        });\n        $('#resolutionDateHolder').datetimepicker({\n            locale: $('#resolutionDate').data('locale'),\n            format: 'L'\n        });\n\n        this.$editTextCaller.find(\"button\").on(\"click\", this.textEditCalled.bind(this));\n\n        $('.wysiwyg-textarea .resetText').on(\"click\", (ev) => {\n            let $text: JQuery = $(ev.currentTarget).parents('.wysiwyg-textarea').find('.texteditor');\n            window['CKEDITOR']['instances'][$text.attr('id')].setData($text.data('original-html'));\n\n            $(ev.currentTarget).parents('.modifiedActions').addClass('hidden');\n        });\n\n        $(\".amendmentDeleteForm\").on(\"submit\", function (ev, data) {\n            if (data && typeof (data.confirmed) && data.confirmed === true) {\n                return;\n            }\n            let $form = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t(\"admin\", \"delAmendmentConfirm\"), function (result) {\n                if (result) {\n                    $form.trigger(\"submit\", {'confirmed': true});\n                }\n            });\n        });\n\n        this.initVotingFunctions();\n\n        new MotionSupporterEdit($(\"#motionSupporterHolder\"));\n    }\n}\n"]}