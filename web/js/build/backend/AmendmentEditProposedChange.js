define(["require","exports","../shared/AntragsgruenEditor","../frontend/MotionMergeAmendments"],function(t,n,a,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AmendmentEditProposedChange=void 0;var e=function(){function n(t){this.$form=t,this.hasChanged=!1,this.textEditCalled(),this.initCollisionDetection(),t.on("submit",function(){$(window).off("beforeunload",n.onLeavePage)})}return n.prototype.textEditCalled=function(){var o=this;$(".wysiwyg-textarea:not(#sectionHolderEditorial)").each(function(t,n){var e=$(n).find(".texteditor"),i=new a.AntragsgruenEditor(e.attr("id")).getEditor();e.parents("form").on("submit",function(){e.parent().find("textarea.raw").val(i.getData()),void 0!==i.plugins.lite&&(i.plugins.lite.findPlugin(i).acceptAll(),e.parent().find("textarea.consolidated").val(i.getData()))}),$("#"+e.attr("id")).on("keypress",o.onContentChanged.bind(o))}),this.$form.find(".resetText").on("click",function(t){var n=$(t.currentTarget).parents(".wysiwyg-textarea").find(".texteditor");window.CKEDITOR.instances[n.attr("id")].setData(n.data("original-html")),$(t.currentTarget).parents(".modifiedActions").addClass("hidden")})},n.prototype.initCollisionDetection=function(){var e=this;this.$collisionIndicator=this.$form.find("#collisionIndicator");var i=null;window.setInterval(function(){var t=e.getTextConsolidatedSections();if(JSON.stringify(t)!==i){i=JSON.stringify(t);var n=e.$form.data("collision-check-url");$.post(n,{_csrf:e.$form.find("> input[name=_csrf]").val(),sections:t},function(t){if(0==t.collisions.length)e.$collisionIndicator.addClass("hidden");else{e.$collisionIndicator.removeClass("hidden");var n="";t.collisions.forEach(function(t){n+=t.html}),e.$collisionIndicator.find(".collisionList").html(n)}})}},5e3)},n.prototype.getTextConsolidatedSections=function(){var r={};return $(".proposedVersion .wysiwyg-textarea:not(#sectionHolderEditorial)").each(function(t,n){var e=$(n),i=e.find(".texteditor"),o=e.parents(".proposedVersion").data("section-id"),a=i.clone(!1);a.find(".ice-ins").each(function(t,n){s.MotionMergeChangeActions.insertAccept(n)}),a.find(".ice-del").each(function(t,n){s.MotionMergeChangeActions.deleteAccept(n)}),r[o]=a.html()}),r},n.onLeavePage=function(){return __t("std","leave_changed_page")},n.prototype.onContentChanged=function(){this.hasChanged||(this.hasChanged=!0,$("body").hasClass("testing")||$(window).on("beforeunload",n.onLeavePage))},n}();n.AmendmentEditProposedChange=e});
//# sourceMappingURL=AmendmentEditProposedChange.js.map
