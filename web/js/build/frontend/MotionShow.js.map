{"version":3,"sources":["frontend/MotionShow.ts"],"names":["MotionShow","MotionInitiatorShow","$paragraphs","$","find","click","this","showComment","bind","hideComment","filter","each","initParagraph","ev","preventDefault","addClass","removeClass","s","location","hash","split","length","scrollintoview","top_offset","submit","delSubmit","shareLinkClicked","prototype","form","target","bootbox","confirm","__t","result","currentTarget","attr","window","open","$node","$commentHolder","parents","first","parent","isOnScreen","$this","i","el","$paragraph","$paraFirstLine","lineHeight","height","amends","sort","el1","el2","data","append","$amendment","firstLine","targetOffset","$prevBookmark","prevAll","delta","$pre","parseInt","css","mouseover","mouseout"],"mappings":"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","file":"MotionShow.js","sourcesContent":["/// <reference path=\"../typings/jquery-typings.d.ts\" />\n\nimport '../shared/MotionInitiatorShow';\n\nclass MotionShow {\n\n    constructor() {\n        new MotionInitiatorShow();\n\n        let $paragraphs = $('.motionTextHolder .paragraph');\n        $paragraphs.find('.comment .shower').click(this.showComment.bind(this));\n        $paragraphs.find('.comment .hider').click(this.hideComment.bind(this));\n\n        $paragraphs.filter('.commentsOpened').find('.comment .shower').click();\n        $paragraphs.filter(':not(.commentsOpened)').find('.comment .hider').click();\n\n        $paragraphs.each(this.initParagraph.bind(this));\n\n\n        $('.tagAdderHolder').click(function (ev) {\n            ev.preventDefault();\n            $(this).addClass(\"hidden\");\n            $('#tagAdderForm').removeClass(\"hidden\");\n        });\n\n        let s = location.hash.split('#comm');\n        if (s.length == 2) {\n            $('#comment' + s[1]).scrollintoview({top_offset: -100});\n        }\n\n        $(\"form.delLink\").submit(this.delSubmit.bind(this));\n        $(\".share_buttons a\").click(this.shareLinkClicked.bind(this));\n    }\n\n    private delSubmit(ev) {\n        ev.preventDefault();\n        let form = ev.target;\n        bootbox.confirm(__t(\"std\", \"del_confirm\"), function (result) {\n            if (result) {\n                form.submit();\n            }\n        });\n    }\n\n    private shareLinkClicked(ev) {\n        let target = $(ev.currentTarget).attr(\"href\");\n        if (window.open(target, '_blank', 'width=600,height=460')) {\n            ev.preventDefault();\n        }\n    }\n\n    private showComment(ev) {\n        ev.preventDefault();\n        let $node = $(ev.currentTarget),\n            $commentHolder = $node.parents('.paragraph').first().find('.commentHolder');\n        $node.addClass('hidden');\n        $node.parent().find('.hider').removeClass('hidden');\n        $commentHolder.removeClass('hidden');\n        if (!$commentHolder.isOnScreen(0.1, 0.1)) {\n            $commentHolder.scrollintoview({top_offset: -100});\n        }\n    }\n\n    private hideComment(ev) {\n        let $this = $(ev.currentTarget);\n        $this.addClass('hidden');\n        $this.parent().find('.shower').removeClass('hidden');\n\n        $this.parents('.paragraph').first().find('.commentHolder').addClass('hidden');\n        ev.preventDefault();\n    }\n\n    private initParagraph(i, el) {\n        let $paragraph = $(el),\n            $paraFirstLine = $paragraph.find(\".lineNumber\").first(),\n            lineHeight = $paraFirstLine.height();\n\n        let amends = $paragraph.find(\".bookmarks > .amendment\");\n        amends = amends.sort(function (el1, el2) {\n            return $(el1).data(\"first-line\") - $(el2).data(\"first-line\");\n        });\n        $paragraph.find(\".bookmarks\").append(amends);\n\n        $paragraph.find('ul.bookmarks li.amendment').each(function () {\n            let $amendment = $(this),\n                firstLine = $amendment.data(\"first-line\"),\n                targetOffset = (firstLine - $paraFirstLine.data(\"line-number\")) * lineHeight,\n                $prevBookmark = $amendment.prevAll(),\n                delta = targetOffset;\n            $prevBookmark.each(function () {\n                let $pre = $(this);\n                delta -= $pre.height();\n                delta -= parseInt($pre.css(\"margin-top\"));\n                delta -= 7;\n            });\n            if (delta < 0) {\n                delta = 0;\n            }\n            $amendment.css('margin-top', delta + \"px\");\n\n            $amendment.mouseover(function () {\n                $paragraph.find(\"> .textOrig\").addClass(\"hidden\");\n                $paragraph.find(\"> .textAmendment\").addClass(\"hidden\");\n                $paragraph.find(\"> .textAmendment.amendment\" + $amendment.find(\"a\").data(\"id\")).removeClass(\"hidden\");\n            }).mouseout(function () {\n                $paragraph.find(\"> .textOrig\").removeClass(\"hidden\");\n                $paragraph.find(\"> .textAmendment\").addClass(\"hidden\");\n            });\n        });\n    }\n}\n\nnew MotionShow();"]}