define(["require","exports","./LineNumberHighlighting","../shared/MotionInitiatorShow"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),new(function(){function e(){new MotionInitiatorShow,new r.LineNumberHighlighting;var e=$(".motionTextHolder .paragraph");e.find(".comment .shower").click(this.showComment.bind(this)),e.find(".comment .hider").click(this.hideComment.bind(this)),e.filter(".commentsOpened").find(".comment .shower").click(),e.filter(":not(.commentsOpened)").find(".comment .hider").click(),e.each(this.initParagraph.bind(this)),$(".tagAdderHolder").click(function(e){e.preventDefault(),$(this).addClass("hidden"),$("#tagAdderForm").removeClass("hidden")});var t=location.hash.split("#comm");2==t.length&&$("#comment"+t[1]).scrollintoview({top_offset:-100}),$("form.delLink").submit(this.delSubmit.bind(this)),$(".share_buttons a").click(this.shareLinkClicked.bind(this)),this.markMovedParagraphs(),this.initPrivateComments()}return e.prototype.markMovedParagraphs=function(){$(".motionTextHolder .moved .moved").removeClass("moved"),$(".motionTextHolder .moved").each(function(){var e,t=$(this),r=t.data("moving-partner-paragraph"),n=t.parents(".paragraph").first().attr("id").split("_")[1],i=$("#section_"+n+"_"+r).find(".lineNumber").first().data("line-number");e=(e=t.hasClass("inserted")?__t("std","moved_paragraph_from_line"):__t("std","moved_paragraph_to_line")).replace(/##LINE##/,i).replace(/##PARA##/,r+1),"LI"===t[0].nodeName&&(t=t.parent());var a=$('<div class="movedParagraphHint"></div>');a.text(e),a.insertBefore(t)})},e.prototype.initPrivateComments=function(){0<$(".privateParagraph, .privateNote").length&&$(".privateParagraphNoteOpener").removeClass("hidden"),$(".privateNoteOpener").click(function(){$(".privateNoteOpener").remove(),$(".motionData .privateNotes").removeClass("hidden"),$(".motionData .privateNotes textarea").focus(),$(".privateParagraphNoteOpener").removeClass("hidden")}),$(".privateParagraphNoteOpener").click(function(e){$(e.currentTarget).addClass("hidden");var t=$(e.currentTarget).parents(".privateParagraphNoteHolder").find("form");t.removeClass("hidden"),t.find("textarea").focus()}),$(".privateNotes blockquote").click(function(){$(".privateNotes blockquote").addClass("hidden"),$(".privateNotes form").removeClass("hidden"),$(".privateNotes textarea").focus()}),$(".privateParagraphNoteHolder blockquote").click(function(e){var t=$(e.currentTarget).parents(".privateParagraphNoteHolder");t.find("blockquote").addClass("hidden"),t.find("form").removeClass("hidden"),t.find("textarea").focus()})},e.prototype.delSubmit=function(e){e.preventDefault();var t=e.target;bootbox.confirm(__t("std","del_confirm"),function(e){e&&t.submit()})},e.prototype.shareLinkClicked=function(e){var t=$(e.currentTarget).attr("href");window.open(t,"_blank","width=600,height=460")&&e.preventDefault()},e.prototype.showComment=function(e){e.preventDefault();var t=$(e.currentTarget),r=t.parents(".paragraph").first().find(".commentHolder");t.addClass("hidden"),t.parent().find(".hider").removeClass("hidden"),r.removeClass("hidden"),r.isOnScreen(.1,.1)||r.scrollintoview({top_offset:-100})},e.prototype.hideComment=function(e){var t=$(e.currentTarget);t.addClass("hidden"),t.parent().find(".shower").removeClass("hidden"),t.parents(".paragraph").first().find(".commentHolder").addClass("hidden"),e.preventDefault()},e.prototype.initParagraph=function(e,t){var i=$(t),a=i.find(".lineNumber").first(),o=a.height(),r=i.find(".bookmarks > .amendment");r=r.sort(function(e,t){return $(e).data("first-line")-$(t).data("first-line")}),i.find(".bookmarks").append(r),i.find("ul.bookmarks li.amendment").each(function(){var e=$(this),t=(e.data("first-line")-a.data("line-number"))*o,r=e.prevAll(),n=t;r.each(function(){var e=$(this);n-=e.height(),n-=parseInt(e.css("margin-top")),n-=7}),n<0&&(n=0),e.css("margin-top",n+"px"),e.mouseover(function(){i.find("> .textOrig").addClass("hidden"),i.find("> .textAmendment").addClass("hidden"),i.find("> .textAmendment.amendment"+e.find("a").data("id")).removeClass("hidden")}).mouseout(function(){i.find("> .textOrig").removeClass("hidden"),i.find("> .textAmendment").addClass("hidden")})})},e}())});
//# sourceMappingURL=MotionShow.js.map
