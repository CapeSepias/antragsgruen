define(["require","exports","./LineNumberHighlighting","../shared/MotionInitiatorShow"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var n=this;this.$element=e,this.activeAmendmentId=null,this.$paraFirstLine=e.find(".lineNumber").first(),this.lineHeight=this.$paraFirstLine.height();var t=e.find(".bookmarks > .amendment");t=t.sort(function(e,t){return $(e).data("first-line")-$(t).data("first-line")}),e.find(".bookmarks").append(t),e.find("ul.bookmarks li.amendment").each(function(e,t){n.initInlineAmendmentPosition($(t)),n.toggleInlineAmendmentBehavior($(t))})}return e.prototype.initInlineAmendmentPosition=function(e){var t=(e.data("first-line")-this.$paraFirstLine.data("line-number"))*this.lineHeight,n=e.prevAll(),i=t;n.each(function(){var e=$(this);i-=e.height(),i-=parseInt(e.css("margin-top")),i-=7}),i<0&&(i=0),e.css("margin-top",i+"px")},e.prototype.showInlineAmendment=function(e){this.activeAmendmentId&&this.hideInlineAmendment(this.activeAmendmentId),this.$element.find("> .textOrig").addClass("hidden"),this.$element.find("> .textAmendment").addClass("hidden"),this.$element.find("> .textAmendment.amendment"+e).removeClass("hidden"),this.$element.find(".bookmarks .amendment"+e).find("a").addClass("active"),this.activeAmendmentId=e},e.prototype.hideInlineAmendment=function(e){this.$element.find("> .textOrig").removeClass("hidden"),this.$element.find("> .textAmendment").addClass("hidden"),this.$element.find(".bookmarks .amendment"+e).find("a").removeClass("active"),this.activeAmendmentId=null},e.prototype.toggleInlineAmendmentBehavior=function(e){var t=this,n=e.find("a"),i=n.data("id");$("html").hasClass("touchevents")?n.on("click",function(e){e.preventDefault(),t.$element.find("> .textAmendment.amendment"+i).hasClass("hidden")?t.showInlineAmendment(i):t.hideInlineAmendment(i)}):e.on("mouseover",function(){t.showInlineAmendment(i)}).on("mouseout",function(){t.hideInlineAmendment(i)})},e}();new(function(){function e(){new MotionInitiatorShow,new n.LineNumberHighlighting;var e=$(".motionTextHolder .paragraph");e.find(".comment .shower").on("click",this.showComment.bind(this)),e.find(".comment .hider").on("click",this.hideComment.bind(this)),e.filter(".commentsOpened").find(".comment .shower").trigger("click"),e.filter(":not(.commentsOpened)").find(".comment .hider").trigger("click"),e.each(function(e,t){new i($(t))}),$(".tagAdderHolder").on("click",function(e){e.preventDefault(),$(this).addClass("hidden"),$("#tagAdderForm").removeClass("hidden")});var t=location.hash.split("#comm");2==t.length&&$("#comment"+t[1]).scrollintoview({top_offset:-100}),$("form.delLink").on("submit",this.delSubmit.bind(this)),$(".share_buttons a").on("click",this.shareLinkClicked.bind(this)),this.markMovedParagraphs(),this.initPrivateComments(),this.initCmdEnterSubmit()}return e.prototype.markMovedParagraphs=function(){$(".motionTextHolder .moved .moved").removeClass("moved"),$(".motionTextHolder .moved").each(function(){var e,t=$(this),n=t.data("moving-partner-paragraph"),i=t.parents(".paragraph").first().attr("id").split("_")[1],r=$("#section_"+i+"_"+n).find(".lineNumber").first().data("line-number");e=(e=t.hasClass("inserted")?__t("std","moved_paragraph_from_line"):__t("std","moved_paragraph_to_line")).replace(/##LINE##/,r).replace(/##PARA##/,n+1),"LI"===t[0].nodeName&&(t=t.parent());var a=$('<div class="movedParagraphHint"></div>');a.text(e),a.insertBefore(t)})},e.prototype.initPrivateComments=function(){0<$(".privateParagraph, .privateNote").length&&$(".privateParagraphNoteOpener").removeClass("hidden"),$(".privateNoteOpener").on("click",function(e){e.preventDefault(),$(".privateNoteOpener").remove(),$(".motionData .privateNotes").removeClass("hidden"),$(".motionData .privateNotes textarea").trigger("focus"),$(".privateParagraphNoteOpener").removeClass("hidden")}),$(".privateParagraphNoteOpener").on("click",function(e){$(e.currentTarget).addClass("hidden");var t=$(e.currentTarget).parents(".privateParagraphNoteHolder").find("form");t.removeClass("hidden"),t.find("textarea").trigger("focus")}),$(".privateNotes blockquote").on("click",function(){$(".privateNotes blockquote").addClass("hidden"),$(".privateNotes form").removeClass("hidden"),$(".privateNotes textarea").trigger("focus")}),$(".privateParagraphNoteHolder blockquote").on("click",function(e){var t=$(e.currentTarget).parents(".privateParagraphNoteHolder");t.find("blockquote").addClass("hidden"),t.find("form").removeClass("hidden"),t.find("textarea").trigger("focus")})},e.prototype.delSubmit=function(e){e.preventDefault();var t=e.target;bootbox.confirm(__t("std","del_confirm"),function(e){e&&t.submit()})},e.prototype.shareLinkClicked=function(e){var t=$(e.currentTarget).attr("href");window.open(t,"_blank","width=600,height=460")&&e.preventDefault()},e.prototype.showComment=function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parents(".paragraph").first().find(".commentHolder"),i=t.parent();t.addClass("hidden"),i.find(".hider").removeClass("hidden"),n.removeClass("hidden"),n.isOnScreen(.1,.1)||n.scrollintoview({top_offset:-100})},e.prototype.hideComment=function(e){var t=$(e.currentTarget),n=t.parent();t.addClass("hidden"),n.find(".shower").removeClass("hidden"),t.parents(".paragraph").first().find(".commentHolder").addClass("hidden"),e.preventDefault()},e.prototype.initCmdEnterSubmit=function(){$(document).on("keypress","form textarea",function(e){e.originalEvent.metaKey&&13===e.originalEvent.keyCode&&$(e.currentTarget).parents("form").first().find("button[type=submit]").trigger("click")})},e}())});
//# sourceMappingURL=MotionShow.js.map
