{"version":3,"sources":["frontend/ContentPageEdit.ts"],"names":["ContentPageEdit","$form","this","$textSaver","find","$textHolder","$editCaller","click","editCalled","bind","addClass","save","prototype","ev","_this","preventDefault","attr","editor","CKEDITOR","inline","scayt_sLang","removePlugins","extraPlugins","uploadUrl","data","filebrowserBrowseUrl","toolbarGroups","name","groups","on","evt","val","focus","removeClass","$","post","getData","_csrf","ret","window","setTimeout","destroy","alert","exports"],"mappings":"yGAEA,IAAAA,EAAA,WAMI,SAAAA,EAAoBC,GAAAC,KAAAD,MAAAA,EAChBC,KAAKC,WAAaF,EAAMG,KAAK,cAC7BF,KAAKG,YAAcJ,EAAMG,KAAK,eAC9BF,KAAKI,YAAcL,EAAMG,KAAK,eAE9BF,KAAKI,YAAYC,MAAML,KAAKM,WAAWC,KAAKP,OAC5CA,KAAKC,WAAWO,SAAS,UACzBR,KAAKC,WAAWC,KAAK,UAAUG,MAAML,KAAKS,KAAKF,KAAKP,OAuD5D,OApDYF,EAAAY,UAAAJ,WAAR,SAAmBK,GAAnB,IAAAC,EAAAZ,KACIW,EAAGE,iBACHb,KAAKI,YAAYI,SAAS,UAC1BR,KAAKG,YAAYW,KAAK,kBAAmB,QAEzCd,KAAKe,OAASC,SAASC,OAAOjB,KAAKG,YAAYW,KAAK,OAChDI,YAAa,QACbC,cAAe,uCACfC,aAAc,cACdC,UAAWrB,KAAKD,MAAMuB,KAAK,cAC3BC,qBAAsBvB,KAAKD,MAAMuB,KAAK,oBAEtCE,gBACKC,KAAM,cAAeC,QAAS,cAAe,aAC7CD,KAAM,WACNA,KAAM,UACNA,KAAM,WACNA,KAAM,WACNA,KAAM,SACP,KACCA,KAAM,WACNA,KAAM,YAAaC,QAAS,OAAQ,SAAU,SAAU,QAAS,YAG1E1B,KAAKe,OAAOY,GAAG,oBAAqB,SAACC,GACjCA,EAAIN,KAAkB,YAAS,MAAIV,EAAKb,MAAMG,KAAK,uBAAuB2B,QAG9E7B,KAAKG,YAAY2B,QACjB9B,KAAKC,WAAW8B,YAAY,WAGxBjC,EAAAY,UAAAD,KAAR,SAAaE,GAAb,IAAAC,EAAAZ,KACIW,EAAGE,iBAEHmB,EAAEC,KAAKjC,KAAKD,MAAMe,KAAK,WACnBQ,KAAQtB,KAAKe,OAAOmB,UACpBC,MAASnC,KAAKD,MAAMG,KAAK,uBAAuB2B,OACjD,SAACO,GACW,KAAPA,GACAC,OAAOC,WAAW,WACd1B,EAAKG,OAAOwB,WACb,KACH3B,EAAKX,WAAWO,SAAS,UACzBI,EAAKT,YAAYW,KAAK,kBAAmB,SACzCF,EAAKR,YAAY2B,YAAY,WAE7BS,MAAM,8BAKtB1C,EApEA,GAAa2C,EAAA3C,gBAAAA","file":"ContentPageEdit.js","sourcesContent":["import editor = CKEDITOR.editor;\n\nexport class ContentPageEdit {\n    private $editCaller: JQuery;\n    private $textHolder: JQuery;\n    private $textSaver: JQuery;\n    private editor: editor;\n\n    constructor(private $form: JQuery) {\n        this.$textSaver = $form.find('.textSaver');\n        this.$textHolder = $form.find('.textHolder');\n        this.$editCaller = $form.find('.editCaller');\n\n        this.$editCaller.click(this.editCalled.bind(this));\n        this.$textSaver.addClass('hidden');\n        this.$textSaver.find('button').click(this.save.bind(this));\n    }\n\n    private editCalled(ev) {\n        ev.preventDefault();\n        this.$editCaller.addClass('hidden');\n        this.$textHolder.attr('contenteditable', \"true\");\n\n        this.editor = CKEDITOR.inline(this.$textHolder.attr('id'), {\n            scayt_sLang: 'de_DE',\n            removePlugins: 'lite,showbloks,about,selectall,forms',\n            extraPlugins: 'uploadimage',\n            uploadUrl: this.$form.data('upload-url'),\n            filebrowserBrowseUrl: this.$form.data('image-browse-url'),\n            //filebrowserUploadUrl: '/uploader/upload.php?type=Files',\n            toolbarGroups: [\n                {name: 'basicstyles', groups: ['basicstyles', 'cleanup']},\n                {name: 'colors'},\n                {name: 'links'},\n                {name: 'insert'},\n                {name: 'others'},\n                {name: 'tools'},\n                '/',\n                {name: 'styles'},\n                {name: 'paragraph', groups: ['list', 'indent', 'blocks', 'align', 'bidi']}\n            ]\n        });\n        this.editor.on('fileUploadRequest', (evt) => {\n            evt.data['requestData']['_csrf'] = this.$form.find('> input[name=_csrf]').val();\n        });\n\n        this.$textHolder.focus();\n        this.$textSaver.removeClass('hidden');\n    }\n\n    private save(ev) {\n        ev.preventDefault();\n\n        $.post(this.$form.attr('action'), {\n            'data': this.editor.getData(),\n            '_csrf': this.$form.find('> input[name=_csrf]').val()\n        }, (ret) => {\n            if (ret == '1') {\n                window.setTimeout(() => {\n                    this.editor.destroy();\n                }, 100);\n                this.$textSaver.addClass('hidden');\n                this.$textHolder.attr('contenteditable', 'false');\n                this.$editCaller.removeClass('hidden');\n            } else {\n                alert('Something went wrong...');\n            }\n        })\n\n    }\n}\n"]}