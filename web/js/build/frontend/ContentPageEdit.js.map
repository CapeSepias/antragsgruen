{"version":3,"sources":["frontend/ContentPageEdit.ts"],"names":["ContentPageEdit","$form","this","$textSaver","find","$textHolder","$editCaller","$contentSettings","click","editCalled","bind","addClass","save","length","initContentSettings","prototype","ev","_this","preventDefault","attr","editor","CKEDITOR","inline","scayt_sLang","removePlugins","extraPlugins","uploadUrl","data","filebrowserBrowseUrl","toolbarGroups","name","groups","on","evt","val","focus","removeClass","$input","$","currentTarget","replace","getData","_csrf","prop","post","ret","window","setTimeout","destroy","text","document","title","children","last","location","href","alert","exports"],"mappings":"yGAEA,IAAAA,EAAA,WAOI,SAAAA,EAAoBC,GAAAC,KAAAD,MAAAA,EAChBC,KAAKC,WAAaF,EAAMG,KAAK,cAC7BF,KAAKG,YAAcJ,EAAMG,KAAK,eAC9BF,KAAKI,YAAcL,EAAMG,KAAK,eAC9BF,KAAKK,iBAAmBN,EAAMG,KAAK,2BAEnCF,KAAKI,YAAYE,MAAMN,KAAKO,WAAWC,KAAKR,OAC5CA,KAAKC,WAAWQ,SAAS,UACzBT,KAAKC,WAAWC,KAAK,UAAUI,MAAMN,KAAKU,KAAKF,KAAKR,OAEhDA,KAAKK,iBAAiBM,OAAS,GAC/BX,KAAKY,sBAiFjB,OA7EYd,EAAAe,UAAAN,WAAR,SAAmBO,GAAnB,IAAAC,EAAAf,KACIc,EAAGE,iBACHhB,KAAKI,YAAYK,SAAS,UAC1BT,KAAKG,YAAYc,KAAK,kBAAmB,QAEzCjB,KAAKkB,OAASC,SAASC,OAAOpB,KAAKG,YAAYc,KAAK,OAChDI,YAAa,QACbC,cAAe,uCACfC,aAAc,cACdC,UAAWxB,KAAKD,MAAM0B,KAAK,cAC3BC,qBAAsB1B,KAAKD,MAAM0B,KAAK,oBAEtCE,gBACKC,KAAM,cAAeC,QAAS,cAAe,aAC7CD,KAAM,WACNA,KAAM,UACNA,KAAM,WACNA,KAAM,WACNA,KAAM,SACP,KACCA,KAAM,WACNA,KAAM,YAAaC,QAAS,OAAQ,SAAU,SAAU,QAAS,YAG1E7B,KAAKkB,OAAOY,GAAG,oBAAqB,SAACC,GACjCA,EAAIN,KAAkB,YAAS,MAAIV,EAAKhB,MAAMG,KAAK,uBAAuB8B,QAG9EhC,KAAKG,YAAY8B,QACjBjC,KAAKC,WAAWiC,YAAY,UAC5BlC,KAAKK,iBAAiB6B,YAAY,WAG9BpC,EAAAe,UAAAD,oBAAR,WACIZ,KAAKK,iBAAiBH,KAAK,mBAAmB4B,GAAG,wBAAyB,SAAChB,GACvE,IAAIqB,EAASC,EAAEtB,EAAGuB,eAClBF,EAAOH,IAAIG,EAAOH,MAAMM,QAAQ,kBAAmB,QAInDxC,EAAAe,UAAAH,KAAR,SAAaI,GAAb,IAAAC,EAAAf,KACIc,EAAGE,iBACH,IAAIS,GACAA,KAAQzB,KAAKkB,OAAOqB,UACpBC,MAASxC,KAAKD,MAAMG,KAAK,uBAAuB8B,OAEhDhC,KAAKK,iBAAiBM,OAAS,IAC/Bc,EAAU,IAAIzB,KAAKK,iBAAiBH,KAAK,mBAAmB8B,MAC5DP,EAAY,MAAIzB,KAAKK,iBAAiBH,KAAK,qBAAqB8B,MAChEP,EAAuB,iBAAKzB,KAAKK,iBAAiBH,KAAK,gCAAgCuC,KAAK,WAAa,EAAI,EAC7GhB,EAAa,OAAKzB,KAAKK,iBAAiBH,KAAK,sBAAsBuC,KAAK,WAAa,EAAI,GAG7FL,EAAEM,KAAK1C,KAAKD,MAAMkB,KAAK,UAAWQ,EAAM,SAACkB,GACjCA,EAAa,SACbC,OAAOC,WAAW,WACd9B,EAAKG,OAAO4B,WACb,KACH/B,EAAKd,WAAWQ,SAAS,UACzBM,EAAKZ,YAAYc,KAAK,kBAAmB,SACzCF,EAAKX,YAAY8B,YAAY,UAC7BnB,EAAKV,iBAAiBI,SAAS,UAE/B2B,EAAE,cAAcW,KAAKJ,EAAW,OAChCK,SAASC,MAAQN,EAAW,MAC5BP,EAAE,qBAAuBO,EAAQ,IAAGI,KAAKJ,EAAW,OACpDP,EAAE,eAAec,WAAWC,OAAOJ,KAAKJ,EAAW,OAE/CA,EAAgB,aAChBC,OAAOQ,SAASC,KAAOV,EAAgB,aAG3CW,MAAM,8BAKtBxD,EAnGA,GAAayD,EAAAzD,gBAAAA","file":"ContentPageEdit.js","sourcesContent":["import editor = CKEDITOR.editor;\n\nexport class ContentPageEdit {\n    private $editCaller: JQuery;\n    private $textHolder: JQuery;\n    private $textSaver: JQuery;\n    private $contentSettings: JQuery;\n    private editor: editor;\n\n    constructor(private $form: JQuery) {\n        this.$textSaver = $form.find('.textSaver');\n        this.$textHolder = $form.find('.textHolder');\n        this.$editCaller = $form.find('.editCaller');\n        this.$contentSettings = $form.find('.contentSettingsToolbar');\n\n        this.$editCaller.click(this.editCalled.bind(this));\n        this.$textSaver.addClass('hidden');\n        this.$textSaver.find('button').click(this.save.bind(this));\n\n        if (this.$contentSettings.length > 0) {\n            this.initContentSettings();\n        }\n    }\n\n    private editCalled(ev) {\n        ev.preventDefault();\n        this.$editCaller.addClass('hidden');\n        this.$textHolder.attr('contenteditable', \"true\");\n\n        this.editor = CKEDITOR.inline(this.$textHolder.attr('id'), {\n            scayt_sLang: 'de_DE',\n            removePlugins: 'lite,showbloks,about,selectall,forms',\n            extraPlugins: 'uploadimage',\n            uploadUrl: this.$form.data('upload-url'),\n            filebrowserBrowseUrl: this.$form.data('image-browse-url'),\n            //filebrowserUploadUrl: '/uploader/upload.php?type=Files',\n            toolbarGroups: [\n                {name: 'basicstyles', groups: ['basicstyles', 'cleanup']},\n                {name: 'colors'},\n                {name: 'links'},\n                {name: 'insert'},\n                {name: 'others'},\n                {name: 'tools'},\n                '/',\n                {name: 'styles'},\n                {name: 'paragraph', groups: ['list', 'indent', 'blocks', 'align', 'bidi']}\n            ]\n        });\n        this.editor.on('fileUploadRequest', (evt) => {\n            evt.data['requestData']['_csrf'] = this.$form.find('> input[name=_csrf]').val();\n        });\n\n        this.$textHolder.focus();\n        this.$textSaver.removeClass('hidden');\n        this.$contentSettings.removeClass('hidden');\n    }\n\n    private initContentSettings() {\n        this.$contentSettings.find('input[name=url]').on('keyup change keypress', (ev) => {\n            let $input = $(ev.currentTarget);\n            $input.val($input.val().replace(/[^\\w_\\-,\\.äöüß]/, ''));\n        });\n    }\n\n    private save(ev) {\n        ev.preventDefault();\n        let data = {\n            'data': this.editor.getData(),\n            '_csrf': this.$form.find('> input[name=_csrf]').val()\n        };\n        if (this.$contentSettings.length > 0) {\n            data['url'] = this.$contentSettings.find('input[name=url]').val();\n            data['title'] = this.$contentSettings.find('input[name=title]').val();\n            data['allConsultations'] = (this.$contentSettings.find('input[name=allConsultations]').prop('checked') ? 1 : 0);\n            data['inMenu'] = (this.$contentSettings.find('input[name=inMenu]').prop('checked') ? 1 : 0);\n        }\n\n        $.post(this.$form.attr('action'), data, (ret) => {\n            if (ret['success']) {\n                window.setTimeout(() => {\n                    this.editor.destroy();\n                }, 100);\n                this.$textSaver.addClass('hidden');\n                this.$textHolder.attr('contenteditable', 'false');\n                this.$editCaller.removeClass('hidden');\n                this.$contentSettings.addClass('hidden');\n\n                $(\".pageTitle\").text(ret['title']);\n                document.title = ret['title'];\n                $(\"#mainmenu .content\" + ret['id']).text(ret['title']);\n                $(\".breadcrumb\").children().last().text(ret['title']);\n\n                if (ret['redirectTo']) {\n                    window.location.href = ret['redirectTo'];\n                }\n            } else {\n                alert('Something went wrong...');\n            }\n        })\n\n    }\n}\n"]}