{"version":3,"sources":["frontend/ContentPageEdit.ts"],"names":["ContentPageEdit","$form","this","$textSaver","find","$textHolder","$editCaller","$contentSettings","on","editCalled","bind","addClass","save","length","initContentSettings","$","onSubmitDeleteForm","prototype","ev","_this","preventDefault","attr","editor","CKEDITOR","inline","scayt_sLang","removePlugins","extraPlugins","uploadUrl","data","filebrowserBrowseUrl","toolbarGroups","name","groups","evt","val","trigger","removeClass","$input","currentTarget","replace","getData","_csrf","prop","post","ret","window","setTimeout","destroy","text","document","title","children","last","alert","location","href","confirmed","bootbox","confirm","__t","result","exports"],"mappings":"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","file":"ContentPageEdit.js","sourcesContent":["import editor = CKEDITOR.editor;\n\nexport class ContentPageEdit {\n    private $editCaller: JQuery;\n    private $textHolder: JQuery;\n    private $textSaver: JQuery;\n    private $contentSettings: JQuery;\n    private editor: editor;\n\n    constructor(private $form: JQuery) {\n        this.$textSaver = $form.find('.textSaver');\n        this.$textHolder = $form.find('.textHolder');\n        this.$editCaller = $form.find('.editCaller');\n        this.$contentSettings = $form.find('.contentSettingsToolbar');\n\n        this.$editCaller.on(\"click\", this.editCalled.bind(this));\n        this.$textSaver.addClass('hidden');\n        this.$textSaver.find('button').on(\"click\", this.save.bind(this));\n\n        if (this.$contentSettings.length > 0) {\n            this.initContentSettings();\n        }\n\n        $(\".deletePageForm\").on(\"submit\", this.onSubmitDeleteForm.bind(this));\n    }\n\n    private editCalled(ev) {\n        ev.preventDefault();\n        this.$editCaller.addClass('hidden');\n        this.$textHolder.attr('contenteditable', \"true\");\n\n        this.editor = CKEDITOR.inline(this.$textHolder.attr('id'), {\n            scayt_sLang: 'de_DE',\n            removePlugins: 'lite,showbloks,about,selectall,forms',\n            extraPlugins: 'uploadimage',\n            uploadUrl: this.$form.data('upload-url'),\n            filebrowserBrowseUrl: this.$form.data('image-browse-url'),\n            //filebrowserUploadUrl: '/uploader/upload.php?type=Files',\n            toolbarGroups: [\n                {name: 'basicstyles', groups: ['basicstyles', 'cleanup']},\n                {name: 'colors'},\n                {name: 'links'},\n                {name: 'insert'},\n                {name: 'others'},\n                {name: 'tools'},\n                '/',\n                {name: 'styles'},\n                {name: 'paragraph', groups: ['list', 'indent', 'blocks', 'align', 'bidi']}\n            ]\n        });\n        this.editor.on('fileUploadRequest', (evt) => {\n            evt.data['requestData']['_csrf'] = this.$form.find('> input[name=_csrf]').val();\n        });\n\n        this.$textHolder.trigger(\"focus\");\n        this.$textSaver.removeClass('hidden');\n        this.$contentSettings.removeClass('hidden');\n    }\n\n    private initContentSettings() {\n        this.$contentSettings.find('input[name=url]').on('keyup change keypress', (ev) => {\n            let $input = $(ev.currentTarget);\n            $input.val(($input.val() as string).replace(/[^\\w_\\-,\\.äöüß]/, ''));\n        });\n    }\n\n    private save(ev) {\n        ev.preventDefault();\n        let data = {\n            'data': this.editor.getData(),\n            '_csrf': this.$form.find('> input[name=_csrf]').val()\n        };\n        if (this.$contentSettings.length > 0) {\n            data['url'] = this.$contentSettings.find('input[name=url]').val();\n            data['title'] = this.$contentSettings.find('input[name=title]').val();\n            data['allConsultations'] = (this.$contentSettings.find('input[name=allConsultations]').prop('checked') ? 1 : 0);\n            data['inMenu'] = (this.$contentSettings.find('input[name=inMenu]').prop('checked') ? 1 : 0);\n        }\n\n        $.post(this.$form.attr('action'), data, (ret) => {\n            if (ret['success']) {\n                window.setTimeout(() => {\n                    this.editor.destroy();\n                }, 100);\n                this.$textSaver.addClass('hidden');\n                this.$textHolder.attr('contenteditable', 'false');\n                this.$editCaller.removeClass('hidden');\n                this.$contentSettings.addClass('hidden');\n\n                if (ret['title'] !== null) {\n                    $(\".pageTitle\").text(ret['title']);\n                    document.title = ret['title'];\n                    $(\"#mainmenu .page\" + ret['id']).text(ret['title']);\n                    $(\".breadcrumb\").children().last().text(ret['title']);\n                }\n\n                if (ret['message']) {\n                    alert(ret['message']);\n                }\n\n                if (ret['redirectTo']) {\n                    window.location.href = ret['redirectTo'];\n                }\n            } else {\n                alert('Something went wrong...');\n            }\n        })\n    }\n\n    private onSubmitDeleteForm(ev, data) {\n        if (data && typeof(data.confirmed) && data.confirmed === true) {\n            return;\n        }\n        ev.preventDefault();\n        bootbox.confirm(__t(\"admin\", \"delPageConfirm\"), function (result) {\n            if (result) {\n                $(\".deletePageForm\").trigger(\"submit\", {'confirmed': true});\n            }\n        });\n    }\n}\n"]}