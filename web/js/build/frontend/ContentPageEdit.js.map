{"version":3,"sources":["frontend/ContentPageEdit.ts"],"names":["editor","CKEDITOR","ContentPageEdit","$page","this","$form","find","$textSaver","$textHolder","$editCaller","click","editCalled","bind","addClass","save","prototype","ev","_this","preventDefault","attr","inline","scayt_sLang","removePlugins","extraPlugins","uploadUrl","data","filebrowserBrowseUrl","toolbarGroups","name","groups","on","evt","val","focus","removeClass","$","post","getData","_csrf","ret","window","setTimeout","destroy","alert","each"],"mappings":"AAAA,IAAOA,OAASC,SAASD,OAEzBE,gBAAA,WAOI,SAAAA,EAAoBC,GAAAC,KAAAD,MAAAA,EAChBC,KAAKC,MAAQF,EAAMG,KAAK,UACxBF,KAAKG,WAAaH,KAAKC,MAAMC,KAAK,gBAClCF,KAAKI,YAAcJ,KAAKC,MAAMC,KAAK,iBACnCF,KAAKK,YAAcN,EAAMG,KAAK,iBAE9BF,KAAKK,YAAYC,MAAMN,KAAKO,WAAWC,KAAKR,OAC5CA,KAAKG,WAAWM,SAAS,UACzBT,KAAKG,WAAWD,KAAK,UAAUI,MAAMN,KAAKU,KAAKF,KAAKR,OAwD5D,OArDYF,EAAAa,UAAAJ,WAAR,SAAmBK,GAAnB,IAAAC,EAAAb,KACIY,EAAGE,iBACHd,KAAKK,YAAYI,SAAS,UAC1BT,KAAKI,YAAYW,KAAK,kBAAmB,QAEzCf,KAAKJ,OAASC,SAASmB,OAAOhB,KAAKI,YAAYW,KAAK,OAChDE,YAAa,QACbC,cAAe,uCACfC,aAAc,cACdC,UAAWpB,KAAKC,MAAMoB,KAAK,cAC3BC,qBAAsBtB,KAAKC,MAAMoB,KAAK,oBAEtCE,gBACKC,KAAM,cAAeC,QAAS,cAAe,aAC7CD,KAAM,WACNA,KAAM,UACNA,KAAM,WACNA,KAAM,WACNA,KAAM,SACP,KACCA,KAAM,WACNA,KAAM,YAAaC,QAAS,OAAQ,SAAU,SAAU,QAAS,YAG1EzB,KAAKJ,OAAO8B,GAAG,oBAAqB,SAACC,GACjCA,EAAIN,KAAkB,YAAO,IAAI,MACjCM,EAAIN,KAAkB,YAAS,MAAIR,EAAKZ,MAAMC,KAAK,uBAAuB0B,QAG9E5B,KAAKI,YAAYyB,QACjB7B,KAAKG,WAAW2B,YAAY,WAGxBhC,EAAAa,UAAAD,KAAR,SAAaE,GAAb,IAAAC,EAAAb,KACIY,EAAGE,iBAEHiB,EAAEC,KAAKhC,KAAKC,MAAMc,KAAK,WACnBM,KAAQrB,KAAKJ,OAAOqC,UACpBC,MAASlC,KAAKC,MAAMC,KAAK,uBAAuB0B,OACjD,SAACO,GACW,KAAPA,GACAC,OAAOC,WAAW,WACdxB,EAAKjB,OAAO0C,WACb,KACHzB,EAAKV,WAAWM,SAAS,UACzBI,EAAKT,YAAYW,KAAK,kBAAmB,SACzCF,EAAKR,YAAYyB,YAAY,WAE7BS,MAAM,8BAKtBzC,EAvEA,GAyEAiC,EAAE,gBAAgBS,KAAK,WACnB,IAAI1C,gBAAgBiC,EAAE/B","file":"ContentPageEdit.js","sourcesContent":["import editor = CKEDITOR.editor;\n\nclass ContentPageEdit {\n    private $editCaller: JQuery;\n    private $textHolder: JQuery;\n    private $textSaver: JQuery;\n    private $form: JQuery;\n    private editor: editor;\n\n    constructor(private $page: JQuery) {\n        this.$form = $page.find('> form');\n        this.$textSaver = this.$form.find('> .textSaver');\n        this.$textHolder = this.$form.find('> .textHolder');\n        this.$editCaller = $page.find('> .editCaller');\n\n        this.$editCaller.click(this.editCalled.bind(this));\n        this.$textSaver.addClass(\"hidden\");\n        this.$textSaver.find('button').click(this.save.bind(this));\n    }\n\n    private editCalled(ev) {\n        ev.preventDefault();\n        this.$editCaller.addClass(\"hidden\");\n        this.$textHolder.attr('contenteditable', \"true\");\n\n        this.editor = CKEDITOR.inline(this.$textHolder.attr('id'), {\n            scayt_sLang: 'de_DE',\n            removePlugins: 'lite,showbloks,about,selectall,forms',\n            extraPlugins: 'uploadimage',\n            uploadUrl: this.$form.data('upload-url'),\n            filebrowserBrowseUrl: this.$form.data('image-browse-url'),\n            //filebrowserUploadUrl: '/uploader/upload.php?type=Files',\n            toolbarGroups: [\n                {name: 'basicstyles', groups: ['basicstyles', 'cleanup']},\n                {name: 'colors'},\n                {name: 'links'},\n                {name: 'insert'},\n                {name: 'others'},\n                {name: 'tools'},\n                '/',\n                {name: 'styles'},\n                {name: 'paragraph', groups: ['list', 'indent', 'blocks', 'align', 'bidi']}\n            ]\n        });\n        this.editor.on('fileUploadRequest', (evt) => {\n            evt.data['requestData']['foo'] = 'bar';\n            evt.data['requestData']['_csrf'] = this.$form.find('> input[name=_csrf]').val();\n        });\n\n        this.$textHolder.focus();\n        this.$textSaver.removeClass('hidden');\n    }\n\n    private save(ev) {\n        ev.preventDefault();\n\n        $.post(this.$form.attr('action'), {\n            'data': this.editor.getData(),\n            '_csrf': this.$form.find('> input[name=_csrf]').val()\n        }, (ret) => {\n            if (ret == '1') {\n                window.setTimeout(() => {\n                    this.editor.destroy();\n                }, 100);\n                this.$textSaver.addClass('hidden');\n                this.$textHolder.attr('contenteditable', 'false');\n                this.$editCaller.removeClass('hidden');\n            } else {\n                alert('Something went wrong...');\n            }\n        })\n\n    }\n}\n\n$('.contentPage').each(function () {\n    new ContentPageEdit($(this));\n});\n"]}