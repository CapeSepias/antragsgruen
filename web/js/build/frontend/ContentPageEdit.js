var __awaiter=this&&this.__awaiter||function(e,a,s,r){return new(s||(s=Promise))(function(t,n){function i(e){try{o(r.next(e))}catch(e){n(e)}}function l(e){try{o(r.throw(e))}catch(e){n(e)}}function o(e){e.done?t(e.value):function(t){return t instanceof s?t:new s(function(e){e(t)})}(e.value).then(i,l)}o((r=r.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(n,i){var l,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;s;)try{if(l=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],o=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.$form=e,this.$textSaver=e.find(".textSaver"),this.$textHolder=e.find(".textHolder"),this.$editCaller=e.find(".editCaller"),this.$contentSettings=e.find(".contentSettingsToolbar"),this.$downloadableFiles=e.find(".downloadableFiles"),this.$editCaller.on("click",this.editCalled.bind(this)),this.$textSaver.addClass("hidden"),this.$textSaver.find("button").on("click",this.save.bind(this)),0<this.$contentSettings.length&&this.initContentSettings(),0<this.$downloadableFiles.length&&this.initDownloadableFiles(),$(".deletePageForm").on("submit",this.onSubmitDeleteForm.bind(this))}return e.prototype.editCalled=function(e){var t=this;e.preventDefault(),this.$editCaller.addClass("hidden"),this.$textHolder.attr("contenteditable","true"),this.editor=CKEDITOR.inline(this.$textHolder.attr("id"),{scayt_sLang:"de_DE",removePlugins:"lite,showbloks,about,selectall,forms",extraPlugins:"uploadimage",uploadUrl:this.$form.data("upload-url"),filebrowserBrowseUrl:this.$form.data("image-browse-url"),toolbarGroups:[{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"colors"},{name:"links"},{name:"insert"},{name:"others"},{name:"tools"},"/",{name:"styles"},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]}]}),this.editor.on("fileUploadRequest",function(e){e.data.requestData._csrf=t.$form.find("> input[name=_csrf]").val()}),this.$textHolder.trigger("focus"),this.$textSaver.removeClass("hidden"),this.$contentSettings.removeClass("hidden"),this.showDownloadableFiles()},e.prototype.initContentSettings=function(){this.$contentSettings.find("input[name=url]").on("keyup change keypress",function(e){var t=$(e.currentTarget);t.val(t.val().replace(/[^\w_\-,\.äöüß]/,""))})},e.prototype.initDownloadableFiles=function(){var n=this,i=this.$downloadableFiles.find(".uploadCol .text");this.$downloadableFiles.find("input[type=file]").on("change",function(){var e=n.$downloadableFiles.find("input[type=file]").val().split("\\"),t=e[e.length-1];i.text(t)})},e.prototype.addUploadedFileCb=function(e){var t=document.createElement("li"),n=document.createElement("a");t.appendChild(n),n.setAttribute("href",e.url),n.innerText=e.title,this.$downloadableFiles.find("ul").append(t),this.$downloadableFiles.find(".none").remove()},e.prototype.hideDownloadableFiles=function(){0<this.$downloadableFiles.find("ul li").length||this.$downloadableFiles.addClass("hidden"),this.$downloadableFiles.find(".downloadableFilesUpload").addClass("hidden")},e.prototype.showDownloadableFiles=function(){this.$downloadableFiles.removeClass("hidden"),this.$downloadableFiles.find(".downloadableFilesUpload").removeClass("hidden")},e.prototype.readUploadableFile=function(i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(t,e){var n=new FileReader;n.onload=function(){var e=n.result.split(";base64,");2===e.length?t(e[1]):(alert("Could not read the given file"),t(null))},console.log(i.files),0<i.files.length?n.readAsDataURL(i.files[0]):t(null)})]})})},e.prototype.save=function(s){return __awaiter(this,void 0,void 0,function(){var t,n,i,l,o,a=this;return __generator(this,function(e){switch(e.label){case 0:return s.preventDefault(),t={data:this.editor.getData(),_csrf:this.$form.find("> input[name=_csrf]").val()},0<this.$contentSettings.length&&(t.url=this.$contentSettings.find("input[name=url]").val(),t.title=this.$contentSettings.find("input[name=title]").val(),t.allConsultations=this.$contentSettings.find("input[name=allConsultations]").prop("checked")?1:0,t.inMenu=this.$contentSettings.find("input[name=inMenu]").prop("checked")?1:0),0<this.$downloadableFiles.length?(n=this.$downloadableFiles.find("input[type=file]")[0],[4,this.readUploadableFile(n)]):[3,2];case 1:(i=e.sent())&&(l=this.$downloadableFiles.find("input[type=file]").val().split("\\"),o=l[l.length-1],t.uploadDownloadableFile=i,t.uploadDownloadableTitle=this.$downloadableFiles.find("#downloadableFileTitle").val(),t.uploadDownloadableFilename=o),e.label=2;case 2:return $.post(this.$form.attr("action"),t,function(e){e.success?(window.setTimeout(function(){a.editor.destroy()},100),a.$textSaver.addClass("hidden"),a.$textHolder.attr("contenteditable","false"),a.$editCaller.removeClass("hidden"),a.$contentSettings.addClass("hidden"),null!==e.title&&($(".pageTitle").text(e.title),document.title=e.title,$("#mainmenu .page"+e.id).text(e.title),$(".breadcrumb").children().last().text(e.title)),e.uploadedFile&&a.addUploadedFileCb(e.uploadedFile),a.hideDownloadableFiles(),e.message&&alert(e.message),e.redirectTo&&(window.location.href=e.redirectTo)):alert("Something went wrong...")}),[2]}})})},e.prototype.onSubmitDeleteForm=function(e,t){t&&(t.confirmed,1)&&!0===t.confirmed||(e.preventDefault(),bootbox.confirm(__t("admin","delPageConfirm"),function(e){e&&$(".deletePageForm").trigger("submit",{confirmed:!0})}))},e}();t.ContentPageEdit=n});
//# sourceMappingURL=ContentPageEdit.js.map
