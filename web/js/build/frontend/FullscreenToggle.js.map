{"version":3,"sources":["frontend/FullscreenToggle.js","frontend/FullscreenToggle.ts"],"names":["define","require","exports","Object","defineProperty","value","FullscreenToggle","[object Object]","$element","this","vueElement","vueWidget","element","getAttribute","holderElement","createFullscreenVueHolder","document","querySelector","addEventListener","toggleFullScreeen","bind","forEach","eventType","onFullscreenChange","append","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","initVueElement","doc","exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","isFullscreen","newUrl","currIMotion","url_html","destroyVueElement","remove","window","location","href","createElement","vueHolder","widget","template","initdata","JSON","parse","Vue","el","firstChild","data","methods","close","changed","newIMotion","$destroy"],"mappings":"AAAAA,OAAO,CAAC,UAAW,YAAY,SAAUC,EAASC,GAC9C,aACAC,OAAOC,eAAeF,EAAS,aAAc,CAAEG,OAAO,IACtDH,EAAQI,sBAAmB,ECC/BJ,EAAAI,iBAAA,MAMIC,YAAoBC,GAAAC,KAAAD,SAAAA,EAHHC,KAAAC,WAAqB,KAC9BD,KAAAE,UAAY,KAGhBF,KAAKG,QAAUJ,EAAS,GACpBC,KAAKG,QAAQC,aAAa,qBAC1BJ,KAAKC,WAAaD,KAAKG,QAAQC,aAAa,oBAC5CJ,KAAKK,cAAgBL,KAAKM,6BAE1BN,KAAKK,cAAgBE,SAASC,cAAc,SAEhDR,KAAKG,QAAQM,iBAAiB,QAAST,KAAKU,kBAAkBC,KAAKX,OAEnE,CAAC,mBAAoB,yBAA0B,sBAAuB,sBAAsBY,SACxFC,GAAaN,SAASE,iBAAiBI,EAAWb,KAAKc,mBAAmBH,KAAKX,OAAO,KAItFF,oBACAE,KAAKC,YACLM,SAASC,cAAc,QAAQO,OAAOf,KAAKK,eAG/C,IAAIA,EAAgBL,KAAKK,cACrBA,EAAcW,kBACdX,EAAcW,oBACPX,EAAcY,wBACrBZ,EAAcY,0BACPZ,EAAca,qBACrBb,EAAca,uBACPb,EAAcc,qBACrBd,EAAcc,sBAGdnB,KAAKC,YACLD,KAAKoB,iBAILtB,iBACJ,IAAIuB,EAAWd,SACXc,EAAIC,eACJD,EAAIC,iBACGD,EAAIE,qBACXF,EAAIE,uBACGF,EAAIG,oBACXH,EAAIG,sBACGH,EAAII,kBACXJ,EAAII,mBAIJ3B,eACJ,IAAIuB,EAAWd,SACf,SAAUc,EAAIK,mBACVL,EAAIM,yBACJN,EAAIO,sBACJP,EAAIQ,qBAGJ/B,oBACAE,KAAK8B,eACL9B,KAAKsB,iBAELtB,KAAKgB,oBAILlB,qBACJ,IAAKE,KAAK8B,gBAAkB9B,KAAKC,WAAY,CACzC,MAAM8B,EAAU/B,KAAKE,UAAU8B,YAAchC,KAAKE,UAAU8B,YAAYC,SAAW,KACnFjC,KAAKkC,oBACLlC,KAAKK,cAAc8B,SACfJ,GAAUK,OAAOC,SAASC,OAASP,IACnCK,OAAOC,SAASC,KAAOP,IAK3BjC,4BAEJ,MAAMK,EAAUI,SAASgC,cAAc,OACjCC,EAAYjC,SAASgC,cAAc,OAGzC,OAFApC,EAAQY,OAAOyB,GAERrC,EAGHL,iBAEJ,MAAM2C,EAASzC,KACf,IAAI0C,EAAW,IAAM1C,KAAKC,WAAa,6DAA+DD,KAAKC,WAAa,IACpH0C,EAAW,GACX3C,KAAKG,QAAQC,aAAa,uBAC1BuC,EAAWC,KAAKC,MAAM7C,KAAKG,QAAQC,aAAa,uBAEpDJ,KAAKE,UAAY,IAAI4C,IAAI,CACrBC,GAAI/C,KAAKK,cAAc2C,WACvBN,SAAAA,EACAO,KAAI,KACO,CACHN,SAAAA,EACAX,YAAa,OAGrBkB,QAAS,CACLC,MAAO,SAAUpB,GACTU,EAAOX,eACPW,EAAOnB,kBAEPmB,EAAOP,oBACPO,EAAOpC,cAAc8B,UAErBJ,IAAWK,OAAOC,SAASC,OAC3BF,OAAOC,SAASC,KAAOP,IAG/BqB,QAAS,SAAUC,GACfrD,KAAKgC,YAAcqB,IAG3BvD,kBACAA,cAIAA,oBAEJE,KAAKE,UAAUoD","file":"FullscreenToggle.js","sourcesContent":[null,"import { VueConstructor } from 'vue';\n\ndeclare var Vue: VueConstructor;\n\nexport class FullscreenToggle {\n    private readonly element: HTMLElement;\n    private readonly holderElement: HTMLElement;\n    private readonly vueElement: string = null;\n    private vueWidget = null;\n\n    constructor(private $element: JQuery) {\n        this.element = $element[0] as HTMLElement;\n        if (this.element.getAttribute('data-vue-element')) {\n            this.vueElement = this.element.getAttribute('data-vue-element');\n            this.holderElement = this.createFullscreenVueHolder();\n        } else {\n            this.holderElement = document.querySelector(\".well\");\n        }\n        this.element.addEventListener('click', this.toggleFullScreeen.bind(this));\n\n        [\"fullscreenchange\", \"webkitfullscreenchange\", \"mozfullscreenchange\", \"msfullscreenchange\"].forEach(\n            eventType => document.addEventListener(eventType, this.onFullscreenChange.bind(this), false)\n        );\n    }\n\n    private requestFullscreen() {\n        if (this.vueElement) {\n            document.querySelector(\"body\").append(this.holderElement);\n        }\n\n        let holderElement = this.holderElement as any;\n        if (holderElement.requestFullscreen) {\n            holderElement.requestFullscreen();\n        } else if (holderElement.webkitRequestFullscreen) {\n            holderElement.webkitRequestFullscreen();\n        } else if (holderElement.mozRequestFullScreen) {\n            holderElement.mozRequestFullScreen();\n        } else if (holderElement.msRequestFullscreen) {\n            holderElement.msRequestFullscreen();\n        }\n\n        if (this.vueElement) {\n            this.initVueElement();\n        }\n    }\n\n    private exitFullscreen() {\n        let doc: any = document;\n        if (doc.exitFullscreen) {\n            doc.exitFullscreen();\n        } else if (doc.webkitExitFullscreen) {\n            doc.webkitExitFullscreen();\n        } else if (doc.mozCancelFullScreen) {\n            doc.mozCancelFullScreen();\n        } else if (doc.msExitFullscreen) {\n            doc.msExitFullscreen();\n        }\n    }\n\n    private isFullscreen(): boolean {\n        let doc: any = document;\n        return !!(doc.fullscreenElement ||\n            doc.webkitFullscreenElement ||\n            doc.mozFullScreenElement ||\n            doc.msFullscreenElement);\n    }\n\n    private toggleFullScreeen() {\n        if (this.isFullscreen()) {\n            this.exitFullscreen();\n        } else {\n            this.requestFullscreen();\n        }\n    }\n\n    private onFullscreenChange() {\n        if (!this.isFullscreen() && this.vueElement) {\n            const newUrl = (this.vueWidget.currIMotion ? this.vueWidget.currIMotion.url_html : null);\n            this.destroyVueElement();\n            this.holderElement.remove();\n            if (newUrl && window.location.href !== newUrl) {\n                window.location.href = newUrl;\n            }\n        }\n    }\n\n    private createFullscreenVueHolder(): HTMLElement\n    {\n        const element = document.createElement('div');\n        const vueHolder = document.createElement('div');\n        element.append(vueHolder);\n\n        return element;\n    }\n\n    private initVueElement(): void\n    {\n        const widget = this;\n        let template = '<' + this.vueElement + ' :initdata=\"initdata\" @close=\"close\" @changed=\"changed\"></' + this.vueElement + '>';\n        let initdata = {};\n        if (this.element.getAttribute('data-vue-initdata')) {\n            initdata = JSON.parse(this.element.getAttribute('data-vue-initdata'));\n        }\n        this.vueWidget = new Vue({\n            el: this.holderElement.firstChild as HTMLElement,\n            template,\n            data() {\n                return {\n                    initdata,\n                    currIMotion: null\n                };\n            },\n            methods: {\n                close: function (newUrl) {\n                    if (widget.isFullscreen()) {\n                        widget.exitFullscreen();\n                    } else {\n                        widget.destroyVueElement();\n                        widget.holderElement.remove();\n                    }\n                    if (newUrl !== window.location.href) {\n                        window.location.href = newUrl;\n                    }\n                },\n                changed: function (newIMotion) {\n                    this.currIMotion = newIMotion;\n                }\n            },\n            beforeDestroy() {},\n            created() {}\n        });\n    }\n\n    private destroyVueElement(): void\n    {\n        this.vueWidget.$destroy();\n    }\n}\n"]}