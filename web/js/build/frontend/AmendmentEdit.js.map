{"version":3,"sources":["frontend/AmendmentEdit.ts"],"names":["AmendmentEdit","$form","this","multiParagraphMode","data","lang","$","attr","initEditorialOpener","initMultiParagraphMode","spmInit","prototype","$opener","datetimepicker","locale","format","click","ev","preventDefault","$holder","$textarea","find","target","addClass","removeClass","editor","AntragsgruenEditor_1","AntragsgruenEditor","parents","submit","parent","val","getEditor","getData","each","i","el","ckeditor","plugins","lite","findPlugin","acceptAll","spmSetModifyable","$modified","$spmParagraphs","filter","length","spmOnParaClick","$para","currentTarget","hasClass","CKEDITOR","instances","console","log","focus","spmRevert","stopPropagation","destroyInstanceById","html","spmInitNonSingleParas","bind","$this","sectionId","paraNo","exports"],"mappings":"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","file":"AmendmentEdit.js","sourcesContent":["import {AntragsgruenEditor} from \"../shared/AntragsgruenEditor\";\n\nexport class AmendmentEdit {\n    private lang: string;\n    private $spmParagraphs: JQuery;\n\n    constructor(private $form: JQuery) {\n        let multiParagraphMode = $form.data(\"multi-paragraph-mode\");\n        if (typeof(multiParagraphMode) == \"undefined\") {\n            throw \"data-multi-paragraph-mode needs to be set\";\n        }\n\n        this.lang = $(\"html\").attr('lang');\n        this.initEditorialOpener();\n\n        if (multiParagraphMode) {\n            this.initMultiParagraphMode();\n        } else {\n            this.spmInit();\n        }\n    }\n\n    private initEditorialOpener() {\n        let $opener = $(\".editorialChange .opener\");\n\n        $(\".input-group.date\").datetimepicker({\n            locale: this.lang,\n            format: 'L'\n        });\n        $opener.click((ev) => {\n            ev.preventDefault();\n            let $holder = $(\".editorialChange\"),\n                $textarea = $holder.find(\".texteditor\");\n            $(ev.target).addClass(\"hidden\");\n            $(\"#section_holder_editorial\").removeClass(\"hidden\");\n            let editor: AntragsgruenEditor = new AntragsgruenEditor(\"amendmentEditorial_wysiwyg\");\n            $textarea.parents(\"form\").submit(() => {\n                $textarea.parent().find(\"textarea.raw\").val(editor.getEditor().getData());\n            });\n        });\n\n        if ($(\"#amendmentEditorial\").val() != '') {\n            $opener.click();\n        }\n    }\n\n    /* Multi paragraph mode */\n\n    private initMultiParagraphMode() {\n        $(\".wysiwyg-textarea:not(#section_holder_editorial)\").each((i, el) => {\n            let $holder = $(el),\n                $textarea = $holder.find(\".texteditor\");\n\n            let editor: AntragsgruenEditor = new AntragsgruenEditor($textarea.attr(\"id\")),\n                ckeditor: editor = editor.getEditor();\n\n            $textarea.parents(\"form\").submit(() => {\n                $textarea.parent().find(\"textarea.raw\").val(ckeditor.getData());\n                if (typeof(ckeditor.plugins.lite) != 'undefined') {\n                    ckeditor.plugins.lite.findPlugin(ckeditor).acceptAll();\n                    $textarea.parent().find(\"textarea.consolidated\").val(ckeditor.getData());\n                }\n            });\n        });\n    }\n\n    /* Single paragraph mode */\n\n    private spmSetModifyable() {\n        let $modified = this.$spmParagraphs.filter(\".modified\");\n        if ($modified.length == 0) {\n            this.$spmParagraphs.addClass('modifyable');\n        } else {\n            this.$spmParagraphs.removeClass('modifyable');\n            $('input[name=modifiedParagraphNo]').val($modified.data(\"paragraph-no\"));\n            $('input[name=modifiedSectionId]').val($modified.parents(\".texteditorBox\").data(\"section-id\"));\n        }\n    }\n\n    private spmOnParaClick(ev) {\n        let $para = $(ev.currentTarget);\n        if (!$para.hasClass('modifyable')) {\n            return;\n        }\n        $para.addClass('modified');\n        this.spmSetModifyable();\n\n        let $textarea = $para.find(\".texteditor\"),\n            editor;\n        if (typeof(CKEDITOR.instances[$textarea.attr(\"id\")]) !== \"undefined\") {\n            editor = CKEDITOR.instances[$textarea.attr(\"id\")];\n        } else {\n            console.log(\"New: \" + $textarea.attr(\"id\"));\n            editor = (new AntragsgruenEditor($textarea.attr(\"id\"))).getEditor();\n        }\n        $textarea.attr(\"contenteditable\", \"true\");\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n        $textarea.focus();\n    }\n\n    private spmRevert(ev) {\n        ev.preventDefault();\n        ev.stopPropagation();\n        let $para = $(ev.target).parents(\".wysiwyg-textarea\"),\n            $textarea = $para.find(\".texteditor\"),\n            id = $textarea.attr(\"id\");\n\n        if (typeof(CKEDITOR.instances[$textarea.attr(\"id\")]) !== \"undefined\") {\n            AntragsgruenEditor.destroyInstanceById($textarea.attr(\"id\"));\n        }\n\n        $textarea.html($para.data(\"original\"));\n        $para.removeClass(\"modified\");\n        this.spmSetModifyable();\n    }\n\n    private spmInitNonSingleParas(i, el) {\n        let $holder = $(el),\n            $textarea = $holder.find(\".texteditor\");\n        if ($holder.hasClass(\"hidden\")) {\n            return;\n        }\n        let editor: editor = (new AntragsgruenEditor($textarea.attr(\"id\"))).getEditor();\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n    }\n\n    private spmInit() {\n        this.$spmParagraphs = $(\".wysiwyg-textarea.single-paragraph\");\n        this.$spmParagraphs.click(this.spmOnParaClick.bind(this));\n        this.$spmParagraphs.find(\".modifiedActions .revert\").click(this.spmRevert.bind(this));\n        this.spmSetModifyable();\n\n        // Amendment Reason\n        $(\".wysiwyg-textarea\").filter(\":not(.single-paragraph)\").each(this.spmInitNonSingleParas.bind(this));\n\n        $(\".texteditorBox\").each((i, el) => {\n            let $this = $(el),\n                sectionId = $this.data(\"section-id\"),\n                paraNo = $this.data(\"changed-para-no\");\n            if (paraNo > -1) {\n                $(\"#section_holder_\" + sectionId + \"_\" + paraNo).click();\n            }\n        });\n    }\n}\n"]}