{"version":3,"sources":["frontend/DefaultInitiatorForm.ts"],"names":["DefaultInitiatorForm","this","$editforms","$","$supporterData","$initiatorData","$initiatorAdderRow","find","$fullTextHolder","$supporterAdderRow","on","onChangePersonType","bind","first","trigger","click","initiatorAddRow","initiatorDelRow","supporterAddRow","supporterDelRow","onKeyOnTextfield","fullTextAdderOpen","fullTextAdd","length","data","initMinSupporters","submit","prototype","prop","addClass","removeClass","ev","preventDefault","$newEl","before","target","parents","remove","_this","found","each","i","el","val","trim","bootbox","alert","__t","replace","parent","lines","split","template","getNewElement","$rows","$row","eq","$firstAffectedRow","parts","select","focus","scrollintoview","keyCode","stopPropagation","next","hasClass","prev","last","exports"],"mappings":"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","file":"DefaultInitiatorForm.js","sourcesContent":["export class DefaultInitiatorForm {\n    private $supporterAdderRow: JQuery;\n    private $fullTextHolder: JQuery;\n    private $initiatorData: JQuery;\n    private $initiatorAdderRow: JQuery;\n    private $supporterData: JQuery;\n    private $editforms: JQuery;\n\n    private onChangePersonType() {\n        if ($('#personTypeOrga').prop('checked')) {\n            this.$initiatorData.find('.organizationRow').addClass(\"hidden\");\n            this.$initiatorData.find('.contactNameRow').removeClass(\"hidden\");\n            this.$initiatorData.find('.resolutionRow').removeClass(\"hidden\");\n            this.$initiatorData.find('.adderRow').addClass(\"hidden\");\n            $('.supporterData, .supporterDataHead').addClass(\"hidden\");\n        } else {\n            this.$initiatorData.find('.organizationRow').removeClass(\"hidden\");\n            this.$initiatorData.find('.contactNameRow').addClass(\"hidden\");\n            this.$initiatorData.find('.resolutionRow').addClass(\"hidden\");\n            this.$initiatorData.find('.adderRow').removeClass(\"hidden\");\n            $('.supporterData, .supporterDataHead').removeClass(\"hidden\");\n        }\n    }\n\n    constructor() {\n        this.$editforms = $('#motionEditForm, #amendmentEditForm');\n        this.$supporterData = $('.supporterData');\n        this.$initiatorData = $('.initiatorData');\n        this.$initiatorAdderRow = this.$initiatorData.find('.adderRow');\n        this.$fullTextHolder = $('#fullTextHolder');\n        this.$supporterAdderRow = this.$supporterData.find('.adderRow');\n\n        $('#personTypeNatural, #personTypeOrga').on('click change', this.onChangePersonType.bind(this)).first().trigger('change');\n\n        this.$initiatorAdderRow.find('a').click(this.initiatorAddRow.bind(this));\n        this.$initiatorData.on('click', '.initiatorRow .rowDeleter', this.initiatorDelRow.bind(this));\n        this.$supporterAdderRow.find('a').click(this.supporterAddRow.bind(this));\n        this.$supporterData.on('click', '.supporterRow .rowDeleter', this.supporterDelRow.bind(this));\n        this.$supporterData.on('keydown', ' .supporterRow input[type=text]', this.onKeyOnTextfield.bind(this));\n\n        $('.fullTextAdder a').click(this.fullTextAdderOpen.bind(this));\n        $('.fullTextAdd').click(this.fullTextAdd.bind(this));\n\n        if (this.$supporterData.length > 0 && this.$supporterData.data('min-supporters') > 0) {\n            this.initMinSupporters();\n        }\n\n        this.$editforms.submit(this.submit.bind(this));\n    }\n\n    private initiatorAddRow(ev) {\n        ev.preventDefault();\n        let $newEl = $($('#newInitiatorTemplate').data('html'));\n        this.$initiatorAdderRow.before($newEl);\n    }\n\n    private initiatorDelRow(ev) {\n        ev.preventDefault();\n        $(ev.target).parents('.initiatorRow').remove();\n    }\n\n    private supporterAddRow(ev) {\n        ev.preventDefault();\n        let $newEl = $($('#newSupporterTemplate').data('html'));\n        this.$supporterAdderRow.before($newEl);\n    }\n\n    private supporterDelRow(ev) {\n        ev.preventDefault();\n        $(ev.target).parents('.supporterRow').remove();\n    }\n\n    private initMinSupporters() {\n        this.$editforms.submit((ev) => {\n            if ($('#personTypeOrga').prop('checked')) {\n                return;\n            }\n            let found = 0;\n            this.$supporterData.find('.supporterRow').each((i, el) => {\n                if ($(el).find('input.name').val().trim() != '') {\n                    found++;\n                }\n            });\n            if (found < this.$supporterData.data('min-supporters')) {\n                ev.preventDefault();\n                bootbox.alert(__t(\"std\", \"min_x_supporter\").replace(/%NUM%/, this.$supporterData.data('min-supporters')));\n            }\n        });\n    }\n\n    private fullTextAdderOpen(ev) {\n        ev.preventDefault();\n        $(ev.target).parent().addClass(\"hidden\");\n        $('#fullTextHolder').removeClass(\"hidden\");\n    }\n\n    private fullTextAdd() {\n        let lines = this.$fullTextHolder.find('textarea').val().split(\";\"),\n            template = $('#newSupporterTemplate').data('html'),\n            getNewElement = () => {\n                let $rows = this.$supporterData.find(\".supporterRow\");\n                for (let i = 0; i < $rows.length; i++) {\n                    let $row = $rows.eq(i);\n                    if ($row.find(\".name\").val() == '' && $row.find(\".organization\").val() == '') return $row;\n                }\n                // No empty row found\n                let $newEl = $(template);\n                if (this.$supporterAdderRow.length > 0) {\n                    this.$supporterAdderRow.before($newEl);\n                } else {\n                    $('.fullTextAdder').before($newEl);\n                }\n                return $newEl;\n            };\n        let $firstAffectedRow = null;\n        for (let i = 0; i < lines.length; i++) {\n            if (lines[i] == '') {\n                continue;\n            }\n            let $newEl = getNewElement();\n            if ($firstAffectedRow == null) $firstAffectedRow = $newEl;\n            if ($newEl.find('input.organization').length > 0) {\n                let parts = lines[i].split(',');\n                $newEl.find('input.name').val(parts[0].trim());\n                if (parts.length > 1) {\n                    $newEl.find('input.organization').val(parts[1].trim());\n                }\n            } else {\n                $newEl.find('input.name').val(lines[i]);\n            }\n        }\n        this.$fullTextHolder.find('textarea').select().focus();\n        $firstAffectedRow.scrollintoview();\n    }\n\n    private onKeyOnTextfield(ev) {\n        let $row;\n        if (ev.keyCode == 13) { // Enter\n            ev.preventDefault();\n            ev.stopPropagation();\n            $row = $(ev.target).parents('.supporterRow');\n            if ($row.next().hasClass('adderRow')) {\n                let $newEl = $($('#newSupporterTemplate').data('html'));\n                this.$supporterAdderRow.before($newEl);\n                $newEl.find('input[type=text]').first().focus();\n            } else {\n                $row.next().find('input[type=text]').first().focus();\n            }\n        } else if (ev.keyCode == 8) { // Backspace\n            $row = $(ev.target).parents('.supporterRow');\n            if ($row.find('input.name').val() != '') {\n                return;\n            }\n            if ($row.find('input.organization').val() != '') {\n                return;\n            }\n            $row.remove();\n            this.$supporterAdderRow.prev().find('input.name, input.organization').last().focus();\n        }\n    }\n\n    private submit(ev) {\n        if ($('#personTypeOrga').prop('checked')) {\n            if ($('#resolutionDate').val() == '') {\n                ev.preventDefault();\n                bootbox.alert(__t(\"std\", \"missing_resolution_date\"));\n            }\n        }\n    }\n}\n"]}