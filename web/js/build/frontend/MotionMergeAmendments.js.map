{"version":3,"sources":["frontend/MotionMergeAmendments.ts"],"names":["MotionMergeChangeActions","removeEmptyParagraphs","$","each","i","el","childNodes","length","remove","accept","node","onFinished","$node","hasClass","insertAccept","deleteAccept","reject","insertReject","deleteReject","$removeEl","name","nodeName","toLowerCase","parent","css","height","animate","$this","removeClass","removeAttr","children","replaceWith","html","exports","MotionMergeChangeTooltip","$element","mouseX","mouseY","this","positionX","positionY","popover","container","animation","trigger","placement","$popover","window","setTimeout","width","elTop","offset","top","elHeight","content","getContent","bind","find","on","ev","stopPropagation","removePopupIfInactive","prototype","$myEl","cid","data","undefined","parents","first","addClass","$el","attr","__t","text","click","$list","console","log","alert","is","destroy","affectedChangesets","performActionWithUI","action","scrollX","scrollY","saveEditorSnapshot","call","focusTextarea","scrollTo","_this","onChanged","$popovers","e","MotionMergeAmendmentsTextarea","$holder","$changedIndicator","rootObject","unchangedText","$textarea","edit","AntragsgruenEditor_1","AntragsgruenEditor","texteditor","getEditor","addSubmitListener","val","getData","setText","acceptAll","rejectAll","prepareText","$text","appendHint","removeData","markupMovedParagraph","newText","setData","normalizeHtml","fire","msg","paragraphNew","replace","initializeTooltips","MotionMergeAmendments","activePopup","currentTarget","pageX","pageY","entities","&nbsp;","&ndash;","&auml;","&ouml;","&uuml;","&Auml;","&Ouml;","&Uuml;","&szlig;","&bdquo;","&ldquo;","&bull;","&sect;","&eacute;","&rsquo;","&euro;","Object","keys","forEach","ent","RegExp","MotionMergeAmendmentsParagraph","textarea","amendmentStatuses","sectionId","parseInt","paragraphId","initButtons","hasChanged","$input","reloadText","ev2","amendmentIds","push","url","join","get","collisions","str","$form","textareas","$para","$changed","currMouseX","offsetX","off","onLeavePage","initDraftSaving","cb","submit","setDraftDate","date","$draftSavingPanel","hide","lang","formatted","Intl","DateTimeFormat","year","month","day","hour","minute","hour12","format","saveDraft","sections","_i","_a","getOwnPropertyNames","id","isPublic","prop","ajax","type","public","_csrf","success","ret","Date","error","initAutosavingDraft","$toggle","setInterval","localStorage","state","getItem","change","active","setItem"],"mappings":"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","file":"MotionMergeAmendments.js","sourcesContent":["import {AntragsgruenEditor} from \"../shared/AntragsgruenEditor\";\nimport editor = CKEDITOR.editor;\n\nexport class MotionMergeChangeActions {\n    public static removeEmptyParagraphs() {\n        $('.paragraphHolder').each((i, el) => {\n            if (el.childNodes.length == 0) {\n                $(el).remove();\n            }\n        });\n    }\n\n    public static accept(node: Element, onFinished: () => void = null) {\n        let $node = $(node);\n        if ($node.hasClass(\"ice-ins\")) {\n            MotionMergeChangeActions.insertAccept(node, onFinished);\n        }\n        if ($node.hasClass(\"ice-del\")) {\n            MotionMergeChangeActions.deleteAccept(node, onFinished);\n        }\n    }\n\n    public static reject(node: Element, onFinished: () => void = null) {\n        let $node = $(node);\n        if ($node.hasClass(\"ice-ins\")) {\n            MotionMergeChangeActions.insertReject($node, onFinished);\n        }\n        if ($node.hasClass(\"ice-del\")) {\n            MotionMergeChangeActions.deleteReject($node, onFinished);\n        }\n    }\n\n    public static insertReject($node: JQuery, onFinished: () => void = null) {\n        let $removeEl: JQuery,\n            name = $node[0].nodeName.toLowerCase();\n        if (name == 'li') {\n            $removeEl = $node.parent();\n        } else {\n            $removeEl = $node;\n        }\n        if (name == 'ul' || name == 'ol' || name == 'li' || name == 'blockquote' || name == 'pre' || name == 'p') {\n            $removeEl.css(\"overflow\", \"hidden\").height($removeEl.height());\n            $removeEl.animate({\"height\": \"0\"}, 250, () => {\n                $removeEl.remove();\n                $(\".collidingParagraph:empty\").remove();\n                MotionMergeChangeActions.removeEmptyParagraphs();\n                if (onFinished) onFinished();\n            });\n        } else {\n            $removeEl.remove();\n            if (onFinished) onFinished();\n        }\n    }\n\n    public static insertAccept(node: Element, onFinished: () => void = null) {\n        let $this: JQuery = $(node);\n        $this.removeClass(\"ice-cts ice-ins appendHint moved\");\n        $this.removeAttr(\"data-moving-partner data-moving-partner-id data-moving-partner-paragraph data-moving-msg\");\n        if (node.nodeName.toLowerCase() == 'ul' || node.nodeName.toLowerCase() == 'ol') {\n            $this.children().removeClass(\"ice-cts\").removeClass(\"ice-ins\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'li') {\n            $this.parent().removeClass(\"ice-cts\").removeClass(\"ice-ins\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'ins') {\n            $this.replaceWith($this.html());\n        }\n        if (onFinished) onFinished();\n    }\n\n    public static deleteReject($node: JQuery, onFinished: () => void = null) {\n        $node.removeClass(\"ice-cts ice-del appendHint\");\n        $node.removeAttr(\"data-moving-partner data-moving-partner-id data-moving-partner-paragraph data-moving-msg\");\n        let nodeName = $node[0].nodeName.toLowerCase();\n        if (nodeName == 'ul' || nodeName == 'ol') {\n            $node.children().removeClass(\"ice-cts\").removeClass(\"ice-del\").removeClass(\"appendHint\");\n        }\n        if (nodeName == 'li') {\n            $node.parent().removeClass(\"ice-cts\").removeClass(\"ice-del\").removeClass(\"appendHint\");\n        }\n        if (nodeName == 'del') {\n            $node.replaceWith($node.html());\n        }\n        if (onFinished) onFinished();\n    }\n\n    public static deleteAccept(node: Element, onFinished: () => void = null) {\n        let name = node.nodeName.toLowerCase(),\n            $removeEl: JQuery;\n        if (name == 'li') {\n            $removeEl = $(node).parent();\n        } else {\n            $removeEl = $(node);\n        }\n\n        if (name == 'ul' || name == 'ol' || name == 'li' || name == 'blockquote' || name == 'pre' || name == 'p') {\n            $removeEl.css(\"overflow\", \"hidden\").height($removeEl.height());\n            $removeEl.animate({\"height\": \"0\"}, 250, () => {\n                $removeEl.remove();\n                $(\".collidingParagraph:empty\").remove();\n                MotionMergeChangeActions.removeEmptyParagraphs();\n                if (onFinished) onFinished();\n            });\n        } else {\n            $removeEl.remove();\n            if (onFinished) onFinished();\n        }\n    }\n}\n\n\nclass MotionMergeChangeTooltip {\n    constructor(private $element: JQuery, mouseX: number, mouseY: number, private parent: MotionMergeAmendmentsTextarea) {\n        let positionX: number = null,\n            positionY: number = null;\n        $element.popover({\n            'container': 'body',\n            'animation': false,\n            'trigger': 'manual',\n            'placement': function (popover) {\n                let $popover = $(<string>popover);\n                window.setTimeout(() => {\n                    let width = $popover.width(),\n                        elTop = $element.offset().top,\n                        elHeight = $element.height();\n                    if (positionX === null && width > 0) {\n                        positionX = (mouseX - width / 2);\n                        positionY = mouseY + 10;\n                        if (positionY < (elTop + 19)) {\n                            positionY = elTop + 19;\n                        }\n                        if (positionY > elTop + elHeight) {\n                            positionY = elTop + elHeight;\n                        }\n                    }\n                    $popover.css(\"left\", positionX + \"px\");\n                    $popover.css(\"top\", positionY + \"px\");\n                }, 1);\n                return \"bottom\";\n            },\n            'html': true,\n            'content': this.getContent.bind(this)\n        });\n\n        $element.popover('show');\n        let $popover: JQuery = $element.find(\"> .popover\");\n        $popover.on(\"mousemove\", (ev) => {\n            ev.stopPropagation();\n        });\n        window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n    }\n\n    private getContent() {\n        let $myEl: JQuery = this.$element,\n            html,\n            cid = $myEl.data(\"cid\");\n        if (cid == undefined) {\n            cid = $myEl.parent().data(\"cid\");\n        }\n        $myEl.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").addClass(\"hover\");\n\n        html = '<div>';\n        html += '<button type=\"button\" class=\"accept btn btn-sm btn-default\"></button>';\n        html += '<button type=\"button\" class=\"reject btn btn-sm btn-default\"></button>';\n        html += '<a href=\"#\" class=\"btn btn-small btn-default opener\" target=\"_blank\"><span class=\"glyphicon glyphicon-new-window\"></span></a>';\n        html += '<div class=\"initiator\" style=\"font-size: 0.8em;\"></div>';\n        html += '</div>';\n        let $el: JQuery = $(html);\n        $el.find(\".opener\").attr(\"href\", $myEl.data(\"link\")).attr(\"title\", __t(\"merge\", \"title_open_in_blank\"));\n        $el.find(\".initiator\").text(__t(\"merge\", \"initiated_by\") + \": \" + $myEl.data(\"username\"));\n        if ($myEl.hasClass(\"ice-ins\")) {\n            $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n            $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n        } else if ($myEl.hasClass(\"ice-del\")) {\n            $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n            $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n        } else if ($myEl[0].nodeName.toLowerCase() == 'li') {\n            let $list = $myEl.parent();\n            if ($list.hasClass(\"ice-ins\")) {\n                $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n                $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n            } else if ($list.hasClass(\"ice-del\")) {\n                $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n                $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n            } else {\n                console.log(\"unknown\", $list);\n            }\n        } else {\n            console.log(\"unknown\", $myEl);\n            alert(\"unknown\");\n        }\n        return $el;\n    }\n\n    private removePopupIfInactive() {\n        if (this.$element.is(\":hover\")) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        if ($(\"body\").find(\".popover:hover\").length > 0) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        this.destroy();\n    }\n\n    private affectedChangesets() {\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        return this.$element.parents(\".texteditor\").find(\"[data-cid=\" + cid + \"]\");\n    }\n\n    private performActionWithUI(action) {\n        let scrollX = window.scrollX,\n            scrollY = window.scrollY;\n\n        this.parent.saveEditorSnapshot();\n        this.destroy();\n        action.call(this);\n        this.parent.focusTextarea();\n\n        window.scrollTo(scrollX, scrollY);\n    }\n\n    private accept() {\n        this.performActionWithUI(() => {\n            this.affectedChangesets().each((i, el) => {\n                MotionMergeChangeActions.accept(el, () => {\n                    console.log(\"Accept\");\n                    console.log($(\"#sections_56_13_wysiwyg\").html());\n                    this.parent.onChanged();\n                });\n            });\n        });\n    }\n\n    private reject() {\n        this.performActionWithUI(() => {\n            this.affectedChangesets().each((i, el) => {\n                MotionMergeChangeActions.reject(el, () => {\n                    console.log(\"onFinished\");\n                    this.parent.onChanged();\n                });\n            });\n        });\n    }\n\n    public destroy() {\n        this.$element.popover(\"hide\").popover(\"destroy\");\n\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        this.$element.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").removeClass(\"hover\");\n\n        try {\n            // Remove stale objects that were not removed correctly previously\n            const $popovers = $(\".popover\");\n            $popovers.popover(\"hide\").popover(\"destroy\");\n            $popovers.remove();\n        } catch (e) {\n        }\n    }\n}\n\nclass MotionMergeAmendmentsTextarea {\n    private texteditor: editor;\n    private unchangedText: string = null;\n\n    private prepareText(html: string) {\n        let $text: JQuery = $('<div>' + html + '</div>');\n\n        // Move the amendment-Data from OL's and UL's to their list items\n        $text.find(\"ul.appendHint, ol.appendHint\").each((i, el) => {\n            let $this: JQuery = $(el),\n                appendHint = $this.data(\"append-hint\");\n            $this.find(\"> li\").addClass(\"appendHint\").attr(\"data-append-hint\", appendHint)\n                .attr(\"data-link\", $this.data(\"link\"))\n                .attr(\"data-username\", $this.data(\"username\"));\n            $this.removeClass(\"appendHint\").removeData(\"append-hint\");\n        });\n\n        // Remove double markup\n        $text.find(\".moved .moved\").removeClass('moved');\n        $text.find(\".moved\").each(this.markupMovedParagraph.bind(this));\n\n        // Add hints about starting / ending collisions\n        $text.find(\".hasCollisions\")\n            .attr(\"data-collision-start-msg\", __t('merge', 'colliding_start'))\n            .attr(\"data-collision-end-msg\", __t('merge', 'colliding_end'));\n\n        let newText = $text.html();\n        this.texteditor.setData(newText);\n        this.unchangedText = this.normalizeHtml(this.texteditor.getData());\n        this.texteditor.fire('saveSnapshot');\n        console.log(\"snapshot\")\n    }\n\n    private markupMovedParagraph(i, el) {\n        let $node = $(el),\n            paragraphNew = $node.data('moving-partner-paragraph'),\n            msg: string;\n\n        if ($node.hasClass('inserted')) {\n            msg = __t('std', 'moved_paragraph_from');\n        } else {\n            msg = __t('std', 'moved_paragraph_to');\n        }\n        msg = msg.replace(/##PARA##/, (paragraphNew + 1));\n\n        if ($node[0].nodeName === 'LI') {\n            $node = $node.parent();\n        }\n\n        $node.attr(\"data-moving-msg\", msg);\n    }\n\n    private initializeTooltips() {\n        this.$holder.on(\"mouseover\", \".appendHint\", (ev) => {\n            if (MotionMergeAmendments.activePopup) {\n                MotionMergeAmendments.activePopup.destroy();\n            }\n            MotionMergeAmendments.activePopup = new MotionMergeChangeTooltip(\n                $(ev.currentTarget), ev.pageX, ev.pageY, this\n            );\n        });\n    }\n\n    private acceptAll() {\n        this.texteditor.fire('saveSnapshot');\n        this.$holder.find(\".collidingParagraph\").each((i, el) => {\n            let $this = $(el);\n            $this.find(\".collidingParagraphHead\").remove();\n            $this.replaceWith($this.children());\n        });\n        this.$holder.find(\".ice-ins\").each((i, el) => {\n            MotionMergeChangeActions.insertAccept(el);\n        });\n        this.$holder.find(\".ice-del\").each((i, el) => {\n            MotionMergeChangeActions.deleteAccept(el);\n        });\n    }\n\n    private rejectAll() {\n        this.texteditor.fire('saveSnapshot');\n        this.$holder.find(\".collidingParagraph\").each((i, el) => {\n            $(el).remove();\n        });\n        this.$holder.find(\".ice-ins\").each((i, el) => {\n            MotionMergeChangeActions.insertReject($(el));\n        });\n        this.$holder.find(\".ice-del\").each((i, el) => {\n            MotionMergeChangeActions.deleteReject($(el));\n        });\n    }\n\n    public saveEditorSnapshot() {\n        this.texteditor.fire('saveSnapshot');\n    }\n\n    public focusTextarea() {\n        //this.$holder.find(\".texteditor\").focus();\n        // This lead to strange cursor behavior, e.g. when removing a colliding paragraph\n    }\n\n    public getContent(): string {\n        return this.texteditor.getData();\n    }\n\n    public setText(html: string) {\n        this.prepareText(html);\n        this.initializeTooltips();\n    }\n\n    private normalizeHtml(html: string) {\n        const entities = {\n            '&nbsp;': ' ',\n            '&ndash;': '-',\n            '&auml;': 'ä',\n            '&ouml;': 'ö',\n            '&uuml;': 'ü',\n            '&Auml;': 'Ä',\n            '&Ouml;': 'Ö',\n            '&Uuml;': 'Ü',\n            '&szlig;': 'ß',\n            '&bdquo;': '„',\n            '&ldquo;': '“',\n            '&bull;': '•',\n            '&sect;': '§',\n            '&eacute;': 'é',\n            '&rsquo;': '’',\n            '&euro;': '€'\n        };\n        Object.keys(entities).forEach(ent => {\n            html = html.replace(new RegExp(ent, 'g'), entities[ent]);\n        });\n\n        return html.replace(/\\s+</g, '<').replace(/>\\s+/g, '>').replace(/<[^>]*>/g, '');\n    }\n\n    public onChanged() {\n        console.log(this.texteditor.getData());\n        if (this.normalizeHtml(this.texteditor.getData()) === this.unchangedText) {\n            this.$changedIndicator.addClass(\"hidden\");\n        } else {\n            this.$changedIndicator.removeClass(\"hidden\");\n        }\n    }\n\n    constructor(private $holder: JQuery, private $changedIndicator: JQuery, private rootObject: MotionMergeAmendments) {\n        let $textarea = $holder.find(\".texteditor\");\n        let edit = new AntragsgruenEditor($textarea.attr(\"id\"));\n        this.texteditor = edit.getEditor();\n        this.rootObject.addSubmitListener(() => {\n            $holder.find(\"textarea.raw\").val(this.texteditor.getData());\n            $holder.find(\"textarea.consolidated\").val(this.texteditor.getData());\n        });\n\n        this.setText(this.texteditor.getData());\n\n        this.$holder.find(\".acceptAllChanges\").click(this.acceptAll.bind(this));\n        this.$holder.find(\".rejectAllChanges\").click(this.rejectAll.bind(this));\n\n        this.texteditor.on('change', this.onChanged.bind(this));\n    }\n}\n\nclass MotionMergeAmendmentsParagraph {\n    private sectionId: number;\n    private paragraphId: number;\n\n    constructor(private $holder: JQuery, private textarea: MotionMergeAmendmentsTextarea, private amendmentStatuses) {\n        this.sectionId = parseInt($holder.data('sectionId'));\n        this.paragraphId = parseInt($holder.data('paragraphId'));\n\n        this.initButtons();\n    }\n\n    private hasChanged() {\n        return false; // @TODO\n    }\n\n    private initButtons() {\n        this.$holder.find('.toggleAmendment').click((ev) => {\n            if (this.hasChanged()) {\n                alert(\"TO DO\");\n            } else {\n                const $input = $(ev.currentTarget).find(\".amendmentActive\");\n                if (parseInt($input.val()) === 1) {\n                    $input.val(\"0\");\n                    $input.parents(\".btn-group\").find(\".btn\").addClass(\"btn-default\").removeClass(\"btn-success\");\n                } else {\n                    $input.val(\"1\");\n                    $input.parents(\".btn-group\").find(\".btn\").removeClass(\"btn-default\").addClass(\"btn-success\");\n                }\n                this.reloadText();\n            }\n        });\n\n        this.$holder.find('.btn-group.amendmentStatus').on('show.bs.dropdown', (ev, ev2) => {\n            console.log(\"onShow\", ev, ev2);\n        });\n    }\n\n    private reloadText() {\n        const amendmentIds = [];\n        this.$holder.find(\".amendmentActive[value='1']\").each((i, el) => {\n            amendmentIds.push(parseInt($(el).data('amendment-id')));\n        });\n        const url = this.$holder.data(\"reload-url\").replace('DUMMY', amendmentIds.join(\",\"));\n        $.get(url, (data) => {\n            this.textarea.setText(data.text);\n\n            let collisions = '';\n            data.collisions.forEach(str => {\n                collisions += str;\n            });\n\n            this.$holder.find(\".collisionsHolder\").html(collisions);\n            if (data.collisions.length > 0) {\n                this.$holder.addClass(\"hasCollisions\");\n            } else {\n                this.$holder.removeClass(\"hasCollisions\");\n            }\n        });\n    }\n}\n\nexport class MotionMergeAmendments {\n    public static activePopup: MotionMergeChangeTooltip = null;\n    public static currMouseX: number = null;\n\n    public $draftSavingPanel: JQuery;\n    private textareas: { [id: string]: MotionMergeAmendmentsTextarea } = {};\n    private amendmentStatuses;\n\n    constructor(private $form: JQuery) {\n        this.amendmentStatuses = $form.data(\"amendment-statuses\");\n        console.log(this.amendmentStatuses);\n\n        $(\".paragraphWrapper\").each((i, el) => {\n            const $para = $(el);\n            const $textarea = $para.find(\".wysiwyg-textarea\");\n            const $changed = $para.find(\".changedIndicator\");\n            this.textareas[$textarea.attr(\"id\")] = new MotionMergeAmendmentsTextarea($textarea, $changed, this);\n            $textarea.on(\"mousemove\", (ev) => {\n                MotionMergeAmendments.currMouseX = ev.offsetX;\n            });\n\n            new MotionMergeAmendmentsParagraph($para, this.textareas[$textarea.attr(\"id\")], this.amendmentStatuses);\n        });\n\n        this.$form.on(\"submit\", () => {\n            $(window).off(\"beforeunload\", MotionMergeAmendments.onLeavePage);\n        });\n        $(window).on(\"beforeunload\", MotionMergeAmendments.onLeavePage);\n\n        this.initDraftSaving();\n    }\n\n    public static onLeavePage(): string {\n        return __t(\"std\", \"leave_changed_page\");\n    }\n\n    public addSubmitListener(cb) {\n        this.$form.submit(cb);\n    }\n\n    private setDraftDate(date: Date) {\n        this.$draftSavingPanel.find(\".lastSaved .none\").hide();\n\n        let options = {\n                year: 'numeric', month: 'numeric', day: 'numeric',\n                hour: 'numeric', minute: 'numeric',\n                hour12: false\n            },\n            lang: string = $(\"html\").attr(\"lang\"),\n            formatted = new Intl.DateTimeFormat(lang, options).format(date);\n\n        this.$draftSavingPanel.find(\".lastSaved .value\").text(formatted);\n    }\n\n    private saveDraft() {\n        let sections = {};\n        for (let id of Object.getOwnPropertyNames(this.textareas)) {\n            sections[id.replace('section_holder_', '')] = this.textareas[id].getContent();\n        }\n        let isPublic: boolean = this.$draftSavingPanel.find('input[name=public]').prop('checked');\n\n        $.ajax({\n            type: \"POST\",\n            url: this.$form.data('draftSaving'),\n            data: {\n                'public': (isPublic ? 1 : 0),\n                'sections': sections,\n                '_csrf': this.$form.find('> input[name=_csrf]').val()\n            },\n            success: (ret) => {\n                if (ret['success']) {\n                    this.$draftSavingPanel.find('.savingError').addClass('hidden');\n                    this.setDraftDate(new Date(ret['date']));\n                    if (isPublic) {\n                        this.$form.find('.publicLink').removeClass('hidden');\n                    } else {\n                        this.$form.find('.publicLink').addClass('hidden');\n                    }\n                } else {\n                    this.$draftSavingPanel.find('.savingError').removeClass('hidden');\n                    this.$draftSavingPanel.find('.savingError .errorNetwork').addClass('hidden');\n                    this.$draftSavingPanel.find('.savingError .errorHolder').text(ret['error']).removeClass('hidden');\n                }\n            },\n            error: () => {\n                this.$draftSavingPanel.find('.savingError').removeClass('hidden');\n                this.$draftSavingPanel.find('.savingError .errorNetwork').removeClass('hidden');\n                this.$draftSavingPanel.find('.savingError .errorHolder').text('').addClass('hidden');\n            }\n        });\n    }\n\n    private initAutosavingDraft() {\n        let $toggle: JQuery = this.$draftSavingPanel.find('input[name=autosave]');\n\n        window.setInterval(() => {\n            if ($toggle.prop('checked')) {\n                this.saveDraft();\n            }\n        }, 5000);\n\n        if (localStorage) {\n            let state = localStorage.getItem('merging-draft-auto-save');\n            if (state !== null) {\n                $toggle.prop('checked', (state == '1'));\n            }\n        }\n        $toggle.change(() => {\n            let active: boolean = $toggle.prop('checked');\n            if (localStorage) {\n                localStorage.setItem('merging-draft-auto-save', (active ? '1' : '0'));\n            }\n        }).trigger('change');\n    }\n\n    private initDraftSaving() {\n        this.$draftSavingPanel = this.$form.find('#draftSavingPanel');\n        this.$draftSavingPanel.find('.saveDraft').on('click', this.saveDraft.bind(this));\n        this.$draftSavingPanel.find('input[name=public]').on('change', this.saveDraft.bind(this));\n        this.initAutosavingDraft();\n\n        if (this.$draftSavingPanel.data(\"resumed-date\")) {\n            let date = new Date(this.$draftSavingPanel.data(\"resumed-date\"));\n            this.setDraftDate(date);\n        }\n\n        $(\"#yii-debug-toolbar\").remove();\n    }\n}\n"]}