{"version":3,"sources":["frontend/MotionMergeAmendments.ts"],"names":["MotionMergeChangeActions","accept","node","$","hasClass","insertAccept","deleteAccept","reject","insertReject","deleteReject","$removeEl","name","nodeName","toLowerCase","parent","css","height","animate","remove","$this","removeClass","children","replaceWith","html","MotionMergeChangeTooltip","$element","currMouseX","this","popover","container","animation","trigger","placement","content","getContent","bind","$popover","find","width","Math","floor","on","ev","stopPropagation","window","setTimeout","removePopupIfInactive","prototype","$myEl","cid","data","undefined","parents","first","addClass","$el","attr","__t","text","click","$list","console","log","alert","is","length","affectedChangesets","performActionWithUI","action","saveEditorSnapshot","destroy","call","focusTextarea","_this","each","i","el","MotionMergeConflictTooltip","title","offset","left","$para","overflow","MotionMergeAmendmentsTextarea","$holder","rootObject","$textarea","edit","AntragsgruenEditor_1","AntragsgruenEditor","texteditor","getEditor","addSubmitListener","val","getData","prepareText","initializeTooltips","acceptAll","rejectAll","$text","appendHint","removeData","newText","setData","target","MotionMergeAmendments","activePopup","currentTarget","fire","focus","$form","offsetX","$draftHint","origMotionId","newMotionId","DraftSavingEngine_1","DraftSavingEngine","cb","submit"],"mappings":"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","file":"MotionMergeAmendments.js","sourcesContent":["import {AntragsgruenEditor} from \"../shared/AntragsgruenEditor\";\nimport editor = CKEDITOR.editor;\nimport {DraftSavingEngine} from \"../shared/DraftSavingEngine\";\n\nclass MotionMergeChangeActions {\n    public static accept(node: Element) {\n        if ($(node).hasClass(\"ice-ins\")) {\n            MotionMergeChangeActions.insertAccept(node);\n        }\n        if ($(node).hasClass(\"ice-del\")) {\n            MotionMergeChangeActions.deleteAccept(node);\n        }\n    }\n\n    public static reject(node: Element) {\n        if ($(node).hasClass(\"ice-ins\")) {\n            MotionMergeChangeActions.insertReject(node);\n        }\n        if ($(node).hasClass(\"ice-del\")) {\n            MotionMergeChangeActions.deleteReject(node);\n        }\n    }\n\n    public static insertReject(node: Element) {\n        let $removeEl: JQuery,\n            name = node.nodeName.toLowerCase();\n        if (name == 'li') {\n            $removeEl = $(node).parent();\n        } else {\n            $removeEl = $(node);\n        }\n        if (name == 'ul' || name == 'ol' || name == 'li' || name == 'blockquote' || name == 'pre' || name == 'p') {\n            $removeEl.css(\"overflow\", \"hidden\").height($removeEl.height());\n            $removeEl.animate({\"height\": \"0\"}, 250, function () {\n                $removeEl.remove();\n                $(\".collidingParagraph:empty\").remove();\n            });\n        } else {\n            $removeEl.remove();\n        }\n    }\n\n    public static insertAccept(node: Element) {\n        let $this: JQuery = $(node);\n        $this.removeClass(\"ice-cts\").removeClass(\"ice-ins\").removeClass(\"appendHint\");\n        if (node.nodeName.toLowerCase() == 'ul' || node.nodeName.toLowerCase() == 'ol') {\n            $this.children().removeClass(\"ice-cts\").removeClass(\"ice-ins\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'li') {\n            $this.parent().removeClass(\"ice-cts\").removeClass(\"ice-ins\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'ins') {\n            $this.replaceWith($this.html());\n        }\n    }\n\n    public static deleteReject(node: Element) {\n        let $this: JQuery = $(node);\n        $this.removeClass(\"ice-cts\").removeClass(\"ice-del\").removeClass(\"appendHint\");\n        if (node.nodeName.toLowerCase() == 'ul' || node.nodeName.toLowerCase() == 'ol') {\n            $this.children().removeClass(\"ice-cts\").removeClass(\"ice-del\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'li') {\n            $this.parent().removeClass(\"ice-cts\").removeClass(\"ice-del\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'del') {\n            $this.replaceWith($this.html());\n        }\n    }\n\n    public static deleteAccept(node: Element) {\n        let name = node.nodeName.toLowerCase(),\n            $removeEl: JQuery;\n        if (name == 'li') {\n            $removeEl = $(node).parent();\n        } else {\n            $removeEl = $(node);\n        }\n\n        if (name == 'ul' || name == 'ol' || name == 'li' || name == 'blockquote' || name == 'pre' || name == 'p') {\n            $removeEl.css(\"overflow\", \"hidden\").height($removeEl.height());\n            $removeEl.animate({\"height\": \"0\"}, 250, function () {\n                $removeEl.remove();\n                $(\".collidingParagraph:empty\").remove();\n            });\n        } else {\n            $removeEl.remove();\n        }\n    }\n}\n\n\nclass MotionMergeChangeTooltip {\n    constructor(private $element, currMouseX, private parent: MotionMergeAmendmentsTextarea) {\n        $element.popover({\n            'container': 'body',\n            'animation': false,\n            'trigger': 'manual',\n            'placement': 'bottom',\n            'html': true,\n            'content': this.getContent.bind(this)\n        });\n\n        $element.popover('show');\n        let $popover = $element.find(\"> .popover\"),\n            width = $popover.width();\n        $popover.css(\"left\", Math.floor(currMouseX - (width / 2) + 20) + \"px\");\n        $popover.on(\"mousemove\", (ev) => {\n            ev.stopPropagation();\n        });\n        window.setTimeout(this.removePopupIfInactive.bind(this), 500);\n    }\n\n    private getContent() {\n        let $myEl = this.$element,\n            html,\n            cid = $myEl.data(\"cid\");\n        if (cid == undefined) {\n            cid = $myEl.parent().data(\"cid\");\n        }\n        $myEl.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").addClass(\"hover\");\n\n        html = '<div>';\n        html += '<button type=\"button\" class=\"accept btn btn-sm btn-default\"></button>';\n        html += '<button type=\"button\" class=\"reject btn btn-sm btn-default\"></button>';\n        html += '<a href=\"#\" class=\"btn btn-small btn-default opener\" target=\"_blank\"><span class=\"glyphicon glyphicon-new-window\"></span></a>';\n        html += '<div class=\"initiator\" style=\"font-size: 0.8em;\"></div>';\n        html += '</div>';\n        let $el: JQuery = $(html);\n        $el.find(\".opener\").attr(\"href\", $myEl.data(\"link\")).attr(\"title\", __t(\"merge\", \"title_open_in_blank\"));\n        $el.find(\".initiator\").text(__t(\"merge\", \"initiated_by\") + \": \" + $myEl.data(\"username\"));\n        if ($myEl.hasClass(\"ice-ins\")) {\n            $el.find(\"button.accept\").text(__t(\"merge\", \"insert_accept\")).click(this.accept.bind(this));\n            $el.find(\"button.reject\").text(__t(\"merge\", \"insert_reject\")).click(this.reject.bind(this));\n        } else if ($myEl.hasClass(\"ice-del\")) {\n            $el.find(\"button.accept\").text(__t(\"merge\", \"delete_accept\")).click(this.accept.bind(this));\n            $el.find(\"button.reject\").text(__t(\"merge\", \"delete_reject\")).click(this.reject.bind(this));\n        } else if ($myEl[0].nodeName.toLowerCase() == 'li') {\n            let $list = $myEl.parent();\n            if ($list.hasClass(\"ice-ins\")) {\n                $el.find(\"button.accept\").text(__t(\"merge\", \"insert_accept\")).click(this.accept.bind(this));\n                $el.find(\"button.reject\").text(__t(\"merge\", \"insert_reject\")).click(this.reject.bind(this));\n            } else if ($list.hasClass(\"ice-del\")) {\n                $el.find(\"button.accept\").text(__t(\"merge\", \"delete_accept\")).click(this.accept.bind(this));\n                $el.find(\"button.reject\").text(__t(\"merge\", \"delete_reject\")).click(this.reject.bind(this));\n            } else {\n                console.log(\"unknown\", $list);\n            }\n        } else {\n            console.log(\"unknown\", $myEl);\n            alert(\"unknown\");\n        }\n        return $el;\n    }\n\n    private removePopupIfInactive() {\n        if (this.$element.is(\":hover\")) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        if ($(\"body\").find(\".popover:hover\").length > 0) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        this.$element.popover(\"hide\").popover(\"destroy\");\n\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        this.$element.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").removeClass(\"hover\");\n    }\n\n    private affectedChangesets() {\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        return this.$element.parents(\".texteditor\").find(\"[data-cid=\" + cid + \"]\");\n    }\n\n    private performActionWithUI(action) {\n        this.parent.saveEditorSnapshot();\n        this.destroy();\n        action.call(this);\n        $(\".collidingParagraph:empty\").remove();\n        this.parent.focusTextarea();\n    }\n\n    private accept() {\n        this.performActionWithUI(() => {\n            this.affectedChangesets().each((i, el) => {\n                MotionMergeChangeActions.accept(el);\n            });\n        });\n    }\n\n    private reject() {\n        this.performActionWithUI(() => {\n            this.affectedChangesets().each((i, el) => {\n                MotionMergeChangeActions.reject(el);\n            });\n        });\n    }\n\n    public destroy() {\n        this.$element.popover(\"hide\").popover(\"destroy\")\n    }\n}\n\nclass MotionMergeConflictTooltip {\n    constructor(private $element, currMouseX, private parent: MotionMergeAmendmentsTextarea) {\n        $element.popover({\n            'container': 'body',\n            'animation': false,\n            'trigger': 'manual',\n            'placement': 'bottom',\n            'html': true,\n            'title': __t(\"merge\", \"colliding_title\"),\n            'content': this.getContent.bind(this)\n        });\n        $element.popover('show');\n\n        let $popover = $(\"body > .popover\"),\n            width = $popover.width();\n        console.log($popover, $element, $element.offset().left, width, currMouseX);\n        $popover.css(\"left\", Math.floor($element.offset().left + currMouseX - (width / 2) + 20) + \"px\");\n        $popover.on(\"mousemove\", function (ev) {\n            ev.stopPropagation();\n        });\n        window.setTimeout(this.removePopupIfInactive.bind(this), 500);\n    }\n\n    private removePopupIfInactive() {\n        if (this.$element.is(\":hover\")) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        if ($(\"body\").find(\".popover:hover\").length > 0) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        this.$element.popover(\"hide\").popover(\"destroy\");\n\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        this.$element.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").removeClass(\"hover\");\n    }\n\n    private performActionWithUI(action) {\n        this.parent.saveEditorSnapshot();\n        this.destroy();\n        action.call(this);\n        $(\".collidingParagraph:empty\").remove();\n        this.parent.focusTextarea();\n    }\n\n\n    private getContent() {\n        let $this = this.$element,\n            html = '<div style=\"white-space: nowrap;\"><button type=\"button\" class=\"btn btn-small btn-default delTitle\">' +\n                '<span style=\"text-decoration: line-through\">' + __t(\"merge\", \"title\") + '</span></button>';\n        html += '<button type=\"button\" class=\"reject btn btn-small btn-default\"><span class=\"glyphicon glyphicon-trash\"></span></button>';\n        html += '<a href=\"#\" class=\"btn btn-small btn-default opener\" target=\"_blank\"><span class=\"glyphicon glyphicon-new-window\"></span></a>';\n        html += '<div class=\"initiator\" style=\"font-size: 0.8em;\"></div>';\n        html += '</div>';\n        let $el = $(html);\n        $el.find(\".delTitle\").attr(\"title\", __t(\"merge\", \"title_del_title\"));\n        $el.find(\".reject\").attr(\"title\", __t(\"merge\", \"title_del_colliding\"));\n        $el.find(\"a.opener\").attr(\"href\", $this.find(\"a\").attr(\"href\")).attr(\"title\", __t(\"merge\", \"title_open_in_blank\"));\n        $el.find(\".initiator\").text(__t(\"merge\", \"initiated_by\") + \": \" + $this.parents(\".collidingParagraph\").data(\"username\"));\n        $el.find(\".reject\").click(() => {\n            this.performActionWithUI.call(this, () => {\n                let $para = $this.parents(\".collidingParagraph\");\n                $para.css({\"overflow\": \"hidden\"}).height($para.height());\n                $para.animate({\"height\": \"0\"}, 250, function () {\n                    $para.remove();\n                });\n            });\n        });\n        $el.find(\".delTitle\").click(() => {\n            this.performActionWithUI.call(this, () => {\n                $this.remove();\n            });\n        });\n        return $el;\n    }\n\n    public destroy() {\n        this.$element.popover(\"hide\").popover(\"destroy\")\n    }\n}\n\nclass MotionMergeAmendmentsTextarea {\n    private texteditor: editor;\n\n    private prepareText() {\n        let $text = $('<div>' + this.texteditor.getData() + '</div>');\n\n        // Move the amendment-Data from OL's and UL's to their list items\n        $text.find(\"ul.appendHint, ol.appendHint\").each((i, el) => {\n            let $this = $(el),\n                appendHint = $this.data(\"append-hint\");\n            $this.find(\"> li\").addClass(\"appendHint\").attr(\"data-append-hint\", appendHint)\n                .attr(\"data-link\", $this.data(\"link\"))\n                .attr(\"data-username\", $this.data(\"username\"));\n            $this.removeClass(\"appendHint\").removeData(\"append-hint\");\n        });\n\n        let newText = $text.html();\n        this.texteditor.setData(newText);\n    }\n\n    private initializeTooltips() {\n        this.$holder.on('mouseover', '.collidingParagraphHead', (ev) => {\n            $(ev.target).parents(\".collidingParagraph\").addClass(\"hovered\");\n\n            if (MotionMergeAmendments.activePopup) {\n                MotionMergeAmendments.activePopup.destroy();\n            }\n            console.log(ev);\n            MotionMergeAmendments.activePopup = new MotionMergeConflictTooltip(\n                $(ev.currentTarget), MotionMergeAmendments.currMouseX, this\n            );\n        }).on('mouseout', '.collidingParagraphHead', (ev) => {\n            $(ev.target).parents(\".collidingParagraph\").removeClass(\"hovered\");\n        });\n\n        this.$holder.on(\"mouseover\", \".appendHint\", (ev) => {\n            if (MotionMergeAmendments.activePopup) {\n                MotionMergeAmendments.activePopup.destroy();\n            }\n            MotionMergeAmendments.activePopup = new MotionMergeChangeTooltip(\n                $(ev.target), MotionMergeAmendments.currMouseX, this\n            );\n        });\n    }\n\n    private acceptAll() {\n        this.texteditor.fire('saveSnapshot');\n        this.$holder.find(\".collidingParagraph\").each((i, el) => {\n            let $this = $(el);\n            $this.find(\".collidingParagraphHead\").remove();\n            $this.replaceWith($this.children());\n        });\n        this.$holder.find(\".ice-ins\").each((i, el) => {\n            MotionMergeChangeActions.insertAccept(el);\n        });\n        this.$holder.find(\".ice-del\").each((i, el) => {\n            MotionMergeChangeActions.deleteAccept(el);\n        });\n    }\n\n    private rejectAll() {\n        this.texteditor.fire('saveSnapshot');\n        this.$holder.find(\".collidingParagraph\").each((i, el) => {\n            $(el).remove();\n        });\n        this.$holder.find(\".ice-ins\").each((i, el) => {\n            MotionMergeChangeActions.insertReject(el);\n        });\n        this.$holder.find(\".ice-del\").each((i, el) => {\n            MotionMergeChangeActions.deleteReject(el);\n        });\n    }\n\n    public saveEditorSnapshot() {\n        this.texteditor.fire('saveSnapshot');\n    }\n\n    public focusTextarea() {\n        this.$holder.find(\".texteditor\").focus();\n    }\n\n    constructor(private $holder: JQuery, private rootObject: MotionMergeAmendments) {\n        let $textarea = $holder.find(\".texteditor\");\n        let edit = new AntragsgruenEditor($textarea.attr(\"id\"));\n        this.texteditor = edit.getEditor();\n        this.rootObject.addSubmitListener(() => {\n            $holder.find(\"textarea.raw\").val(this.texteditor.getData());\n            $holder.find(\"textarea.consolidated\").val(this.texteditor.getData());\n        });\n\n        this.prepareText();\n        this.initializeTooltips();\n\n        this.$holder.find(\".acceptAllChanges\").click(this.acceptAll.bind(this));\n        this.$holder.find(\".rejectAllChanges\").click(this.rejectAll.bind(this));\n    }\n}\n\nclass MotionMergeAmendments {\n    public static activePopup: MotionMergeChangeTooltip|MotionMergeConflictTooltip = null;\n    public static currMouseX: number = null;\n\n    constructor(private $form: JQuery) {\n        $(\".wysiwyg-textarea\").each((i, el) => {\n            new MotionMergeAmendmentsTextarea($(el), this);\n            $(el).on(\"mousemove\", (ev) => {\n                MotionMergeAmendments.currMouseX = ev.offsetX;\n            });\n        });\n\n        let $draftHint = $(\"#draftHint\"),\n            origMotionId = $draftHint.data(\"orig-motion-id\"),\n            newMotionId = $draftHint.data(\"new-motion-id\");\n        new DraftSavingEngine($form, $draftHint, \"motionmerge_\" + origMotionId + \"_\" + newMotionId);\n    }\n\n    public addSubmitListener(cb) {\n        this.$form.submit(cb);\n    }\n}\n\nnew MotionMergeAmendments($(\".motionMergeForm\"));\n"]}