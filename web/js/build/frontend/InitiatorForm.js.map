{"version":3,"sources":["frontend/InitiatorForm.ts"],"names":["InitiatorForm","$widget","_this","this","otherInitiator","wasPerson","$editforms","parents","first","$supporterData","find","$initiatorData","$initiatorAdderRow","$fullTextHolder","$","$supporterAdderRow","userData","data","settings","hasOrganisationList","$otherInitiator","on","onChangeOtherInitiator","bind","trigger","onChangePersonType","initiatorAddRow","initiatorDelRow","supporterAddRow","supporterDelRow","onKeyOnTextfield","fullTextAdderOpen","fullTextAdd","setOrgaNameFromSelect","length","initMinSupporters","initAdminSetUser","submit","prototype","val","prop","hasClass","selectedOrga","selectlist","value","isOrganization","setFieldsVisibilityOrganization","setFieldsReadonlyOrganization","addClass","removeClass","setFieldsVisibilityPerson","setFieldsReadonlyPerson","contactName","fixed","person_name","person_organization","ev","preventDefault","$newEl","before","target","remove","found","each","i","el","trim","bootbox","alert","__t","replace","parent","lines","split","template","getNewElement","$rows","$row","eq","$firstAffectedRow","parts","select","focus","scrollintoview","keyCode","stopPropagation","next","prev","last","hasResolutionDate","contactGender","exports"],"mappings":"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","file":"InitiatorForm.js","sourcesContent":["// noinspection JSUnusedLocalSymbols\nconst CONTACT_NONE = 0;\nconst CONTACT_OPTIONAL = 1;\nconst CONTACT_REQUIRED = 2;\n\ninterface UserData {\n    fixed: boolean;\n    person_name: string;\n    person_organization: string;\n}\n\ninterface InitiatorFormSettings {\n    minSupporters: number;\n    hasOrganizations: boolean;\n    allowMoreSupporters: boolean;\n    skipForOrganizations: boolean;\n    hasResolutionDate: number;\n    contactName: number;\n    contactPhone: number;\n    contactEmail: number;\n    contactGender: number;\n}\n\nexport class InitiatorForm {\n    private $supporterAdderRow: JQuery;\n    private $fullTextHolder: JQuery;\n    private $initiatorData: JQuery;\n    private $initiatorAdderRow: JQuery;\n    private $supporterData: JQuery;\n    private $editforms: JQuery;\n\n    private $otherInitiator: JQuery;\n    private otherInitiator = false;\n    private hasOrganisationList: boolean;\n    private userData: UserData;\n    private settings: InitiatorFormSettings;\n\n    private wasPerson: boolean = false;\n\n    constructor(private $widget: JQuery) {\n        this.$editforms = $widget.parents('form').first();\n        this.$supporterData = $widget.find('.supporterData');\n        this.$initiatorData = $widget.find('.initiatorData');\n        this.$initiatorAdderRow = this.$initiatorData.find('.adderRow');\n        this.$fullTextHolder = $('#fullTextHolder');\n        this.$supporterAdderRow = this.$supporterData.find('.adderRow');\n\n        this.userData = $widget.data('user-data');\n        this.settings = $widget.data('settings');\n        this.hasOrganisationList = !!$widget.data(\"organisation-list\");\n\n        this.$otherInitiator = $widget.find('input[name=otherInitiator]');\n        this.$otherInitiator.on(\"change\", this.onChangeOtherInitiator.bind(this)).trigger('change');\n\n        $widget.find('#personTypeNatural, #personTypeOrga').on('click change', this.onChangePersonType.bind(this));\n        this.onChangePersonType();\n\n        this.$initiatorAdderRow.find('a').on(\"click\", this.initiatorAddRow.bind(this));\n        this.$initiatorData.on('click', '.initiatorRow .rowDeleter', this.initiatorDelRow.bind(this));\n        this.$supporterAdderRow.find('a').on(\"click\", this.supporterAddRow.bind(this));\n        this.$supporterData.on('click', '.supporterRow .rowDeleter', this.supporterDelRow.bind(this));\n        this.$supporterData.on('keydown', ' .supporterRow input[type=text]', this.onKeyOnTextfield.bind(this));\n\n        $('.fullTextAdder a').on(\"click\", this.fullTextAdderOpen.bind(this));\n        $('.fullTextAdd').on(\"click\", this.fullTextAdd.bind(this));\n\n        if (this.hasOrganisationList) {\n            this.$initiatorData.find(\"#initiatorPrimaryOrgaName\").on('changed.fu.selectlist', () => {\n                this.setOrgaNameFromSelect();\n            }).trigger('changed.fu.selectlist');\n        }\n\n        if (this.$supporterData.length > 0 && this.$supporterData.data('min-supporters') > 0) {\n            this.initMinSupporters();\n        }\n\n        this.initAdminSetUser();\n\n        this.$editforms.on(\"submit\", this.submit.bind(this));\n    }\n\n    private onChangeOtherInitiator() {\n        this.otherInitiator = (this.$otherInitiator.val() == 1 || this.$otherInitiator.prop(\"checked\"));\n        this.onChangePersonType();\n    }\n    private setOrgaNameFromSelect() {\n        if (this.$initiatorData.find('#initiatorPrimaryOrgaName').hasClass('hidden')) {\n            // If a organization list is provided, but selecting organizations is disabled for this specific motion type, then this should prevent some edge cases\n            return;\n        }\n        const $selectedOrga = this.$initiatorData.find(\"#initiatorPrimaryOrgaName\") as any;\n        const selectedOrga = $selectedOrga.selectlist(\"getValue\").value;\n        this.$initiatorData.find('#initiatorPrimaryName').val(selectedOrga);\n    }\n\n    private onChangePersonType() {\n        let isOrganization = false;\n        if ($(\"#personTypeHidden\").length > 0 && $(\"#personTypeHidden\").val() == '1') { // PERSON_ORGANIZATION === 1\n            isOrganization = true;\n        } else if ($('#personTypeOrga').prop('checked')) {\n            isOrganization = true;\n        }\n        if (isOrganization) {\n            this.setFieldsVisibilityOrganization();\n            this.setFieldsReadonlyOrganization();\n            if (this.wasPerson) {\n                this.$initiatorData.find('#initiatorPrimaryName').val('');\n            }\n            if (this.hasOrganisationList) {\n                this.$initiatorData.find('#initiatorPrimaryName').addClass('hidden');\n                this.$initiatorData.find('#initiatorPrimaryOrgaName').removeClass('hidden');\n                this.setOrgaNameFromSelect();\n            }\n            this.wasPerson = false;\n        } else {\n            this.setFieldsVisibilityPerson();\n            this.setFieldsReadonlyPerson();\n            if (this.hasOrganisationList) {\n                this.$initiatorData.find('#initiatorPrimaryName').removeClass('hidden');\n                this.$initiatorData.find('#initiatorPrimaryOrgaName').addClass('hidden');\n            }\n            this.wasPerson = true;\n        }\n    }\n\n    private setFieldsVisibilityOrganization() {\n        this.$initiatorData.addClass('type-organization').removeClass('type-person');\n        this.$initiatorData.find('.organizationRow').addClass('hidden');\n        this.$initiatorData.find('.contactNameRow').removeClass('hidden');\n        this.$initiatorData.find('.resolutionRow').removeClass('hidden');\n        this.$initiatorData.find('.genderRow').addClass('hidden');\n        this.$initiatorData.find('.adderRow').addClass('hidden');\n        $('.supporterData, .supporterDataHead').addClass('hidden');\n    }\n\n    private setFieldsReadonlyOrganization() {\n        this.$initiatorData.find('#initiatorPrimaryName').prop('readonly', false);\n        this.$initiatorData.find('#initiatorOrga').prop('readonly', false);\n    }\n\n    private setFieldsVisibilityPerson() {\n        this.$initiatorData.removeClass('type-organization').addClass('type-person');\n        this.$initiatorData.find('.organizationRow').removeClass('hidden');\n        if (this.settings.contactName == CONTACT_REQUIRED) {\n            this.$initiatorData.find('.contactNameRow').removeClass('hidden');\n            this.$initiatorData.find('.contactNameRow input').prop('required', true);\n        } else if (this.settings.contactName == CONTACT_OPTIONAL) {\n            this.$initiatorData.find('.contactNameRow').removeClass('hidden');\n            this.$initiatorData.find('.contactNameRow input').prop('required', false);\n        } else {\n            this.$initiatorData.find('.contactNameRow').addClass('hidden');\n            this.$initiatorData.find('.contactNameRow input').prop('required', false);\n        }\n        this.$initiatorData.find('.genderRow').removeClass('hidden');\n        this.$initiatorData.find('.resolutionRow').addClass('hidden');\n        this.$initiatorData.find('.adderRow').removeClass('hidden');\n        $('.supporterData, .supporterDataHead').removeClass('hidden');\n    }\n\n    private setFieldsReadonlyPerson() {\n        if (!this.userData.fixed || this.otherInitiator) {\n            this.$initiatorData.find('#initiatorPrimaryName').prop('readonly', false);\n            this.$initiatorData.find('#initiatorOrga').prop('readonly', false);\n        } else {\n            this.$initiatorData.find('#initiatorPrimaryName').prop('readonly', true).val(this.userData.person_name);\n            this.$initiatorData.find('#initiatorOrga').prop('readonly', true).val(this.userData.person_organization);\n        }\n    }\n\n    private initiatorAddRow(ev) {\n        ev.preventDefault();\n        let $newEl = $($('#newInitiatorTemplate').data('html'));\n        this.$initiatorAdderRow.before($newEl);\n    }\n\n    private initiatorDelRow(ev) {\n        ev.preventDefault();\n        $(ev.target).parents('.initiatorRow').remove();\n    }\n\n    private supporterAddRow(ev) {\n        ev.preventDefault();\n        let $newEl = $($('#newSupporterTemplate').data('html'));\n        this.$supporterAdderRow.before($newEl);\n    }\n\n    private supporterDelRow(ev) {\n        ev.preventDefault();\n        $(ev.target).parents('.supporterRow').remove();\n    }\n\n    private initMinSupporters() {\n        this.$editforms.submit((ev) => {\n            if ($('#personTypeOrga').prop('checked')) {\n                return;\n            }\n            let found = 0;\n            this.$supporterData.find('.supporterRow').each((i, el) => {\n                if (($(el).find('input.name').val() as string).trim() !== '') {\n                    found++;\n                }\n            });\n            if (found < this.$supporterData.data('min-supporters')) {\n                ev.preventDefault();\n                bootbox.alert(__t(\"std\", \"min_x_supporter\").replace(/%NUM%/, this.$supporterData.data('min-supporters')));\n            }\n        });\n    }\n\n    private fullTextAdderOpen(ev) {\n        ev.preventDefault();\n        $(ev.target).parent().addClass(\"hidden\");\n        $('#fullTextHolder').removeClass(\"hidden\");\n    }\n\n    private fullTextAdd() {\n        let lines = (this.$fullTextHolder.find('textarea').val() as string).split(\";\"),\n            template = $('#newSupporterTemplate').data('html'),\n            getNewElement = () => {\n                let $rows = this.$supporterData.find('.supporterRow');\n                for (let i = 0; i < $rows.length; i++) {\n                    let $row = $rows.eq(i);\n                    if ($row.find(\".name\").val() == '' && $row.find(\".organization\").val() == '') return $row;\n                }\n                // No empty row found\n                let $newEl = $(template);\n                if (this.$supporterAdderRow.length > 0) {\n                    this.$supporterAdderRow.before($newEl);\n                } else {\n                    $('.fullTextAdder').before($newEl);\n                }\n                return $newEl;\n            };\n        let $firstAffectedRow = null;\n        for (let i = 0; i < lines.length; i++) {\n            if (lines[i] == '') {\n                continue;\n            }\n            let $newEl = getNewElement();\n            if ($firstAffectedRow == null) $firstAffectedRow = $newEl;\n            if ($newEl.find('input.organization').length > 0) {\n                let parts = lines[i].split(',');\n                $newEl.find('input.name').val(parts[0].trim());\n                if (parts.length > 1) {\n                    $newEl.find('input.organization').val(parts[1].trim());\n                }\n            } else {\n                $newEl.find('input.name').val(lines[i]);\n            }\n        }\n        this.$fullTextHolder.find('textarea').select().focus();\n        $firstAffectedRow.scrollintoview();\n    }\n\n    private onKeyOnTextfield(ev) {\n        let $row;\n        if (ev.keyCode == 13) { // Enter\n            ev.preventDefault();\n            ev.stopPropagation();\n            $row = $(ev.target).parents('.supporterRow');\n            if ($row.next().hasClass('adderRow')) {\n                let $newEl = $($('#newSupporterTemplate').data('html'));\n                this.$supporterAdderRow.before($newEl);\n                $newEl.find('input[type=text]').first().focus();\n            } else {\n                $row.next().find('input[type=text]').first().focus();\n            }\n        } else if (ev.keyCode == 8) { // Backspace\n            $row = $(ev.target).parents('.supporterRow');\n            if ($row.find('input.name').val() != '') {\n                return;\n            }\n            if ($row.find('input.organization').val() != '') {\n                return;\n            }\n            $row.remove();\n            this.$supporterAdderRow.prev().find('input.name, input.organization').last().focus();\n        }\n    }\n\n    private submit(ev) {\n        if ($('#personTypeOrga').prop('checked')) {\n            if (this.settings.hasResolutionDate === CONTACT_REQUIRED && $('#resolutionDate').val() === '') {\n                ev.preventDefault();\n                bootbox.alert(__t('std', 'missing_resolution_date'));\n            }\n        }\n        if ($('#personTypeNatural').prop('checked')) {\n            if (this.settings.contactGender === CONTACT_REQUIRED && $('#initiatorGender input').val() === '') {\n                ev.preventDefault();\n                bootbox.alert(__t('std', 'missing_gender'));\n            }\n        }\n    }\n\n    private initAdminSetUser() {\n        this.$widget.find(\".initiatorCurrentUsername .btnEdit\").on(\"click\", () => {\n            this.$widget.find(\"input[name=initiatorSet]\").val(\"1\");\n            this.$widget.find(\".initiatorCurrentUsername\").addClass('hidden');\n            this.$widget.find(\".initiatorSetUsername\").removeClass('hidden');\n        });\n    }\n}\n"]}