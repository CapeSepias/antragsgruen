define(["require","exports","../shared/AntragsgruenEditor"],function(t,a,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=function(){function t(t){this.$form=t;var a=t.data("multi-paragraph-mode");if(void 0===a)throw"data-multi-paragraph-mode needs to be set";this.lang=$("html").attr("lang"),this.initEditorialOpener(),a?this.initMultiParagraphMode():this.spmInit()}return t.prototype.initEditorialOpener=function(){var t=$(".editorialChange .opener");$(".input-group.date").datetimepicker({locale:this.lang,format:"L"}),t.click(function(t){t.preventDefault();var a=$(".editorialChange"),e=a.find(".texteditor");$(t.target).addClass("hidden"),$("#section_holder_editorial").removeClass("hidden");var r=new i.AntragsgruenEditor("amendmentEditorial_wysiwyg");e.parents("form").submit(function(){e.parent().find("textarea.raw").val(r.getEditor().getData())})}),""!=$("#amendmentEditorial").val()&&t.click()},t.prototype.initMultiParagraphMode=function(){$(".wysiwyg-textarea:not(#section_holder_editorial)").each(function(t,a){var e=$(a),r=e.find(".texteditor"),n=new i.AntragsgruenEditor(r.attr("id")),o=n.getEditor();r.parents("form").submit(function(){r.parent().find("textarea.raw").val(o.getData()),void 0!==o.plugins.lite&&(o.plugins.lite.findPlugin(o).acceptAll(),r.parent().find("textarea.consolidated").val(o.getData()))})})},t.prototype.spmSetModifyable=function(){var t=this.$spmParagraphs.filter(".modified");0==t.length?this.$spmParagraphs.addClass("modifyable"):(this.$spmParagraphs.removeClass("modifyable"),$("input[name=modifiedParagraphNo]").val(t.data("paragraph-no")),$("input[name=modifiedSectionId]").val(t.parents(".texteditorBox").data("section-id")))},t.prototype.spmOnParaClick=function(t){var a=$(t.currentTarget);if(a.hasClass("modifyable")){a.addClass("modified"),this.spmSetModifyable();var e,r=a.find(".texteditor");void 0!==CKEDITOR.instances[r.attr("id")]?e=CKEDITOR.instances[r.attr("id")]:(console.log("New: "+r.attr("id")),e=new i.AntragsgruenEditor(r.attr("id")).getEditor()),r.attr("contenteditable","true"),r.parents("form").submit(function(){r.parent().find("textarea.raw").val(e.getData()),void 0!==e.plugins.lite&&(e.plugins.lite.findPlugin(e).acceptAll(),r.parent().find("textarea.consolidated").val(e.getData()))}),r.focus()}},t.prototype.spmRevert=function(t){t.preventDefault(),t.stopPropagation();var a=$(t.target).parents(".wysiwyg-textarea"),e=a.find(".texteditor");e.attr("id");void 0!==CKEDITOR.instances[e.attr("id")]&&i.AntragsgruenEditor.destroyInstanceById(e.attr("id")),e.html(a.data("original")),a.removeClass("modified"),this.spmSetModifyable()},t.prototype.spmInitNonSingleParas=function(t,a){var e=$(a),r=e.find(".texteditor");if(!e.hasClass("hidden")){var n=new i.AntragsgruenEditor(r.attr("id")).getEditor();r.parents("form").submit(function(){r.parent().find("textarea.raw").val(n.getData()),void 0!==n.plugins.lite&&(n.plugins.lite.findPlugin(n).acceptAll(),r.parent().find("textarea.consolidated").val(n.getData()))})}},t.prototype.spmInit=function(){this.$spmParagraphs=$(".wysiwyg-textarea.single-paragraph"),this.$spmParagraphs.click(this.spmOnParaClick.bind(this)),this.$spmParagraphs.find(".modifiedActions .revert").click(this.spmRevert.bind(this)),this.spmSetModifyable(),$(".wysiwyg-textarea").filter(":not(.single-paragraph)").each(this.spmInitNonSingleParas.bind(this)),$(".texteditorBox").each(function(t,a){var i=$(a),e=i.data("section-id"),r=i.data("changed-para-no");r>-1&&$("#section_holder_"+e+"_"+r).click()})},t}();a.AmendmentEdit=e});
//# sourceMappingURL=AmendmentEdit.js.map
