define(["require","exports","../shared/AntragsgruenEditor"],function(i,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),new(function(){function i(){var t=this;this.editors=[],this.collisionEditors={},this.$form=$("#amendmentMergeForm"),this.$collisionHolder=$(".amendmentCollisionsHolder"),this.$checkCollisions=$(".checkAmendmentCollisions"),this.$affectedParagraphs=$(".affectedParagraphs > .paragraph"),this.$otherStatsFields=$(".otherAmendmentStatus input"),this.$stepWizardHolder=$("#MergeSingleWizard").find(".steps"),this.$steps={1:this.$form.find("> .step_1"),2:this.$form.find("> .step_2"),3:this.$form.find("> .step_3")},this.$checkCollisions.click(function(i){i.preventDefault(),t.loadCollisions()}),this.$steps[1].find(".goto_2").click(function(i){i.preventDefault(),t.gotoStep("2")}),this.$affectedParagraphs.each(function(i,e){t.initAffectedParagraph(e)}),this.$form.submit(this.onSubmit.bind(this)),this.gotoStep("1")}return i.prototype.gotoStep=function(i){for(var e in this.$steps)e==i?this.$steps[e].removeClass("hidden"):this.$steps[e].addClass("hidden");this.$stepWizardHolder.children().removeClass("active"),this.$stepWizardHolder.find(".goto_step"+i).addClass("active"),this.$stepWizardHolder.scrollintoview({top_offset:-50})},i.prototype.initAffectedParagraph=function(i){var e=$(i);e.find(".versionSelector input").change(function(){"modified"==e.find(".versionSelector input:checked").val()?e.removeClass("originalVersion").addClass("modifiedVersion"):e.addClass("originalVersion").removeClass("modifiedVersion")}).trigger("change"),e.find(".modifySelector input").change(function(){e.find(".modifySelector input").prop("checked")?e.addClass("changed").removeClass("unchanged"):e.removeClass("changed").addClass("unchanged")}).trigger("change");var t=e.data("section-id")+"_"+e.data("paragraph-no");0<e.find(".originalVersion.modifyText").length&&(this.editors[t+"_original"]=new n.AntragsgruenEditor(e.find(".originalVersion.modifyText > .texteditor").attr("id"))),0<e.find(".modifiedVersion.modifyText").length&&(this.editors[t+"_modified"]=new n.AntragsgruenEditor(e.find(".modifiedVersion.modifyText > .texteditor").attr("id")))},i.prototype.loadCollisions=function(){var f=this;this.gotoStep("3");var i=this.$checkCollisions.data("url"),h={},o={};this.$affectedParagraphs.each(function(i,e){var t,o=$(e),n=o.find(".versionSelector input:checked").val(),a=o.find(".modifySelector input").prop("checked"),d=o.data("section-id"),s=o.data("paragraph-no");if(a){var r=d+"_"+s+("modified"===n?"_modified":"_original"),l=f.editors[r].getEditor(),c=l.getData();void 0!==l.plugins.lite?(l.plugins.lite.findPlugin(l).acceptAll(),t=l.getData(),l.setData(c)):t=l.getData()}else t="modified"===n?o.data("modified-amendment"):o.data("unchanged-amendment");void 0===h[o.data("section-id")]&&(h[o.data("section-id")]={}),h[o.data("section-id")][o.data("paragraph-no")]=t}),this.$otherStatsFields.each(function(i,e){var t=$(e);o[t.parents(".selectlist").data("amendment-id")]=t.val()}),$.post(i,{newSections:h,otherAmendmentsStatus:o,_csrf:this.$form.find("> input[name=_csrf]").val()},this.collisionsLoaded.bind(this))},i.prototype.collisionsLoaded=function(i){var o=this;this.collisionEditors={},this.$collisionHolder.html(i);var e=this.$collisionHolder.find(".amendmentOverrideBlock > .texteditor");0<e.length&&e.each(function(i,e){var t=$(e).attr("id");o.collisionEditors[t]=new n.AntragsgruenEditor(t)})},i.prototype.onSubmit=function(){var r=this;for(var i in this.$affectedParagraphs.each(function(i,e){var t=$(e),o=t.find(".versionSelector input:checked").val(),n=t.find(".modifySelector input").prop("checked"),a=t.find(".modifiedText");if(n){var d=t.data("section-id")+"_"+t.data("paragraph-no")+("modified"===o?"_modified":"_original"),s=r.editors[d].getEditor();void 0!==s.plugins.lite&&s.plugins.lite.findPlugin(s).acceptAll(),a.val(s.getData())}else"modified"===o?a.val(t.data("modified-amendment")):a.val(t.data("unchanged-amendment"))}),this.collisionEditors){var e=this.collisionEditors[i].getEditor();void 0!==e.plugins.lite&&e.plugins.lite.findPlugin(e).acceptAll();var t=e.getData();$("#"+i).parents(".amendmentOverrideBlock").first().find("> textarea").val(t)}},i}())});
//# sourceMappingURL=MergeSingleAmendment.js.map
