define(["require","exports","../shared/AntragsgruenEditor"],function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),new(function(){function t(){var e=this;this.editors=[],this.collisionEditors={},this.$form=$("#amendmentMergeForm"),this.$collisionHolder=$(".amendmentCollisionsHolder"),this.$checkCollisions=$(".checkAmendmentCollisions"),this.$affectedParagraphs=$(".affectedParagraphs > .paragraph"),this.$otherStatsFields=$(".otherAmendmentStatus input"),this.$stepWizardHolder=$("#MergeSingleWizard").find(".steps"),this.$steps={1:this.$form.find("> .step_1"),2:this.$form.find("> .step_2"),3:this.$form.find("> .step_3")},this.$checkCollisions.click(function(t){t.preventDefault(),e.loadCollisions()}),this.$steps[1].find(".goto_2").click(function(t){t.preventDefault(),e.gotoStep("2")}),this.$affectedParagraphs.each(function(t,i){e.initAffectedParagraph(i)}),this.$form.submit(this.onSubmit.bind(this)),this.gotoStep("1")}return t.prototype.gotoStep=function(t){for(var i in this.$steps)i==t?this.$steps[i].removeClass("hidden"):this.$steps[i].addClass("hidden");this.$stepWizardHolder.children().removeClass("active"),this.$stepWizardHolder.find(".goto_step"+t).addClass("active"),this.$stepWizardHolder.scrollintoview({top_offset:-50})},t.prototype.initAffectedParagraph=function(t){var i=$(t);i.find(".modifySelector input").change(function(){"1"==i.find(".modifySelector input:checked").val()?i.addClass("modified").removeClass("unmodified"):i.removeClass("modified").addClass("unmodified")}).trigger("change");var e=i.data("section-id")+"_"+i.data("paragraph-no");this.editors[e]=new s.AntragsgruenEditor(i.find(".affectedBlock > .texteditor").attr("id"))},t.prototype.loadCollisions=function(){var l=this;this.gotoStep("3");var t=this.$checkCollisions.data("url"),c={},a={};this.$affectedParagraphs.each(function(t,i){var e,a=$(i),s=a.find(".modifySelector input:checked").val(),o=a.data("section-id"),n=a.data("paragraph-no");if(s){var d=l.editors[o+"_"+n].getEditor(),r=d.getData();void 0!==d.plugins.lite?(d.plugins.lite.findPlugin(d).acceptAll(),e=d.getData(),d.setData(r)):e=d.getData()}else e=a.data("unchanged-amendment");void 0===c[a.data("section-id")]&&(c[a.data("section-id")]={}),c[a.data("section-id")][a.data("paragraph-no")]=e}),this.$otherStatsFields.each(function(t,i){var e=$(i);a[e.parents(".selectlist").data("amendment-id")]=e.val()}),$.post(t,{newSections:c,otherAmendmentsStatus:a,_csrf:this.$form.find("> input[name=_csrf]").val()},this.collisionsLoaded.bind(this))},t.prototype.collisionsLoaded=function(t){var a=this;this.collisionEditors={},this.$collisionHolder.html(t);var i=this.$collisionHolder.find(".amendmentOverrideBlock > .texteditor");0<i.length&&i.each(function(t,i){var e=$(i).attr("id");a.collisionEditors[e]=new s.AntragsgruenEditor(e)})},t.prototype.onSubmit=function(){var n=this;for(var t in this.$affectedParagraphs.each(function(t,i){var e=$(i),a=e.find(".modifiedText");if("1"==e.find(".modifySelector input:checked").val()){var s=e.data("section-id")+"_"+e.data("paragraph-no"),o=n.editors[s].getEditor();void 0!==o.plugins.lite&&o.plugins.lite.findPlugin(o).acceptAll(),a.val(o.getData())}else a.val(e.data("unchanged-amendment"))}),this.collisionEditors){var i=this.collisionEditors[t].getEditor();void 0!==i.plugins.lite&&i.plugins.lite.findPlugin(i).acceptAll();var e=i.getData();$("#"+t).parents(".amendmentOverrideBlock").first().find("> textarea").val(e)}},t}())});
//# sourceMappingURL=MergeSingleAmendment.js.map
