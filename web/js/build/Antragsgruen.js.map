{"version":3,"sources":["Antragsgruen.ts"],"names":["$","each","loadModule","this","data","requirejs","$element","console","log","imports","className","split","length","window","$hint","attr","appendTo","parent","remove","document","on","ev","$el","currentTarget","popover","html","trigger","container","template","content","id","Date","getTime","url","get","ret","not","$target","target","hasClass","parents","recalcAgendaNode","$ol","currNumber","$lis","find","$li","code","currStr","$subitems","parts","matches","match","nonNumeric","numeric","parseInt","join","text","jQuery"],"mappings":"CAEC,SAAUA,GACPA,EAAE,kCAAkCC,KAAK,WACrC,GAAIC,GAAaF,EAAEG,MAAMC,KAAK,0BAC9BC,YAAWH,MAGfF,EAAE,8BAA8BC,KAAK,WACjC,GAAIK,GAAWN,EAAEG,MACbD,EAAaI,EAASF,KAAK,sBAC/BG,SAAQC,IAAIN,GACZG,WAAWH,GAAa,SAAUO,GAC9B,GAAIC,GAAYR,EAAWS,MAAM,IACjCJ,SAAQC,IAAIE,EAAWD,EAAQC,EAAUE,OAAS,GAAIC,OAAOH,EAAUA,EAAUE,OAAS,KAC1F,GAAIH,GAAQC,EAAUA,EAAUE,OAAS,IAAIN,OAIrDN,EAAE,qBAAqBC,KAAK,WACxB,GAAIa,GAAQd,EAAEG,KACdH,GAAE,6CAA6Ce,KAAK,QAASD,EAAMV,KAAK,UAAUY,SAASF,EAAMG,UACjGH,EAAMI,WAGVlB,EAAEmB,UAAUC,GAAG,QAAS,wBAAyB,SAAUC,GACvD,GAAIC,GAAMtB,EAAEqB,EAAGE,cACgB,MAA3BD,EAAIlB,KAAK,iBACTkB,EAAIlB,KAAK,cAAe,KACxBkB,EAAIE,SACAC,MAAM,EACNC,QAAS,SACTC,UAAW,OACXC,SAAU,+JACVC,QAAS,WACL,GAAIC,GAAK,QAAS,GAAKC,OAAQC,UAC3BH,EAAU,YAAcC,EAAK,qBAC7BG,EAAMX,EAAIlB,KAAK,MAInB,OAHAJ,GAAEkC,IAAID,EAAK,SAAUE,GACjBnC,EAAE,IAAM8B,GAAIL,KAAKU,KAEdN,MAInB7B,EAAE,yBAAyBoC,IAAId,GAAKE,QAAQ,QAC5CF,EAAIE,QAAQ,YAEhBxB,EAAEmB,UAAUC,GAAG,QAAS,SAAUC,GAC9B,GAAIgB,GAAUrC,EAAEqB,EAAGiB,OAEdD,GAAQE,SAAS,yBAA4BF,EAAQE,SAAS,YACZ,GAAnDF,EAAQG,QAAQ,yBAAyB5B,QAAqD,GAAtCyB,EAAQG,QAAQ,YAAY5B,QAEpFZ,EAAE,yBAAyBwB,QAAQ,SAK3C,IAAIiB,GAAmB,SAAUC,GAC7B,GAAIC,GAAa,KACbC,EAAOF,EAAIG,KAAK,kBACpBD,GAAK3C,KAAK,WACN,GAAI6C,GAAM9C,EAAEG,MACR4C,EAAOD,EAAI1C,KAAK,QAChB4C,EAAU,GACVC,EAAYH,EAAID,KAAK,OACzB,IAAY,KAARE,EAAa,CACb,GAAIG,GAAQP,EAAWhC,MAAM,KACzBwC,EAAUD,EAAM,GAAGE,MAAM,yBACzBC,EAAoC,mBAAfF,GAAQ,GAAqB,GAAKA,EAAQ,GAC/DG,EAAUC,SAAuB,IAAdJ,EAAQ,GAAW,IAAMA,EAAQ,GACxDD,GAAM,GAAKG,KAAeC,EAC1BX,EAAaK,EAAUE,EAAMM,KAAK,SAElCR,GAAUL,EAAaI,CAG3BD,GAAID,KAAK,oBAAoBY,KAAKT,GAC9BC,EAAUrC,OAAS,GACnB6B,EAAiBQ,KAI7BjD,GAAE,uBAAuBoB,GAAG,6BAA8B,WACtDqB,EAAiBzC,EAAEG,SACpBuB,QAAQ,+BAEbgC","file":"Antragsgruen.js","sourcesContent":["declare let requirejs: any;\n\n(function ($: JQueryStatic) {\n    $(\"[data-antragsgruen-load-class]\").each(function () {\n        let loadModule = $(this).data(\"antragsgruen-load-class\");\n        requirejs([loadModule]);\n    });\n\n    $(\"[data-antragsgruen-widget]\").each(function () {\n        let $element = $(this),\n            loadModule = $element.data(\"antragsgruen-widget\");\n        console.log(loadModule);\n        requirejs([loadModule], function (imports) {\n            let className = loadModule.split('/');\n            console.log(className, imports[className.length - 1], window[className[className.length - 1]]);\n            new imports[className[className.length - 1]]($element);\n        });\n    });\n\n    $(\".jsProtectionHint\").each(function () {\n        let $hint = $(this);\n        $('<input type=\"hidden\" name=\"jsprotection\">').attr(\"value\", $hint.data(\"value\")).appendTo($hint.parent());\n        $hint.remove();\n    });\n\n    $(document).on('click', '.amendmentAjaxTooltip', function (ev) {\n        let $el = $(ev.currentTarget);\n        if ($el.data('initialized') == '0') {\n            $el.data('initialized', '1');\n            $el.popover({\n                html: true,\n                trigger: 'manual',\n                container: 'body',\n                template: '<div class=\"popover popover-amendment-ajax\" role=\"tooltip\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>',\n                content: function () {\n                    let id = 'pop_' + (new Date()).getTime(),\n                        content = '<div id=\"' + id + '\">Loading...</div>',\n                        url = $el.data('url');\n                    $.get(url, function (ret) {\n                        $('#' + id).html(ret);\n                    });\n                    return content;\n                }\n            });\n        }\n        $('.amendmentAjaxTooltip').not($el).popover('hide');\n        $el.popover('toggle');\n    });\n    $(document).on('click', function (ev) {\n        let $target = $(ev.target);\n        if (\n            !$target.hasClass('amendmentAjaxTooltip') && !$target.hasClass('popover') &&\n            $target.parents('.amendmentAjaxTooltip').length == 0 && $target.parents('.popover').length == 0\n        ) {\n            $('.amendmentAjaxTooltip').popover('hide');\n        }\n    });\n\n    // Needs to be synchronized with ConsultationAgendaItem:getSortedFromConsultation\n    let recalcAgendaNode = function ($ol) {\n        let currNumber = '0.',\n            $lis = $ol.find('> li.agendaItem');\n        $lis.each(function () {\n            let $li = $(this),\n                code = $li.data('code'),\n                currStr = '',\n                $subitems = $li.find('> ol');\n            if (code == '#') {\n                let parts = currNumber.split('.'),\n                    matches = parts[0].match(/^(.*[^0-9])?([0-9]*)$/),\n                    nonNumeric = (typeof(matches[1]) == 'undefined' ? '' : matches[1]),\n                    numeric = parseInt(matches[2] == '' ? '1' : matches[2]);\n                parts[0] = nonNumeric + ++numeric;\n                currNumber = currStr = parts.join('.');\n            } else {\n                currStr = currNumber = code;\n            }\n\n            $li.find('> div > h3 .code').text(currStr);\n            if ($subitems.length > 0) {\n                recalcAgendaNode($subitems);\n            }\n        });\n    };\n    $('ol.motionListAgenda').on(\"antragsgruen:agenda-change\", function () {\n        recalcAgendaNode($(this));\n    }).trigger(\"antragsgruen:agenda-change\");\n\n}(jQuery));\n"]}