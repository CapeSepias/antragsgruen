"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var n=0;n<a.length;n++){var t=a[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(a,n,t){return n&&e(a.prototype,n),t&&e(a,t),a}}(),SiteCreateWizard=function(){function e(a,n){_classCallCheck(this,e),this.$=a,this.firstPanel="#panelPurpose",this.$root=n,this.mode=a("#SiteCreateWizard").data("mode"),this.initEvents()}return _createClass(e,[{key:"getRadioValue",value:function(e,a){var n=this.$root.find("fieldset."+e).find("input:checked");return n.length>0?n.val():a}},{key:"getWizardState",value:function(){return{wording:this.getRadioValue("wording",1),singleMotion:this.getRadioValue("singleMotion",0),motionsInitiatedBy:this.getRadioValue("motionWho",1),motionsDeadlineExists:this.getRadioValue("motionDeadline",0),motionsDeadline:this.$root.find("fieldset.motionDeadline .date input").val(),motionScreening:this.getRadioValue("motionScreening",1),needsSupporters:this.getRadioValue("needsSupporters",0),minSupporters:this.$root.find("input.minSupporters").val(),hasAmendments:this.getRadioValue("hasAmendments",1),amendSinglePara:this.getRadioValue("amendSinglePara",0),amendmentInitiatedBy:this.getRadioValue("amendmentWho",1),amendmentDeadlineExists:this.getRadioValue("amendmentDeadline",0),amendmentDeadline:this.$root.find("fieldset.amendmentDeadline .date input").val(),amendScreening:this.getRadioValue("amendScreening",1),hasComments:this.getRadioValue("hasComments",1),hasAgenda:this.getRadioValue("hasAgenda",0),openNow:this.getRadioValue("openNow",0),title:$("#siteTitle").val(),organization:$("#siteOrganization").val(),subdomain:$("#siteSubdomain").val(),contact:$("#siteContact").val()}}},{key:"showPanel",value:function(e){this.data=this.getWizardState(),console.log(this.data);var a=e.data("tab");this.$root.find(".wizard .steps li").removeClass("active"),this.$root.find(".wizard .steps ."+a).addClass("active"),this.$activePanel&&this.$activePanel.removeClass("active").addClass("inactive"),e.addClass("active").removeClass("inactive"),this.$activePanel=e;try{var n=window.location.hash=="#"+e.attr("id");""!=window.location.hash&&"#"!=window.location.hash||"#"+e.attr("id")!=this.firstPanel||(n=!0),n||(console.log("change"),window.location.hash="#"+e.attr("id").substring(5))}catch(e){console.log(e)}}},{key:"getNextPanel",value:function(){switch(this.data=this.getWizardState(),this.$activePanel.attr("id")){case"panelPurpose":return"#panelSingleMotion";case"panelSingleMotion":return 1==this.data.singleMotion?"#panelHasAmendments":"#panelMotionWho";case"panelMotionWho":return 1==this.data.motionsInitiatedBy?"#panelHasAmendments":"#panelMotionDeadline";case"panelMotionDeadline":return"#panelMotionScreening";case"panelMotionScreening":return"#panelNeedsSupporters";case"panelNeedsSupporters":return"#panelHasAmendments";case"panelHasAmendments":return 1==this.data.hasAmendments?"#panelAmendSinglePara":"#panelComments";case"panelAmendSinglePara":return"#panelAmendWho";case"panelAmendWho":return 1==this.data.amendmentInitiatedBy?"#panelComments":"#panelAmendDeadline";case"panelAmendDeadline":return"#panelAmendScreening";case"panelAmendScreening":return"#panelComments";case"panelComments":return 1==this.data.singleMotion?"#panelOpenNow":"#panelAgenda";case"panelAgenda":return"#panelOpenNow";case"panelOpenNow":return"#panelSiteData"}}},{key:"initEvents",value:function(){var e=this,a=this.$root,n=this.$;this.$activePanel=null,this.data=this.getWizardState(),a.find("input").change(function(){e.data=e.getWizardState()}),a.find(".radio-label input").change(function(){var e=n(this).parents("fieldset").first();e.find(".radio-label").removeClass("active");var a=e.find(".radio-label input:checked");a.parents(".radio-label").first().addClass("active")}).trigger("change"),a.find("fieldset.wording input").change(function(){var e=a.find("fieldset.wording input:checked").data("wording-name");a.removeClass("wording_motion").removeClass("wording_manifesto").addClass("wording_"+e)}).trigger("change"),a.find(".input-group.date").each(function(){var e=n(this);e.datetimepicker({locale:e.find("input").data("locale")})}),a.find(".date.motionsDeadline").on("dp.change",function(){n("input.motionsDeadlineExists").prop("checked",!0).change()}),a.find(".date.amendmentDeadline").on("dp.change",function(){n("input.amendDeadlineExists").prop("checked",!0).change()}),a.find("input.minSupporters").change(function(){n("input.needsSupporters").prop("checked",!0).change()}),a.find("#siteSubdomain").on("keyup change",function(){var e=n(this),t=e.val(),i=e.parents(".subdomainRow").first(),s=e.data("query-url").replace(/SUBDOMAIN/,t),o=i.find(".subdomainError");return""==t?(o.addClass("hidden"),void i.removeClass("has-error").removeClass("has-success")):t.match(/^[A-Z0-9äöü](?:[A-Z0-9äöü_\-]{0,61}[A-Z0-9äöü])?$/i)?void n.get(s,function(n){n.available?(o.addClass("hidden"),i.removeClass("has-error"),a.find("button[type=submit]").prop("disabled",!1),n.subdomain==e.val()&&i.addClass("has-success")):(o.removeClass("hidden"),o.html(o.data("template").replace(/%SUBDOMAIN%/,n.subdomain)),i.removeClass("has-success"),n.subdomain==e.val()&&(a.find("button[type=submit]").prop("disabled",!0),i.addClass("has-error")))}):(i.removeClass("has-success").addClass("has-error"),void a.find("button[type=submit]").prop("disabled",!0))}),a.find("#siteTitle").on("keyup change",function(){n(this).val().length>=5?n(this).parents(".form-group").first().addClass("has-success"):n(this).parents(".form-group").first().removeClass("has-success")}),a.find("#siteOrganization").on("keyup change",function(){n(this).val().length>=5?n(this).parents(".form-group").first().addClass("has-success"):n(this).parents(".form-group").first().removeClass("has-success")});var t=this;a.find(".navigation .btn-next").click(function(e){"submit"!=n(this).attr("type")&&(e.preventDefault(),t.showPanel(n(t.getNextPanel())))}),a.find(".navigation .btn-prev").click(function(e){e.preventDefault(),""!=window.location.hash&&window.history.back()}),a.submit(function(e){}),n(window).on("hashchange",function(a){a.preventDefault();var t;t=0==window.location.hash.substring(1)?e.firstPanel:"#panel"+window.location.hash.substring(1);var i=n(t);i.length>0&&e.showPanel(i)}),a.find(".step-pane").addClass("inactive"),this.showPanel(n(this.firstPanel))}}]),e}();
//# sourceMappingURL=SiteCreateWizard.js.map
