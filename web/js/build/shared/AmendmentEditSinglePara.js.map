{"version":3,"sources":["shared/AmendmentEditSinglePara.ts"],"names":["AmendmentEditSinglePara","_this","this","$paragraphs","$","click","ev","startEditing","delegateTarget","find","preventDefault","stopPropagation","revertChanges","setModifyable","filter","each","i","el","handleRegularTextField","$this","sectionId","data","paraNo","prototype","$el","$textarea","hasClass","aedit","AntragsgruenEditor_1","AntragsgruenEditor","attr","editor","getEditor","parents","submit","parent","val","getData","plugins","lite","findPlugin","acceptAll","para","$para","id","html","removeClass","addClass","CKEDITOR","instances","focus","$modified","length","exports"],"mappings":"gFAEA,IAAAA,GAAA,WAGI,QAAAA,KAAA,GAAAC,GAAAC,IACIA,MAAKC,YAAcC,EAAE,sCAErBF,KAAKC,YAAYE,MAAM,SAACC,GACpBL,EAAKM,aAAaD,EAAGE,kBAEzBN,KAAKC,YAAYM,KAAK,4BAA4BJ,MAAM,SAACC,GACrDA,EAAGI,iBACHJ,EAAGK,kBACHV,EAAKW,cAAcN,EAAGE,kBAE1BN,KAAKW,gBAGLT,EAAE,qBAAqBU,OAAO,2BAA2BC,KAAK,SAACC,EAAGC,GAC9DhB,EAAKiB,uBAAuBD,KAGhCb,EAAE,kBAAkBW,KAAK,SAACC,EAAGC,GACzB,GAAIE,GAAQf,EAAEa,GACVG,EAAYD,EAAME,KAAK,cACvBC,EAASH,EAAME,KAAK,kBACpBC,IAAS,GACTlB,EAAE,mBAAqBgB,EAAY,IAAME,GAAQjB,UAwEjE,MAnEYL,GAAAuB,UAAAL,uBAAR,SAA+BD,GAC3B,GAAIO,GAAMpB,EAAEa,GACRQ,EAAYD,EAAIf,KAAK,cAEzB,KAAIe,EAAIE,SAAS,UAAjB,CAGA,GAAIC,GAAQ,GAAIC,GAAAC,mBAAmBJ,EAAUK,KAAK,OAC9CC,EAASJ,EAAMK,WACnBP,GAAUQ,QAAQ,QAAQC,OAAO,WAC7BT,EAAUU,SAAS1B,KAAK,gBAAgB2B,IAAIL,EAAOM,WAChB,mBAAxBN,GAAOO,QAAY,OAC1BP,EAAOO,QAAQC,KAAKC,WAAWT,GAAQU,YACvChB,EAAUU,SAAS1B,KAAK,yBAAyB2B,IAAIL,EAAOM,gBAKhErC,EAAAuB,UAAAX,cAAR,SAAsB8B,GAClB,GAAIlB,GAAMpB,EAAEsC,GACRC,EAAQnB,EAAIS,QAAQ,qBACpBR,EAAYkB,EAAMlC,KAAK,eACvBmC,EAAKnB,EAAUK,KAAK,KACxB1B,GAAE,IAAMwC,GAAId,KAAK,kBAAmB,SACpCL,EAAUoB,KAAKF,EAAMtB,KAAK,aAC1BsB,EAAMG,YAAY,YAClB5C,KAAKW,iBAGDb,EAAAuB,UAAAhB,aAAR,SAAqBmC,GACjB,GAAIC,GAAQvC,EAAEsC,EACd,IAAKC,EAAMjB,SAAS,cAApB,CAIAiB,EAAMI,SAAS,YACf7C,KAAKW,eAEL,IACIkB,GADAN,EAAYkB,EAAMlC,KAAK,cAE3B,IAAyD,mBAA9CuC,UAASC,UAAUxB,EAAUK,KAAK,OACzCC,EAASiB,SAASC,UAAUxB,EAAUK,KAAK,WACxC,CACH,GAAIH,GAAQ,GAAIC,GAAAC,mBAAmBJ,EAAUK,KAAK,MAClDC,GAASJ,EAAMK,YAEnBP,EAAUK,KAAK,kBAAmB,QAClCL,EAAUQ,QAAQ,QAAQC,OAAO,WAC7BT,EAAUU,SAAS1B,KAAK,gBAAgB2B,IAAIL,EAAOM,WAChB,mBAAxBN,GAAOO,QAAY,OAC1BP,EAAOO,QAAQC,KAAKC,WAAWT,GAAQU,YACvChB,EAAUU,SAAS1B,KAAK,yBAAyB2B,IAAIL,EAAOM,cAGpEZ,EAAUyB,UAGNlD,EAAAuB,UAAAV,cAAR,WACI,GAAIsC,GAAYjD,KAAKC,YAAYW,OAAO,YAChB,IAApBqC,EAAUC,OACVlD,KAAKC,YAAY4C,SAAS,eAE1B7C,KAAKC,YAAY2C,YAAY,cAC7B1C,EAAE,mCAAmCgC,IAAIe,EAAU9B,KAAK,iBACxDjB,EAAE,iCAAiCgC,IAAIe,EAAUlB,QAAQ,kBAAkBZ,KAAK,iBAG5FrB,IAlGaqD,GAAArD,wBAAAA","file":"AmendmentEditSinglePara.js","sourcesContent":["import {AntragsgruenEditor} from \"./AntragsgruenEditor\";\n\nexport class AmendmentEditSinglePara {\n    private $paragraphs: JQuery;\n\n    constructor() {\n        this.$paragraphs = $(\".wysiwyg-textarea.single-paragraph\");\n\n        this.$paragraphs.click((ev) => {\n            this.startEditing(ev.delegateTarget);\n        });\n        this.$paragraphs.find(\".modifiedActions .revert\").click((ev) => {\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.revertChanges(ev.delegateTarget);\n        });\n        this.setModifyable();\n\n        // Amendment Reason\n        $(\".wysiwyg-textarea\").filter(\":not(.single-paragraph)\").each((i, el) => {\n            this.handleRegularTextField(el);\n        });\n\n        $(\".texteditorBox\").each((i, el) => {\n            let $this = $(el),\n                sectionId = $this.data(\"section-id\"),\n                paraNo = $this.data(\"changed-para-no\");\n            if (paraNo > -1) {\n                $(\"#section_holder_\" + sectionId + \"_\" + paraNo).click();\n            }\n        });\n    }\n\n    private handleRegularTextField(el: Element) {\n        let $el = $(el),\n            $textarea = $el.find(\".texteditor\");\n\n        if ($el.hasClass(\"hidden\")) {\n            return;\n        }\n        let aedit = new AntragsgruenEditor($textarea.attr(\"id\")),\n            editor = aedit.getEditor();\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n    }\n\n    private revertChanges(para: Element) {\n        let $el = $(para),\n            $para = $el.parents(\".wysiwyg-textarea\"),\n            $textarea = $para.find(\".texteditor\"),\n            id = $textarea.attr(\"id\");\n        $(\"#\" + id).attr(\"contenteditable\", \"false\");\n        $textarea.html($para.data(\"original\"));\n        $para.removeClass(\"modified\");\n        this.setModifyable();\n    }\n\n    private startEditing(para: Element) {\n        let $para = $(para);\n        if (!$para.hasClass('modifyable')) {\n            return;\n        }\n\n        $para.addClass('modified');\n        this.setModifyable();\n\n        let $textarea = $para.find(\".texteditor\"),\n            editor;\n        if (typeof(CKEDITOR.instances[$textarea.attr(\"id\")]) !== \"undefined\") {\n            editor = CKEDITOR.instances[$textarea.attr(\"id\")];\n        } else {\n            let aedit = new AntragsgruenEditor($textarea.attr(\"id\"));\n            editor = aedit.getEditor();\n        }\n        $textarea.attr(\"contenteditable\", \"true\");\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n        $textarea.focus();\n    }\n\n    private setModifyable() {\n        let $modified = this.$paragraphs.filter(\".modified\");\n        if ($modified.length == 0) {\n            this.$paragraphs.addClass('modifyable');\n        } else {\n            this.$paragraphs.removeClass('modifyable');\n            $('input[name=modifiedParagraphNo]').val($modified.data(\"paragraph-no\"));\n            $('input[name=modifiedSectionId]').val($modified.parents(\".texteditorBox\").data(\"section-id\"));\n        }\n    }\n}\n"]}