var SiteCreateWizard=function(){function e(e){this.$root=e,this.firstPanel=$("#SiteCreateWizard").data("init-step"),this.mode=$("#SiteCreateWizard").data("mode"),this.initEvents()}return e.prototype.getRadioValue=function(e,n){var t=this.$root.find("fieldset."+e).find("input:checked");return 0<t.length?t.val():n},e.prototype.getCheckboxValues=function(e,n){var t=this.$root.find("fieldset."+e).find("input:checked").toArray();return 0<t.length?t.map(function(e){return parseInt(e.getAttribute("value"),10)}):n},e.prototype.getWizardState=function(){var e;return{language:this.getRadioValue("language",null),functionality:this.getCheckboxValues("functionality",[]),singleMotion:this.getRadioValue("singleMotion",0),motionsInitiatedBy:this.getRadioValue("motionWho",1),motionsDeadlineExists:this.getRadioValue("motionDeadline",0),motionsDeadline:this.$root.find("fieldset.motionDeadline .date input").val(),motionScreening:this.getRadioValue("motionScreening",1),needsSupporters:this.getRadioValue("needsSupporters",0),minSupporters:(e=this.$root.find("input.minSupporters").val(),""===e||null===e?null:parseInt(e,10)),hasAmendments:this.getRadioValue("hasAmendments",1),amendSinglePara:this.getRadioValue("amendSinglePara",0),amendMerging:this.getRadioValue("amendMerging",0),amendmentInitiatedBy:this.getRadioValue("amendmentWho",1),amendmentDeadlineExists:this.getRadioValue("amendmentDeadline",0),amendmentDeadline:this.$root.find("fieldset.amendmentDeadline .date input").val(),amendScreening:this.getRadioValue("amendScreening",1),hasComments:this.getRadioValue("hasComments",1),hasAgenda:this.getRadioValue("hasAgenda",0),openNow:this.getRadioValue("openNow",0),title:$("#siteTitle").val(),organization:$("#siteOrganization").val(),subdomain:$("#siteSubdomain").val(),contact:$("#siteContact").val()}},e.prototype.showPanel=function(e){this.data=this.getWizardState(),console.log(this.data);var n=e.data("tab");this.$root.find(".wizard .steps li").removeClass("active"),this.$root.find(".wizard .steps ."+n).addClass("active"),this.$activePanel&&this.$activePanel.removeClass("active").addClass("inactive"),e.addClass("active").removeClass("inactive"),0<(this.$activePanel=e).find("input:checked").length?e.find("input:checked").trigger("focus"):0<e.find("button[type=submit]").length&&e.find("button[type=submit]").trigger("focus");try{var t=window.location.hash=="#"+e.attr("id");""!=window.location.hash&&"#"!=window.location.hash||"#"+e.attr("id")!=this.firstPanel||(t=!0),t||(window.location.hash="#"+e.attr("id").substring(5))}catch(e){console.log(e)}},e.prototype.getNextPanel=function(){switch(this.data=this.getWizardState(),this.$activePanel.attr("id")){case"panelFunctionality":case"panelLanguage":return"#panelSingleMotion";case"panelSingleMotion":return 1==this.data.singleMotion?"#panelHasAmendments":"#panelMotionWho";case"panelMotionWho":return 1==this.data.motionsInitiatedBy?"#panelHasAmendments":"#panelMotionDeadline";case"panelMotionDeadline":return"#panelMotionScreening";case"panelMotionScreening":return"#panelNeedsSupporters";case"panelNeedsSupporters":return"#panelHasAmendments";case"panelHasAmendments":return 1==this.data.hasAmendments?"#panelAmendSinglePara":"#panelComments";case"panelAmendSinglePara":return"#panelAmendWho";case"panelAmendWho":return 1==this.data.amendmentInitiatedBy?"#panelComments":"#panelAmendDeadline";case"panelAmendDeadline":return"#panelAmendMerging";case"panelAmendMerging":return"#panelAmendScreening";case"panelAmendScreening":return"#panelComments";case"panelComments":return 1==this.data.singleMotion?"#panelOpenNow":"#panelAgenda";case"panelAgenda":return"#panelOpenNow";case"panelOpenNow":return"#panelSiteData"}},e.prototype.subdomainChange=function(e){var n=this,t=$(e.currentTarget),a=t.val(),i=t.parents(".subdomainRow").first(),s=t.data("query-url").replace(/SUBDOMAIN/,a),o=i.find(".subdomainError");return""===a?(o.addClass("hidden"),void i.removeClass("has-error").removeClass("has-success")):a.match(/^[A-Z0-9äöü](?:[A-Z0-9äöü_\-]{0,61}[A-Z0-9äöü])?$/i)?void $.get(s,function(e){e.available?(o.addClass("hidden"),i.removeClass("has-error"),n.$root.find("button[type=submit]").prop("disabled",!1),e.subdomain==t.val()&&i.addClass("has-success")):(o.removeClass("hidden"),o.html(o.data("template").replace(/%SUBDOMAIN%/,e.subdomain)),i.removeClass("has-success"),e.subdomain==t.val()&&(n.$root.find("button[type=submit]").prop("disabled",!0),i.addClass("has-error")))}):(i.removeClass("has-success").addClass("has-error"),void this.$root.find("button[type=submit]").prop("disabled",!0))},e.prototype.initEvents=function(){var a=this,t=this.$root;this.$activePanel=null,this.data=this.getWizardState(),t.find("input").on("change",function(){a.data=a.getWizardState()}),t.find(".radio-label input").on("change",function(){var e=$(this).parents("fieldset").first();e.find(".radio-label").removeClass("active"),e.find(".radio-label input:checked").parents(".radio-label").first().addClass("active")}).trigger("change"),t.find(".checkbox-label input").on("change",function(){var e=$(this);e.prop("checked")?e.parents(".checkbox-label").first().addClass("active"):e.parents(".checkbox-label").first().removeClass("active")}).trigger("change"),t.find("fieldset.wording input").on("change",function(){var e=t.find("fieldset.wording input:checked").data("wording-name");t.removeClass("wording_motion").removeClass("wording_manifesto").addClass("wording_"+e)}).trigger("change"),t.find(".input-group.date").each(function(){var e=$(this);e.datetimepicker({locale:e.find("input").data("locale")})}),t.find(".date.motionsDeadline").on("dp.change",function(){$("input.motionsDeadlineExists").prop("checked",!0).trigger("change")}),t.find(".date.amendmentDeadline").on("dp.change",function(){$("input.amendDeadlineExists").prop("checked",!0).trigger("change")}),t.find("input.minSupporters").on("change",function(){$("input.needsSupporters").prop("checked",!0).trigger("change")}),t.find("#siteSubdomain").on("keyup change",this.subdomainChange.bind(this)),t.find("#siteTitle").on("keyup change",function(){5<=$(this).val().length?$(this).parents(".form-group").first().addClass("has-success"):$(this).parents(".form-group").first().removeClass("has-success")}),t.find("#siteOrganization").on("keyup change",function(){5<=$(this).val().length?$(this).parents(".form-group").first().addClass("has-success"):$(this).parents(".form-group").first().removeClass("has-success")}),t.find("#panelSiteData input").on("keypress",function(e){var n=e.originalEvent;13!==n.charCode&&13!==n.keyCode||e.preventDefault()}),t.find("#panelLanguage input").on("change",function(){var e=t.find("#panelLanguage input:checked").val(),n=t.find("#panelLanguage").data("url").replace(/LNG/,e);window.location.href=n});var n=this;t.on("keypress",function(e){"Enter"===e.key&&"submit"!==a.$activePanel.find(".btn-next").attr("type")&&(e.preventDefault(),e.stopPropagation(),a.showPanel($(n.getNextPanel())))}),t.find(".navigation .btn-next").on("click",function(e){"submit"!==$(e.currentTarget).attr("type")&&(e.preventDefault(),n.showPanel($(n.getNextPanel())))}),t.find(".navigation .btn-prev").on("click",function(e){e.preventDefault(),""!=window.location.hash&&window.history.back()}),$(window).on("hashchange",function(e){var n;e.preventDefault(),n=0===parseInt(window.location.hash.substring(1))?a.firstPanel:"#panel"+window.location.hash.substring(1);var t=$(n);0<t.length&&a.showPanel(t)}),t.find(".step-pane").addClass("inactive"),this.showPanel($(this.firstPanel))},e}();
//# sourceMappingURL=SiteCreateWizard.js.map
